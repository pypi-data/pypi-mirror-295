import{e as z,r as T,s as E,ai as N,G as w,o as i,c as M,j as e,h as y,w as d,b as r,d as S,i as x,aj as h,ak as O,al as j,N as Q,M as U,am as G,g as H,a as c,F as P,k as Y,t as C,a9 as q,X as Z,_ as J,q as X,p as K,U as R,V as ee,A as te,f as ae}from"./BNXY2P2N.js";import{u as oe}from"./DAJe3ji_.js";import{_ as le}from"./DfUsPrkf.js";import"./B7YJYDcY.js";import"./D1G1UBUZ.js";const ne={class:"container"},re=z({__name:"edit-form",props:{updateModel:{}},setup($,{expose:p}){const m=T(!1),b=E(()=>l.value&&k.value&&V.value),a=[{value:null,text:"Select the data source type"},...Object.values(N).map(t=>({value:t,text:t}))],l=E(()=>{var t;return m.value?!!((t=F.updateModel)!=null&&t.type):null}),k=E(()=>{var t;return m.value?!!((t=F.updateModel)!=null&&t.name):null}),V=E(()=>{var t;return m.value?!!((t=F.updateModel)!=null&&t.connStr):null}),B=(t=!0)=>{m.value=t},F=$,n=w({...F.updateModel});return p({setFormEntered:B,formValid:b,model:n}),(t,o)=>{const _=h,s=O,u=j,I=Q,g=U,f=G;return i(),M("div",ne,[e(n)?(i(),y(f,{key:0},{default:d(()=>[r(u,{label:"Name","label-for":"dataSourceName","label-class":"mb-1",class:"mb-3"},{default:d(()=>[r(_,{id:"dataSourceName",modelValue:e(n).name,"onUpdate:modelValue":o[0]||(o[0]=D=>e(n).name=D),required:"",placeholder:"Enter data source name",state:e(k)},null,8,["modelValue","state"]),r(s,{state:e(k)},{default:d(()=>o[4]||(o[4]=[S(" Please input a data source name ")])),_:1},8,["state"])]),_:1}),r(u,{label:"Type","label-for":"dataSourceType","label-class":"mb-1",class:"mb-3"},{default:d(()=>[r(I,{id:"dataSourceType",modelValue:e(n).type,"onUpdate:modelValue":o[1]||(o[1]=D=>e(n).type=D),options:a,required:"",state:e(l)},null,8,["modelValue","state"]),r(s,{state:e(l)},{default:d(()=>o[5]||(o[5]=[S(" Please select a data source type ")])),_:1},8,["state"])]),_:1}),r(u,{label:"Description","label-for":"dataSourceDesc","label-class":"mb-1",class:"mb-3"},{default:d(()=>[r(g,{id:"dataSourceDesc",modelValue:e(n).description,"onUpdate:modelValue":o[2]||(o[2]=D=>e(n).description=D)},null,8,["modelValue"])]),_:1}),r(u,{label:"Connection string","label-for":"dataSourceConnStr","label-class":"mb-1",class:"mb-3"},{default:d(()=>[r(g,{id:"dataSourceConnStr",modelValue:e(n).connStr,"onUpdate:modelValue":o[3]||(o[3]=D=>e(n).connStr=D),required:"",placeholder:"Enter connection string",state:e(V)},null,8,["modelValue","state"]),r(s,{state:e(V)},{default:d(()=>o[6]||(o[6]=[S(" Please input a connection string ")])),_:1},8,["state"])]),_:1})]),_:1})):x("",!0)])}}}),se={key:0},de={class:"table-responsive"},ue={class:"table table-striped table-hover"},ie={key:1,class:"alert alert-warning"},ce={key:1,class:"w-100 h-100"},me=z({__name:"list",props:{dataSources:{}},emits:["delete","edit","copy"],setup($,{emit:p}){const m=H(),b=T(null),a=w({open:!1,id:"edit-modal",title:"Edit data source",isLoading:!1,error:null,size:"lg",data:null,sourceId:null}),l=w({open:!1,id:"delete-modal",title:"Delete data source",isLoading:!1,error:null,size:"md",sourceName:"",sourceId:null}),k=s=>{l.sourceName=s.name,l.sourceId=s.id,l.open=!0},V=s=>{a.data={...s},a.sourceId=s.id,a.open=!0},B=()=>{a.error=null,a.data=null,a.open=!1,a.sourceId=null},F=async()=>{if(l.sourceId)try{await m.deleteDataSource(l.sourceId),_("delete",l.sourceId),l.open=!1,n()}catch(s){l.error=s instanceof Error?s.message:"An unexpected error occurred",console.error(l.error)}},n=()=>{l.error=null,l.sourceName="",l.sourceId=null},t=async()=>{if(b.value){const s=b.value;if(s.setFormEntered(!0),s.formValid&&a.sourceId&&s.model)try{const u=await m.updateDataSource(a.sourceId,s.model);_("edit",u),s.setFormEntered(!1),B()}catch(u){a.error=u instanceof Error?u.message:"An unexpected error occurred",console.error(a.error)}}},o=s=>{_("copy",s)},_=p;return(s,u)=>{const I=Z,g=J,f=X,D=K,L=R,W=ee;return s.dataSources?(i(),M(P,{key:0},[s.dataSources.length>0?(i(),M("div",se,[c("div",de,[c("table",ue,[u[2]||(u[2]=c("thead",null,[c("tr",null,[c("th",null,"ID"),c("th",null,"Name"),c("th",null,"Type"),c("th",null,"Description"),c("th",null,"Options")])],-1)),c("tbody",null,[(i(!0),M(P,null,Y(s.dataSources,v=>(i(),M("tr",{key:`tr-${v.id}`},[c("td",null,C(v.id),1),c("td",null,C(v.name),1),c("td",null,[r(I,{variant:"light"},{default:d(()=>[S(C(v.type),1)]),_:2},1024)]),c("td",null,C(v.description),1),c("td",null,[(i(),y(f,{key:`${v.id}-btn-edit`,variant:"link",title:"Edit",onClick:A=>V(v)},{default:d(()=>[r(g,{name:"material-symbols:edit-outline"})]),_:2},1032,["onClick"])),(i(),y(f,{key:`${v.id}-btn-copy`,variant:"link",title:"Copy",onClick:A=>o(v)},{default:d(()=>[r(g,{name:"material-symbols:content-copy-outline"})]),_:2},1032,["onClick"])),(i(),y(f,{key:`${v.id}-btn-delete`,variant:"link",title:"Delete",onClick:A=>k(v)},{default:d(()=>[r(g,{name:"material-symbols:delete-outline"})]),_:2},1032,["onClick"]))])]))),128))])]),(i(),y(L,{id:e(a).id,key:e(a).id,modelValue:e(a).open,"onUpdate:modelValue":u[0]||(u[0]=v=>e(a).open=v),title:e(a).title,size:e(a).size,"ok-title":"Save",onOk:q(t,["prevent"]),onHide:B},{default:d(()=>[e(a).error?(i(),y(D,{key:0,"model-value":e(a).error!=null,variant:"danger"},{default:d(()=>[S(C(e(a).error),1)]),_:1},8,["model-value"])):x("",!0),e(a).data?(i(),y(re,{id:"editForm",key:"editForm",ref_key:"editForm",ref:b,"update-model":e(a).data},null,8,["update-model"])):x("",!0)]),_:1},8,["id","modelValue","title","size"])),(i(),y(L,{id:e(l).id,key:e(l).id,modelValue:e(l).open,"onUpdate:modelValue":u[1]||(u[1]=v=>e(l).open=v),title:e(l).title,size:e(l).size,"ok-title":"Delete","ok-variant":"danger",onOk:q(F,["prevent"])},{default:d(()=>[e(l).error?(i(),y(D,{key:0,"model-value":e(l).error!=null,variant:"danger"},{default:d(()=>[S(C(e(l).error),1)]),_:1},8,["model-value"])):x("",!0),u[4]||(u[4]=c("p",null,"Are you sure you want to delete this data source?",-1)),c("p",null,[u[3]||(u[3]=c("strong",null,"Name:",-1)),S(" "+C(e(l).sourceName),1)])]),_:1},8,["id","modelValue","title","size"]))])])):(i(),M("div",ie,"No data sources found."))],64)):(i(),M("div",ce,[r(W,{label:"Loading data sources..."})]))}}}),pe={class:"container"},fe=z({__name:"create-form",props:{createModel:{}},setup($,{expose:p}){const m=T(!1),b=E(()=>l.value&&k.value&&V.value),a=[{value:null,text:"Select the data source type"},...Object.values(N).map(t=>({value:t,text:t}))],l=E(()=>m.value?!!n.value.type:null),k=E(()=>m.value?!!n.value.name:null),V=E(()=>m.value?!!n.value.connStr:null),B=(t=!0)=>{m.value=t},n=T({...$.createModel});return te(()=>n.value.type,t=>{t&&(t==N.SQLite?n.value.connStr="sqlite:////path/to/db":t==N.DuckDB?n.value.connStr="duckdb:////path/to/db":t==N.SQLServer?n.value.connStr="mssql+pyodbc://user:password@host:port/databasename?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes":t==N.PostgreSQL&&(n.value.connStr="postgresql+psycopg://user:password@host:port/databasename?key=value&key=value"))}),p({setFormEntered:B,formValid:b,dataSourceCreateModel:n,model:n}),(t,o)=>{const _=h,s=O,u=j,I=Q,g=G;return i(),M("div",pe,[r(g,null,{default:d(()=>[r(u,{label:"Name","label-for":"dataSourceName","label-class":"mb-1",class:"mb-3"},{default:d(()=>[r(_,{id:"dataSourceName",modelValue:e(n).name,"onUpdate:modelValue":o[0]||(o[0]=f=>e(n).name=f),required:"",placeholder:"Enter data source name",state:e(k)},null,8,["modelValue","state"]),r(s,{state:e(k)},{default:d(()=>o[4]||(o[4]=[S(" Please input a data source name ")])),_:1},8,["state"])]),_:1}),r(u,{label:"Type","label-for":"dataSourceType","label-class":"mb-1",class:"mb-3"},{default:d(()=>[r(I,{id:"dataSourceType",modelValue:e(n).type,"onUpdate:modelValue":o[1]||(o[1]=f=>e(n).type=f),options:a,required:"",state:e(l)},null,8,["modelValue","state"]),r(s,{state:e(l)},{default:d(()=>o[5]||(o[5]=[S(" Please select a data source type ")])),_:1},8,["state"])]),_:1}),r(u,{label:"Description","label-for":"dataSourceDesc","label-class":"mb-1",class:"mb-3"},{default:d(()=>[r(e(U),{id:"dataSourceDesc",modelValue:e(n).description,"onUpdate:modelValue":o[2]||(o[2]=f=>e(n).description=f)},null,8,["modelValue"])]),_:1}),r(u,{label:"Connection string","label-for":"dataSourceConnStr","label-class":"mb-1",class:"mb-3"},{default:d(()=>[r(e(U),{id:"dataSourceConnStr",modelValue:e(n).connStr,"onUpdate:modelValue":o[3]||(o[3]=f=>e(n).connStr=f),required:"",placeholder:"Enter connection string",state:e(V)},null,8,["modelValue","state"]),r(s,{state:e(V)},{default:d(()=>o[6]||(o[6]=[S(" Please input a connection string ")])),_:1},8,["state"])]),_:1})]),_:1})])}}}),ve={class:"px-4 mt-3 w-100"},Ve=z({__name:"data-sources",setup($){const p=T(),m=H(),b=T(null),a=w({open:!1,id:"createFormModal",title:"Add data source",isLoading:!1,size:"lg",error:null,data:null});ae(()=>{m.getDataSources().then(t=>{p.value=t}).catch(t=>{console.error(t)})});const l=()=>{a.open=!1,a.error=null,a.data=null},k=()=>{a.data={type:null,name:"",connStr:"",description:""},a.open=!0},V=async()=>{if(b.value){const t=b.value;if(t.setFormEntered(!0),t.formValid){const o=t.model;try{await m.createDataSource(o),a.open=!1,p.value=await m.getDataSources(),t.setFormEntered(!1),l()}catch(_){a.error=_ instanceof Error?_.message:"An unexpected error occurred"}}}},B=t=>{p.value&&(p.value=p.value.filter(o=>o.id!==t))},F=t=>{if(p.value){const o=p.value.findIndex(_=>_.id===t.id);o!==-1&&(p.value[o]=t)}},n=t=>{a.data={type:t.type,name:t.name,connStr:t.connStr,description:t.description},a.open=!0};return oe(),(t,o)=>{const _=J,s=X,u=K,I=R,g=me;return i(),y(le,null,{"header-secondary":d(()=>[r(s,{variant:"outline-secondary",size:"sm",onClick:k},{default:d(()=>[r(_,{name:"material-symbols:add"}),o[1]||(o[1]=S(" Add data source "))]),_:1}),r(I,{id:e(a).id,modelValue:e(a).open,"onUpdate:modelValue":o[0]||(o[0]=f=>e(a).open=f),title:e(a).title,size:e(a).size,"ok-title":"Create",onOk:q(V,["prevent"]),onHidden:l},{default:d(()=>[e(a).error?(i(),y(u,{key:0,"model-value":e(a).error!=null,variant:"danger"},{default:d(()=>[S(C(e(a).error),1)]),_:1},8,["model-value"])):x("",!0),e(a).data?(i(),y(fe,{key:1,id:"createForm",ref_key:"createForm",ref:b,"create-model":e(a).data},null,8,["create-model"])):x("",!0)]),_:1},8,["id","modelValue","title","size"])]),default:d(()=>[c("div",ve,[r(g,{"data-sources":e(p),onCopy:n,onDelete:B,onEdit:F},null,8,["data-sources"])])]),_:1})}}});export{Ve as default};
