import{f as w,r as N,y as E,ak as I,I as $,o as c,c as C,k as e,i as y,w as d,b as n,d as b,j as x,al as O,am as P,an as Q,V as j,O as z,ao as W,g as G,a as i,F as A,l as X,t as B,ab as U,W as Y,_ as H,v as J,s as Z,x as K,M as ee,E as te,h as ae}from"./P6BhpD9n.js";import{u as oe}from"./r03zPP1m.js";import{_ as le}from"./CQ5VU_zX.js";import"./kw-g4pqB.js";import"./DjlNrOf-.js";const ne={class:"container"},re=w({__name:"edit-form",props:{updateModel:{}},setup(T,{expose:p}){const m=N(!1),S=E(()=>o.value&&k.value&&V.value),a=[{value:null,text:"Select the data source type"},...Object.values(I).map(t=>({value:t,text:t}))],o=E(()=>{var t;return m.value?!!((t=h.updateModel)!=null&&t.type):null}),k=E(()=>{var t;return m.value?!!((t=h.updateModel)!=null&&t.name):null}),V=E(()=>{var t;return m.value?!!((t=h.updateModel)!=null&&t.connStr):null}),F=(t=!0)=>{m.value=t},h=T,l=$({...h.updateModel});return p({setFormEntered:F,formValid:S,model:l}),(t,s)=>{const v=O,r=P,u=Q,M=j,g=z,_=W;return c(),C("div",ne,[e(l)?(c(),y(_,{key:0},{default:d(()=>[n(u,{label:"Name","label-for":"dataSourceName","label-class":"mb-1",class:"mb-3"},{default:d(()=>[n(v,{id:"dataSourceName",modelValue:e(l).name,"onUpdate:modelValue":s[0]||(s[0]=D=>e(l).name=D),required:"",placeholder:"Enter data source name",state:e(k)},null,8,["modelValue","state"]),n(r,{state:e(k)},{default:d(()=>[b(" Please input a data source name ")]),_:1},8,["state"])]),_:1}),n(u,{label:"Type","label-for":"dataSourceType","label-class":"mb-1",class:"mb-3"},{default:d(()=>[n(M,{id:"dataSourceType",modelValue:e(l).type,"onUpdate:modelValue":s[1]||(s[1]=D=>e(l).type=D),options:a,required:"",state:e(o)},null,8,["modelValue","state"]),n(r,{state:e(o)},{default:d(()=>[b(" Please select a data source type ")]),_:1},8,["state"])]),_:1}),n(u,{label:"Description","label-for":"dataSourceDesc","label-class":"mb-1",class:"mb-3"},{default:d(()=>[n(g,{id:"dataSourceDesc",modelValue:e(l).description,"onUpdate:modelValue":s[2]||(s[2]=D=>e(l).description=D)},null,8,["modelValue"])]),_:1}),n(u,{label:"Connection string","label-for":"dataSourceConnStr","label-class":"mb-1",class:"mb-3"},{default:d(()=>[n(g,{id:"dataSourceConnStr",modelValue:e(l).connStr,"onUpdate:modelValue":s[3]||(s[3]=D=>e(l).connStr=D),required:"",placeholder:"Enter connection string",state:e(V)},null,8,["modelValue","state"]),n(r,{state:e(V)},{default:d(()=>[b(" Please input a connection string ")]),_:1},8,["state"])]),_:1})]),_:1})):x("",!0)])}}}),se={key:0},de={class:"table-responsive"},ue={class:"table table-striped table-hover"},ce=i("thead",null,[i("tr",null,[i("th",null,"ID"),i("th",null,"Name"),i("th",null,"Type"),i("th",null,"Description"),i("th",null,"Options")])],-1),ie=i("p",null,"Are you sure you want to delete this data source?",-1),me=i("strong",null,"Name:",-1),pe={key:1,class:"alert alert-warning"},_e={key:1,class:"w-100 h-100"},fe=w({__name:"list",props:{dataSources:{}},emits:["delete","edit","copy"],setup(T,{emit:p}){const m=G(),S=N(null),a=$({open:!1,id:"edit-modal",title:"Edit data source",isLoading:!1,error:null,size:"lg",data:null,sourceId:null}),o=$({open:!1,id:"delete-modal",title:"Delete data source",isLoading:!1,error:null,size:"md",sourceName:"",sourceId:null}),k=r=>{o.sourceName=r.name,o.sourceId=r.id,o.open=!0},V=r=>{a.data={...r},a.sourceId=r.id,a.open=!0},F=()=>{a.error=null,a.data=null,a.open=!1,a.sourceId=null},h=async()=>{if(o.sourceId)try{await m.deleteDataSource(o.sourceId),v("delete",o.sourceId),o.open=!1,l()}catch(r){o.error=r instanceof Error?r.message:"An unexpected error occurred",console.error(o.error)}},l=()=>{o.error=null,o.sourceName="",o.sourceId=null},t=async()=>{if(S.value){const r=S.value;if(r.setFormEntered(!0),r.formValid&&a.sourceId&&r.model)try{const u=await m.updateDataSource(a.sourceId,r.model);v("edit",u),r.setFormEntered(!1),F()}catch(u){a.error=u instanceof Error?u.message:"An unexpected error occurred",console.error(a.error)}}},s=r=>{v("copy",r)},v=p;return(r,u)=>{const M=Y,g=H,_=J,D=Z,L=K,R=ee;return r.dataSources?(c(),C(A,{key:0},[r.dataSources.length>0?(c(),C("div",se,[i("div",de,[i("table",ue,[ce,i("tbody",null,[(c(!0),C(A,null,X(r.dataSources,f=>(c(),C("tr",{key:`tr-${f.id}`},[i("td",null,B(f.id),1),i("td",null,B(f.name),1),i("td",null,[n(M,{variant:"light"},{default:d(()=>[b(B(f.type),1)]),_:2},1024)]),i("td",null,B(f.description),1),i("td",null,[(c(),y(_,{key:`${f.id}-btn-edit`,variant:"link",title:"Edit",onClick:q=>V(f)},{default:d(()=>[n(g,{name:"material-symbols:edit-outline"})]),_:2},1032,["onClick"])),(c(),y(_,{key:`${f.id}-btn-copy`,variant:"link",title:"Copy",onClick:q=>s(f)},{default:d(()=>[n(g,{name:"material-symbols:content-copy-outline"})]),_:2},1032,["onClick"])),(c(),y(_,{key:`${f.id}-btn-delete`,variant:"link",title:"Delete",onClick:q=>k(f)},{default:d(()=>[n(g,{name:"material-symbols:delete-outline"})]),_:2},1032,["onClick"]))])]))),128))])]),(c(),y(L,{id:e(a).id,key:e(a).id,modelValue:e(a).open,"onUpdate:modelValue":u[0]||(u[0]=f=>e(a).open=f),title:e(a).title,size:e(a).size,"ok-title":"Save",onOk:U(t,["prevent"]),onHide:F},{default:d(()=>[e(a).error?(c(),y(D,{key:0,"model-value":e(a).error!=null,variant:"danger"},{default:d(()=>[b(B(e(a).error),1)]),_:1},8,["model-value"])):x("",!0),e(a).data?(c(),y(re,{id:"editForm",key:"editForm",ref_key:"editForm",ref:S,"update-model":e(a).data},null,8,["update-model"])):x("",!0)]),_:1},8,["id","modelValue","title","size"])),(c(),y(L,{id:e(o).id,key:e(o).id,modelValue:e(o).open,"onUpdate:modelValue":u[1]||(u[1]=f=>e(o).open=f),title:e(o).title,size:e(o).size,"ok-title":"Delete","ok-variant":"danger",onOk:U(h,["prevent"])},{default:d(()=>[e(o).error?(c(),y(D,{key:0,"model-value":e(o).error!=null,variant:"danger"},{default:d(()=>[b(B(e(o).error),1)]),_:1},8,["model-value"])):x("",!0),ie,i("p",null,[me,b(" "+B(e(o).sourceName),1)])]),_:1},8,["id","modelValue","title","size"]))])])):(c(),C("div",pe,"No data sources found."))],64)):(c(),C("div",_e,[n(R,{label:"Loading data sources..."})]))}}}),ve={class:"container"},ye=w({__name:"create-form",props:{createModel:{}},setup(T,{expose:p}){const m=N(!1),S=E(()=>o.value&&k.value&&V.value),a=[{value:null,text:"Select the data source type"},...Object.values(I).map(t=>({value:t,text:t}))],o=E(()=>m.value?!!l.value.type:null),k=E(()=>m.value?!!l.value.name:null),V=E(()=>m.value?!!l.value.connStr:null),F=(t=!0)=>{m.value=t},l=N({...T.createModel});return te(()=>l.value.type,t=>{t&&(t==I.SQLite?l.value.connStr="sqlite:////path/to/db":t==I.DuckDB?l.value.connStr="duckdb:////path/to/db":t==I.SQLServer?l.value.connStr="mssql+pyodbc://user:password@host:port/databasename?driver=ODBC+Driver+18+for+SQL+Server&TrustServerCertificate=yes":t==I.PostgreSQL&&(l.value.connStr="postgresql+psycopg://user:password@host:port/databasename?key=value&key=value"))}),p({setFormEntered:F,formValid:S,dataSourceCreateModel:l,model:l}),(t,s)=>{const v=O,r=P,u=Q,M=j,g=W;return c(),C("div",ve,[n(g,null,{default:d(()=>[n(u,{label:"Name","label-for":"dataSourceName","label-class":"mb-1",class:"mb-3"},{default:d(()=>[n(v,{id:"dataSourceName",modelValue:e(l).name,"onUpdate:modelValue":s[0]||(s[0]=_=>e(l).name=_),required:"",placeholder:"Enter data source name",state:e(k)},null,8,["modelValue","state"]),n(r,{state:e(k)},{default:d(()=>[b(" Please input a data source name ")]),_:1},8,["state"])]),_:1}),n(u,{label:"Type","label-for":"dataSourceType","label-class":"mb-1",class:"mb-3"},{default:d(()=>[n(M,{id:"dataSourceType",modelValue:e(l).type,"onUpdate:modelValue":s[1]||(s[1]=_=>e(l).type=_),options:a,required:"",state:e(o)},null,8,["modelValue","state"]),n(r,{state:e(o)},{default:d(()=>[b(" Please select a data source type ")]),_:1},8,["state"])]),_:1}),n(u,{label:"Description","label-for":"dataSourceDesc","label-class":"mb-1",class:"mb-3"},{default:d(()=>[n(e(z),{id:"dataSourceDesc",modelValue:e(l).description,"onUpdate:modelValue":s[2]||(s[2]=_=>e(l).description=_)},null,8,["modelValue"])]),_:1}),n(u,{label:"Connection string","label-for":"dataSourceConnStr","label-class":"mb-1",class:"mb-3"},{default:d(()=>[n(e(z),{id:"dataSourceConnStr",modelValue:e(l).connStr,"onUpdate:modelValue":s[3]||(s[3]=_=>e(l).connStr=_),required:"",placeholder:"Enter connection string",state:e(V)},null,8,["modelValue","state"]),n(r,{state:e(V)},{default:d(()=>[b(" Please input a connection string ")]),_:1},8,["state"])]),_:1})]),_:1})])}}}),be={class:"px-4 mt-3 w-100"},he=w({__name:"data-sources",setup(T){const p=N(),m=G(),S=N(null),a=$({open:!1,id:"createFormModal",title:"Add data source",isLoading:!1,size:"lg",error:null,data:null});ae(()=>{m.getDataSources().then(t=>{p.value=t}).catch(t=>{console.error(t)})});const o=()=>{a.open=!1,a.error=null,a.data=null},k=()=>{a.data={type:null,name:"",connStr:"",description:""},a.open=!0},V=async()=>{if(S.value){const t=S.value;if(t.setFormEntered(!0),t.formValid){const s=t.model;try{await m.createDataSource(s),a.open=!1,p.value=await m.getDataSources(),t.setFormEntered(!1),o()}catch(v){a.error=v instanceof Error?v.message:"An unexpected error occurred"}}}},F=t=>{p.value&&(p.value=p.value.filter(s=>s.id!==t))},h=t=>{if(p.value){const s=p.value.findIndex(v=>v.id===t.id);s!==-1&&(p.value[s]=t)}},l=t=>{a.data={type:t.type,name:t.name,connStr:t.connStr,description:t.description},a.open=!0};return oe(),(t,s)=>{const v=H,r=J,u=Z,M=K,g=fe;return c(),y(le,null,{"header-secondary":d(()=>[n(r,{variant:"outline-secondary",size:"sm",onClick:k},{default:d(()=>[n(v,{name:"material-symbols:add"}),b(" Add data source ")]),_:1}),n(M,{id:e(a).id,modelValue:e(a).open,"onUpdate:modelValue":s[0]||(s[0]=_=>e(a).open=_),title:e(a).title,size:e(a).size,"ok-title":"Create",onOk:U(V,["prevent"]),onHidden:o},{default:d(()=>[e(a).error?(c(),y(u,{key:0,"model-value":e(a).error!=null,variant:"danger"},{default:d(()=>[b(B(e(a).error),1)]),_:1},8,["model-value"])):x("",!0),e(a).data?(c(),y(ye,{key:1,id:"createForm",ref_key:"createForm",ref:S,"create-model":e(a).data},null,8,["create-model"])):x("",!0)]),_:1},8,["id","modelValue","title","size"])]),default:d(()=>[i("div",be,[n(g,{"data-sources":e(p),onCopy:l,onDelete:F,onEdit:h},null,8,["data-sources"])])]),_:1})}}});export{he as default};
