server ${SERVER}
# ${AA}
verb 3
key /etc/openvpn/pki/private/VPN.SERVERNAME.COM.key
ca /etc/openvpn/pki/ca.crt
cert /etc/openvpn/pki/issued/VPN.SERVERNAME.COM.crt
dh /etc/openvpn/pki/dh.pem
tls-auth /etc/openvpn/pki/ta.key
key-direction 0
keepalive 10 60
persist-key
persist-tun

port 1194
proto tcp
dev tun0
status /tmp/openvpn-status.log

## 由于要由openvpn进程在新客户端连接进来的时候执行iptables 脚本，所以现在使用root
#user nobody
user root
#group nogroup
group root

client-to-client
push "dhcp-option DNS 10.12.0.1"
push "block-outside-dns"
push "redirect-gateway def1"

client-config-dir /etc/openvpn/ccd
### Route Configurations Below
route 10.12.0.0 255.255.0.0
### 下面的是测试配置，应该不是必须的。
#route 172.17.0.0 255.255.0.0
#route 172.18.0.0 255.255.0.0
#route 172.19.0.0 255.255.0.0

# script-security 为3才能在环境变量中拿到密码明文
script-security 3
# 服务器端启动、停止钩子脚本
up /etc/openvpn/vpnhelper.py
down /etc/openvpn/vpnhelper.py
# 客户端连接、断开钩子脚本
client-connect /etc/openvpn/vpnhelper.py
client-disconnect /etc/openvpn/vpnhelper.py

### 试用自定义认证
auth-user-pass-verify /etc/openvpn/vpnhelper.py via-env

#auth-user-pass-verify /etc/openvpn/auth.py via-file
# Username and Password authentication.
verify-client-cert none
username-as-common-name



######
## 其他参数（测试中）

#comp-lzo



##
## 所有push 推送指令应该在对应的每个客户端ccd文件中写，因为每个终端情况不可能一样。
##
# push "route 10.12.12.0 255.255.255.0"
### Push Configurations Below
## block-outside-dns 暂时没这个必要，让window请求不了域名
## 毕竟目前仅仅是用于内网连接。
# push "block-outside-dns"
## DNS 也是应该由客户端自己来设置，这里不用管
# push "dhcp-option DNS 10.12.12.1"
# push "dhcp-option DNS 8.8.4.4"
# push "comp-lzo no"


#####################################################################################3
## 下面的还没经过测试，  不知道有什么影响
##
#定义客户端的DNS服务器地址
# push "dhcp-option DNS 192.168.228.1"
#定义客户端的WINS服务器地址
# push "dhcp-option WINS 192.168.228.1"
#让客户端发起的所有IP请求都通过OpenVPN服务器
# push "redirect-gateway def1"