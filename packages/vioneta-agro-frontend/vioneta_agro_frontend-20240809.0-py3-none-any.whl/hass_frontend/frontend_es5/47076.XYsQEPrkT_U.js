"use strict";(self.webpackChunkvioneta_agro_frontend=self.webpackChunkvioneta_agro_frontend||[]).push([[47076],{78691:function(e,t,n){var r=n(22858).A,o=n(33994).A;n.a(e,function(){var e=r(o().mark((function e(r,i){var u,a,c,s,f,l,_;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.d(t,{EO:function(){return _},ol:function(){return f},xo:function(){return l}}),u=n(35193),a=n(45269),!(c=r([u])).then){e.next=12;break}return e.next=8,c;case 8:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=13;break;case 12:e.t0=c;case 13:u=e.t0[0],s=function(e,t,n,r){var o=n((0,u.L_)(e,t),r);return o instanceof Date?(0,u.uk)(o,t):o},f=function(e,t,n,r,o){return n.time_zone===a.Wj.server?s(e,r.time_zone,t,o):t(e,o)},l=function(e,t,n,r,o){return n.time_zone===a.Wj.server?s(e,r.time_zone,t,o):t(e,o)},_=function(e,t,n,r,o){return l(e,n,r,o,r.time_zone===a.Wj.server?(0,u.L_)(t,o.time_zone):t)},i(),e.next=24;break;case 21:e.prev=21,e.t2=e.catch(0),i(e.t2);case 24:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(t,n){return e.apply(this,arguments)}}())},10469:function(e,t,n){n.d(t,{$:function(){return o}});var r=n(64782),o=(n(89655),function(e,t){var n,o={},i=(0,r.A)(e);try{for(i.s();!(n=i.n()).done;){var u=n.value,a=t(u);a in o?o[a].push(u):o[a]=[u]}}catch(c){i.e(c)}finally{i.f()}return o})},31265:function(e,t,n){n.d(t,{JW:function(){return y},TC:function(){return u},VN:function(){return a},Vx:function(){return c},XQ:function(){return _},eM:function(){return f},iH:function(){return s},k3:function(){return p},m4:function(){return o},qf:function(){return i},yv:function(){return l}});var r=n(41981),o=(n(33231),n(26098),33524==n.j?["migration_error","setup_error","setup_retry"]:null),i=33524==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,u=function(e,t,n){var r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),e.connection.subscribeMessage((function(e){return t(e)}),r)},a=function(e,t){var n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS(Object.assign({type:"config_entries/get"},n))},c=function(e,t){return e.callWS({type:"config_entries/get_single",entry_id:t})},s=function(e,t,n){return e.callWS(Object.assign({type:"config_entries/update",entry_id:t},n))},f=function(e,t){return e.callApi("DELETE","config/config_entries/entry/".concat(t))},l=function(e,t){return e.callApi("POST","config/config_entries/entry/".concat(t,"/reload"))},_=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"})},p=function(e,t){return e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null})},y=function(e,t){var n=(0,r.A)(e),o=function(e){var n=t[e.domain];return"helper"===(null==n?void 0:n.integration_type)?-1:1};return n.sort((function(e,t){return o(t)-o(e)}))}},47076:function(e,t,n){var r=n(22858).A,o=n(33994).A;n.a(e,function(){var e=r(o().mark((function e(r,i){var u,a,c,s,f,l,_,p,y,g,d,m,v,h,b,w,k,A,x,T,W,D,S,j,E,O,P,C,z,L,M,B,N,V,H,X,$,q,I,J,K,Q,G,R,U,F,Y,Z,ee,te,ne,re,oe,ie,ue,ae,ce,se,fe,le,_e,pe,ye,ge,de,me;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.d(t,{AN:function(){return ae},B2:function(){return ne},BV:function(){return te},E$:function(){return ue},GW:function(){return ee},KJ:function(){return ge},Q4:function(){return F},RB:function(){return R},WN:function(){return oe},X4:function(){return me},_d:function(){return ye},al:function(){return _e},bs:function(){return re},c:function(){return Z},m7:function(){return G},oU:function(){return Y},tb:function(){return le},uh:function(){return U},yM:function(){return de}}),u=n(658),a=n(41981),c=n(64782),s=n(33994),f=n(22858),l=n(71499),_=n(81027),p=n(82386),y=n(95737),g=n(97741),d=n(89655),m=n(26098),v=n(39790),h=n(9241),b=n(66457),w=n(36604),k=n(99019),A=n(92765),x=n(253),T=n(54846),W=n(16891),D=n(66555),S=n(96858),j=n(31195),E=n(77301),O=n(91103),P=n(39902),C=n(72730),z=n(61310),L=n(31293),M=n(63165),B=n(60132),N=n(83324),V=n(88444),H=n(78691),X=n(41924),$=n(10469),q=n(31265),I=n(4826),!(J=r([H,X])).then){e.next=67;break}return e.next=63,J;case 63:e.t1=e.sent,e.t0=(0,e.t1)(),e.next=68;break;case 67:e.t0=J;case 68:K=e.t0,H=K[0],X=K[1],Q=[],G=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},R=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},U=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},F=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},Y=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},Z=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},ee=function(){return{type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},te=function(e){return e.callWS({type:"energy/info"})},ne=33524==n.j?function(){var e=(0,f.A)((0,s.A)().mark((function e(t){return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loadBackendTranslation("issues","energy");case 2:return e.abrupt("return",t.callWS({type:"energy/validate"}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():null,re=function(e){return e.callWS({type:"energy/get_prefs"})},oe=function(){var e=(0,f.A)((0,s.A)().mark((function e(t,n){var r;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.callWS(Object.assign({type:"energy/save_prefs"},n)),se(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ie=function(){var e=(0,f.A)((0,s.A)().mark((function e(t,n,r,o,i){var u,a=arguments;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=a.length>5&&void 0!==a[5]?a[5]:"hour",e.abrupt("return",t.callWS({type:"energy/fossil_energy_consumption",start_time:n.toISOString(),end_time:null==i?void 0:i.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:u}));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),ue=function(e){return(0,$.$)(e.energy_sources,(function(e){return e.type}))},ae=function(e,t,n){var r,o=[],i=(0,c.A)(e.energy_sources);try{for(i.s();!(r=i.n()).done;){var u=r.value;if(!n||n.includes(u.type))if("solar"!==u.type)if("gas"!==u.type&&"water"!==u.type)if("battery"!==u.type){var s,f=(0,c.A)(u.flow_from);try{for(f.s();!(s=f.n()).done;){var l=s.value;o.push(l.stat_energy_from),l.stat_cost&&o.push(l.stat_cost);var _=t.cost_sensors[l.stat_energy_from];_&&o.push(_)}}catch(v){f.e(v)}finally{f.f()}var p,y=(0,c.A)(u.flow_to);try{for(y.s();!(p=y.n()).done;){var g=p.value;o.push(g.stat_energy_to),g.stat_compensation&&o.push(g.stat_compensation);var d=t.cost_sensors[g.stat_energy_to];d&&o.push(d)}}catch(v){y.e(v)}finally{y.f()}}else o.push(u.stat_energy_from),o.push(u.stat_energy_to);else{o.push(u.stat_energy_from),u.stat_cost&&o.push(u.stat_cost);var m=t.cost_sensors[u.stat_energy_from];m&&o.push(m)}else o.push(u.stat_energy_from)}}catch(v){i.e(v)}finally{i.f()}return n&&!n.includes("device")||o.push.apply(o,(0,a.A)(e.device_consumption.map((function(e){return e.stat_consumption})))),o},ce=function(){var e=(0,f.A)((0,s.A)().mark((function e(t,n,r,o,i){var f,l,_,p,y,g,d,m,v,h,b,w,k,A,x,T,W,D,S,M,B,N,V,X,$,J,K,Q,G,R,U,F,Y,Z,ee,ne,re,oe,ue,ce,se,fe,le,_e,pe,ye,ge;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([(0,q.VN)(t,{domain:"co2signal"}),te(t)]);case 2:if(f=e.sent,l=(0,u.A)(f,2),_=l[0],p=l[1],!(y=_.length?_[0]:void 0)){e.next=21;break}d=0,m=Object.values(t.entities);case 9:if(!(d<m.length)){e.next=21;break}if("co2signal"===(v=m[d]).platform){e.next=13;break}return e.abrupt("continue",18);case 13:if((h=t.states[v.entity_id])&&"%"===h.attributes.unit_of_measurement){e.next=16;break}return e.abrupt("continue",18);case 16:return g=h.entity_id,e.abrupt("break",21);case 18:d++,e.next=9;break;case 21:b=[],w=(0,c.A)(n.energy_sources);try{for(w.s();!(k=w.n()).done;)if("grid"===(A=k.value).type){x=(0,c.A)(A.flow_from);try{for(x.s();!(T=x.n()).done;)W=T.value,b.push(W.stat_energy_from)}catch(s){x.e(s)}finally{x.f()}}}catch(s){w.e(s)}finally{w.f()}return D=ae(n,p,["grid","solar","battery","gas","device"]),S=ae(n,p,["water"]),M=[].concat((0,a.A)(D),(0,a.A)(S)),B=(0,j.c)(o||new Date,r),N=B>35?"month":B>2?"day":"hour",V=t.config.unit_system.length||"",X={energy:"kWh",volume:"km"===V?"m³":"ft³"},$={volume:"km"===V?"L":"gal"},J=D.length?(0,I.sz)(t,r,o,D,N,X,["change"]):{},K=S.length?(0,I.sz)(t,r,o,S,N,$,["change"]):{},U={},F={},i&&(G=(0,H.xo)(r,E.e,t.locale,t.config)&&(0,H.xo)(o||new Date,O.c,t.locale,t.config)?(0,H.ol)(r,P.P,t.locale,t.config,-(0,H.EO)(o||new Date,r,C.W,t.locale,t.config)-1):(0,H.ol)(r,z.f,t.locale,t.config,-1*(B+1)),R=(0,L.A)(r,-1),D.length&&(U=(0,I.sz)(t,G,R,D,N,X,["change"])),S.length&&(F=(0,I.sz)(t,G,R,S,N,$,["change"]))),void 0!==g&&(Y=ie(t,r,b,g,o,B>35?"month":B>2?"day":"hour"),i&&(Z=ie(t,G,b,g,R,B>35?"month":B>2?"day":"hour"))),ee={},ne=M.length?(0,I.Wr)(t,M):[],e.next=42,Promise.all([J,K,U,F,ne,Y,Z]);case 42:return re=e.sent,oe=(0,u.A)(re,7),ue=oe[0],ce=oe[1],se=oe[2],fe=oe[3],le=oe[4],_e=oe[5],pe=oe[6],ye=Object.assign(Object.assign({},ue),ce),i&&(Q=Object.assign(Object.assign({},se),fe)),M.length&&le.forEach((function(e){ee[e.statistic_id]=e})),ge={start:r,end:o,startCompare:G,endCompare:R,info:p,prefs:n,stats:ye,statsMetadata:ee,statsCompare:Q,co2SignalConfigEntry:y,co2SignalEntity:g,fossilEnergyConsumption:_e,fossilEnergyConsumptionCompare:pe},e.abrupt("return",ge);case 56:case"end":return e.stop()}}),e)})));return function(t,n,r,o,i){return e.apply(this,arguments)}}(),se=function(e){Q.forEach((function(t){var n=le(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},fe=function(e){if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){var t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((function(){return e.refresh()}),t.getTime()-Date.now())}},le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n="_".concat(t.key)}if(e.connection[n])return e.connection[n];Q.push(t.key);var r=(0,V.X)(e.connection,n,(0,f.A)((0,s.A)().mark((function t(){return(0,s.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.prefs){t.next=4;break}return t.next=3,re(e);case 3:r.prefs=t.sent;case 4:return fe(r),t.abrupt("return",ce(e,r.prefs,r.start,r.end,r.compare));case 6:case"end":return t.stop()}}),t)})))),o=r.subscribe;r.subscribe=function(e){var t=o(e);return r._active++,void 0===r._refreshTimeout&&fe(r),function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),t()}},r._active=0,r.prefs=t.prefs;var i=new Date,u=(0,X.LW)(i,e.locale,e.config).split(":")[0];r.start=(0,H.ol)("0"===u?(0,z.f)(i,-1):i,M.o,e.locale,e.config),r.end=(0,H.ol)("0"===u?(0,z.f)(i,-1):i,B.D,e.locale,e.config);var a=function(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,H.ol)(new Date,M.o,e.locale,e.config),r.end=(0,H.ol)(new Date,B.D,e.locale,e.config),a()}),(0,N.L)((0,H.ol)(i,B.D,e.locale,e.config),1).getTime()-Date.now())};return a(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(t,n){var o;r.start=t,r.end=n,r.start.getTime()!==(0,H.ol)(new Date,M.o,e.locale,e.config).getTime()||(null===(o=r.end)||void 0===o?void 0:o.getTime())!==(0,H.ol)(new Date,B.D,e.locale,e.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):a()},r.setCompare=function(e){r.compare=e},r},_e=function(e){return e.callWS({type:"energy/solar_forecast"})},pe=["volume","energy"],ye=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=(0,c.A)(e.energy_sources);try{for(o.s();!(t=o.n()).done;){var i=t.value;if("gas"===i.type&&(!r||r!==i.stat_energy_from)){var u=n[i.stat_energy_from];if(pe.includes(null==u?void 0:u.unit_class))return u.unit_class}}}catch(a){o.e(a)}finally{o.f()}},ge=function(e,t){var n=ye(t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{});if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m³":"ft³"},de=function(e){return"km"===e.config.unit_system.length?"L":"gal"},me="/docs/energy/faq/#troubleshooting-missing-entities",i(),e.next=102;break;case 99:e.prev=99,e.t2=e.catch(0),i(e.t2);case 102:case"end":return e.stop()}}),e,null,[[0,99]])})));return function(t,n){return e.apply(this,arguments)}}())}}]);
//# sourceMappingURL=47076.XYsQEPrkT_U.js.map