export const id=14604;export const ids=[14604,13265];export const modules={78691:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{EO:()=>y,ol:()=>c,xo:()=>l});var o=n(35193),s=n(45269),a=e([o]);o=(a.then?(await a)():a)[0];const i=(e,t,n,r)=>{const s=n((0,o.L_)(e,t),r);return s instanceof Date?(0,o.uk)(s,t):s},c=(e,t,n,r,o)=>n.time_zone===s.Wj.server?i(e,r.time_zone,t,o):t(e,o),l=(e,t,n,r,o)=>n.time_zone===s.Wj.server?i(e,r.time_zone,t,o):t(e,o),y=(e,t,n,r,a)=>l(e,n,r,a,r.time_zone===s.Wj.server?(0,o.L_)(t,a.time_zone):t);r()}catch(e){r(e)}}))},41924:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{LW:()=>p,Xs:()=>u,fU:()=>l,ie:()=>g});var o=n(13265),s=n(94100),a=n(35638),i=n(3453),c=e([o,a]);[o,a]=c.then?(await c)():c;const l=(e,t,n)=>y(t,n.time_zone).format(e),y=(0,s.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{hour:"numeric",minute:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),g=(e,t,n)=>_(t,n.time_zone).format(e),_=(0,s.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{hour:(0,i.J)(e)?"numeric":"2-digit",minute:"2-digit",second:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),u=(e,t,n)=>d(t,n.time_zone).format(e),d=(0,s.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{weekday:"long",hour:(0,i.J)(e)?"numeric":"2-digit",minute:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),p=(e,t,n)=>m(t,n.time_zone).format(e),m=(0,s.A)(((e,t)=>new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"2-digit",hour12:!1,timeZone:(0,a.w)(e.time_zone,t)})));r()}catch(e){r(e)}}))},35638:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{n:()=>i,w:()=>c});var o=n(13265),s=n(45269),a=e([o]);o=(a.then?(await a)():a)[0];const i=Intl.DateTimeFormat?.().resolvedOptions?.().timeZone??"UTC",c=(e,t)=>e===s.Wj.local&&"UTC"!==i?i:t;r()}catch(e){r(e)}}))},3453:(e,t,n)=>{n.d(t,{J:()=>s});var r=n(94100),o=n(45269);const s=(0,r.A)((e=>{if(e.time_format===o.Hg.language||e.time_format===o.Hg.system){const t=e.time_format===o.Hg.language?e.language:void 0;return new Date("January 1, 2023 22:00:00").toLocaleString(t).includes("10")}return e.time_format===o.Hg.am_pm}))},10469:(e,t,n)=>{n.d(t,{$:()=>r});n(89655);const r=(e,t)=>{const n={};for(const r of e){const e=t(r);e in n?n[e].push(r):n[e]=[r]}return n}},31265:(e,t,n)=>{n.d(t,{JW:()=>u,TC:()=>s,VN:()=>a,Vx:()=>i,XQ:()=>g,eM:()=>l,iH:()=>c,k3:()=>_,m4:()=>r,qf:()=>o,yv:()=>y});const r=33524==n.j?["migration_error","setup_error","setup_retry"]:null,o=33524==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,s=(e,t,n)=>{const r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),e.connection.subscribeMessage((e=>t(e)),r)},a=(e,t)=>{const n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS({type:"config_entries/get",...n})},i=(e,t)=>e.callWS({type:"config_entries/get_single",entry_id:t}),c=(e,t,n)=>e.callWS({type:"config_entries/update",entry_id:t,...n}),l=(e,t)=>e.callApi("DELETE",`config/config_entries/entry/${t}`),y=(e,t)=>e.callApi("POST",`config/config_entries/entry/${t}/reload`),g=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"}),_=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null}),u=(e,t)=>{const n=[...e],r=e=>{const n=t[e.domain];return"helper"===n?.integration_type?-1:1};return n.sort(((e,t)=>r(t)-r(e)))}},47076:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{AN:()=>j,B2:()=>C,BV:()=>E,E$:()=>L,GW:()=>S,KJ:()=>B,Q4:()=>W,RB:()=>k,WN:()=>A,X4:()=>V,_d:()=>F,al:()=>O,bs:()=>Z,c:()=>P,m7:()=>T,oU:()=>D,tb:()=>M,uh:()=>z,yM:()=>N});n(89655),n(253),n(54846),n(16891);var o=n(31195),s=n(77301),a=n(91103),i=n(39902),c=n(72730),l=n(61310),y=n(31293),g=n(63165),_=n(60132),u=n(83324),d=n(88444),p=n(78691),m=n(41924),h=n(10469),f=n(31265),w=n(4826),b=e([p,m]);[p,m]=b.then?(await b)():b;const v=[],T=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),k=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),z=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),W=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),D=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),P=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),S=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),E=e=>e.callWS({type:"energy/info"}),C=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),Z=e=>e.callWS({type:"energy/get_prefs"}),A=async(e,t)=>{const n=e.callWS({type:"energy/save_prefs",...t});return H(e),n},J=async(e,t,n,r,o,s="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:o?.toISOString(),energy_statistic_ids:n,co2_statistic_id:r,period:s}),L=e=>(0,h.$)(e.energy_sources,(e=>e.type)),j=(e,t,n)=>{const r=[];for(const o of e.energy_sources)if(!n||n.includes(o.type))if("solar"!==o.type)if("gas"!==o.type&&"water"!==o.type)if("battery"!==o.type){for(const e of o.flow_from){r.push(e.stat_energy_from),e.stat_cost&&r.push(e.stat_cost);const n=t.cost_sensors[e.stat_energy_from];n&&r.push(n)}for(const e of o.flow_to){r.push(e.stat_energy_to),e.stat_compensation&&r.push(e.stat_compensation);const n=t.cost_sensors[e.stat_energy_to];n&&r.push(n)}}else r.push(o.stat_energy_from),r.push(o.stat_energy_to);else{r.push(o.stat_energy_from),o.stat_cost&&r.push(o.stat_cost);const e=t.cost_sensors[o.stat_energy_from];e&&r.push(e)}else r.push(o.stat_energy_from);return n&&!n.includes("device")||r.push(...e.device_consumption.map((e=>e.stat_consumption))),r},x=async(e,t,n,r,g)=>{const[_,u]=await Promise.all([(0,f.VN)(e,{domain:"co2signal"}),E(e)]),d=_.length?_[0]:void 0;let m;if(d)for(const t of Object.values(e.entities)){if("co2signal"!==t.platform)continue;const n=e.states[t.entity_id];if(n&&"%"===n.attributes.unit_of_measurement){m=n.entity_id;break}}const h=[];for(const e of t.energy_sources)if("grid"===e.type)for(const t of e.flow_from)h.push(t.stat_energy_from);const b=j(t,u,["grid","solar","battery","gas","device"]),v=j(t,u,["water"]),T=[...b,...v],k=(0,o.c)(r||new Date,n),z=k>35?"month":k>2?"day":"hour",W=e.config.unit_system.length||"",D={energy:"kWh",volume:"km"===W?"m続":"ft続"},P={volume:"km"===W?"L":"gal"},S=b.length?(0,w.sz)(e,n,r,b,z,D,["change"]):{},C=v.length?(0,w.sz)(e,n,r,v,z,P,["change"]):{};let Z,A,L,x,H,I={},M={};g&&(A=(0,p.xo)(n,s.e,e.locale,e.config)&&(0,p.xo)(r||new Date,a.c,e.locale,e.config)?(0,p.ol)(n,i.P,e.locale,e.config,-(0,p.EO)(r||new Date,n,c.W,e.locale,e.config)-1):(0,p.ol)(n,l.f,e.locale,e.config,-1*(k+1)),L=(0,y.A)(n,-1),b.length&&(I=(0,w.sz)(e,A,L,b,z,D,["change"])),v.length&&(M=(0,w.sz)(e,A,L,v,z,P,["change"]))),void 0!==m&&(x=J(e,n,h,m,r,k>35?"month":k>2?"day":"hour"),g&&(H=J(e,A,h,m,L,k>35?"month":k>2?"day":"hour")));const O={},$=T.length?(0,w.Wr)(e,T):[],[F,B,N,V,U,X,K]=await Promise.all([S,C,I,M,$,x,H]),q={...F,...B};g&&(Z={...N,...V}),T.length&&U.forEach((e=>{O[e.statistic_id]=e}));return{start:n,end:r,startCompare:A,endCompare:L,info:u,prefs:t,stats:q,statsMetadata:O,statsCompare:Z,co2SignalConfigEntry:d,co2SignalEntity:m,fossilEnergyConsumption:X,fossilEnergyConsumptionCompare:K}},H=e=>{v.forEach((t=>{const n=M(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},I=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},M=(e,t={})=>{let n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n=`_${t.key}`}if(e.connection[n])return e.connection[n];v.push(t.key);const r=(0,d.X)(e.connection,n,(async()=>(r.prefs||(r.prefs=await Z(e)),I(r),x(e,r.prefs,r.start,r.end,r.compare)))),o=r.subscribe;r.subscribe=e=>{const t=o(e);return r._active++,void 0===r._refreshTimeout&&I(r),()=>{r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),t()}},r._active=0,r.prefs=t.prefs;const s=new Date,a=(0,m.LW)(s,e.locale,e.config).split(":")[0];r.start=(0,p.ol)("0"===a?(0,l.f)(s,-1):s,g.o,e.locale,e.config),r.end=(0,p.ol)("0"===a?(0,l.f)(s,-1):s,_.D,e.locale,e.config);const i=()=>{r._updatePeriodTimeout=window.setTimeout((()=>{r.start=(0,p.ol)(new Date,g.o,e.locale,e.config),r.end=(0,p.ol)(new Date,_.D,e.locale,e.config),i()}),(0,u.L)((0,p.ol)(s,_.D,e.locale,e.config),1).getTime()-Date.now())};return i(),r.clearPrefs=()=>{r.prefs=void 0},r.setPeriod=(t,n)=>{r.start=t,r.end=n,r.start.getTime()!==(0,p.ol)(new Date,g.o,e.locale,e.config).getTime()||r.end?.getTime()!==(0,p.ol)(new Date,_.D,e.locale,e.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):i()},r.setCompare=e=>{r.compare=e},r},O=e=>e.callWS({type:"energy/solar_forecast"}),$=["volume","energy"],F=(e,t={},n)=>{for(const r of e.energy_sources){if("gas"!==r.type)continue;if(n&&n===r.stat_energy_from)continue;const e=t[r.stat_energy_from];if($.includes(e?.unit_class))return e.unit_class}},B=(e,t,n={})=>{const r=F(t,n);if(void 0!==r)return"energy"===r?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},N=e=>"km"===e.config.unit_system.length?"L":"gal",V="/docs/energy/faq/#troubleshooting-missing-entities";r()}catch(e){r(e)}}))},14604:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.r(t),n.d(t,{EnergyViewStrategy:()=>y});var o=n(36312),s=(n(89655),n(253),n(94438),n(4525),n(15112)),a=n(77706),i=n(47076),c=e([i]);i=(c.then?(await c)():c)[0];const l=async()=>(await Promise.all([n.e(58587),n.e(90548)]).then(n.bind(n,93725)),{type:"panel",cards:[{type:"custom:energy-setup-wizard-card"}]});let y=(0,o.A)([(0,a.EM)("energy-view-strategy")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"method",static:!0,key:"generate",value:async function(e,t){const n={cards:[]};let r;try{r=await(0,i.bs)(t)}catch(e){return"not_found"===e.code?l():(n.cards.push({type:"markdown",content:`An error occurred while fetching your energy preferences: ${e.message}.`}),n)}if(0===r.device_consumption.length&&0===r.energy_sources.length)return l();n.type="sidebar";const o=r.energy_sources.find((e=>"grid"===e.type&&(e.flow_from?.length||e.flow_to?.length))),s=o&&o.flow_to.length,a=r.energy_sources.some((e=>"solar"===e.type)),c=r.energy_sources.some((e=>"gas"===e.type)),y=r.energy_sources.some((e=>"water"===e.type));return n.cards.push({type:"energy-compare",collection_key:"energy_dashboard"}),o&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_usage_graph_title"),type:"energy-usage-graph",collection_key:"energy_dashboard"}),a&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_solar_graph_title"),type:"energy-solar-graph",collection_key:"energy_dashboard"}),c&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_gas_graph_title"),type:"energy-gas-graph",collection_key:"energy_dashboard"}),y&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_water_graph_title"),type:"energy-water-graph",collection_key:"energy_dashboard"}),o&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_distribution_title"),type:"energy-distribution",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),(o||a||c||y)&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_sources_table_title"),type:"energy-sources-table",collection_key:"energy_dashboard"}),s&&n.cards.push({type:"energy-grid-neutrality-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),a&&s&&(n.cards.push({type:"energy-solar-consumed-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),n.cards.push({type:"energy-self-sufficiency-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"})),o&&n.cards.push({type:"energy-carbon-consumed-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),r.device_consumption.length&&(n.cards.push({title:t.localize("ui.panel.energy.cards.energy_devices_detail_graph_title"),type:"energy-devices-detail-graph",collection_key:"energy_dashboard"}),n.cards.push({title:t.localize("ui.panel.energy.cards.energy_devices_graph_title"),type:"energy-devices-graph",collection_key:"energy_dashboard"})),n}}]}}),s.mN);r()}catch(e){r(e)}}))},13265:(e,t,n)=>{n.a(e,(async(e,t)=>{try{n(89655);var r=n(4604),o=n(41344),s=n(51141),a=n(5269),i=n(12124),c=n(78008),l=n(12653),y=n(74264),g=n(48815),_=n(44129);const e=async()=>{const e=(0,g.wb)(),t=[];(0,s.Z)()&&await Promise.all([n.e(17500),n.e(59699)]).then(n.bind(n,59699)),(0,i.Z)()&&await Promise.all([n.e(97555),n.e(17500),n.e(70548)]).then(n.bind(n,70548)),(0,r.Z)(e)&&t.push(Promise.all([n.e(97555),n.e(43028)]).then(n.bind(n,43028)).then((()=>(0,_.T)()))),(0,o.Z6)(e)&&t.push(Promise.all([n.e(97555),n.e(24904)]).then(n.bind(n,24904))),(0,a.Z)(e)&&t.push(Promise.all([n.e(97555),n.e(70307)]).then(n.bind(n,70307))),(0,c.Z)(e)&&t.push(Promise.all([n.e(97555),n.e(56336)]).then(n.bind(n,56336))),(0,l.Z)(e)&&t.push(Promise.all([n.e(97555),n.e(50027)]).then(n.bind(n,50027)).then((()=>n.e(99135).then(n.t.bind(n,99135,23))))),(0,y.Z)(e)&&t.push(Promise.all([n.e(97555),n.e(36368)]).then(n.bind(n,36368))),0!==t.length&&await Promise.all(t).then((()=>(0,_.K)(e)))};await e(),t()}catch(e){t(e)}}),1)}};
//# sourceMappingURL=14604.3K3T3aEqADE.js.map