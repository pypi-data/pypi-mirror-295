export const id=18862;export const ids=[18862,56721];export const modules={78691:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{EO:()=>u,ol:()=>c,xo:()=>l});var o=s(35193),r=s(45269),i=e([o]);o=(i.then?(await i)():i)[0];const a=(e,t,s,n)=>{const r=s((0,o.L_)(e,t),n);return r instanceof Date?(0,o.uk)(r,t):r},c=(e,t,s,n,o)=>s.time_zone===r.Wj.server?a(e,n.time_zone,t,o):t(e,o),l=(e,t,s,n,o)=>s.time_zone===r.Wj.server?a(e,n.time_zone,t,o):t(e,o),u=(e,t,s,n,i)=>l(e,s,n,i,n.time_zone===r.Wj.server?(0,o.L_)(t,i.time_zone):t);n()}catch(e){n(e)}}))},10469:(e,t,s)=>{s.d(t,{$:()=>n});s(89655);const n=(e,t)=>{const s={};for(const n of e){const e=t(n);e in s?s[e].push(n):s[e]=[n]}return s}},31265:(e,t,s)=>{s.d(t,{JW:()=>f,TC:()=>r,VN:()=>i,Vx:()=>a,XQ:()=>d,eM:()=>l,iH:()=>c,k3:()=>_,m4:()=>n,qf:()=>o,yv:()=>u});const n=33524==s.j?["migration_error","setup_error","setup_retry"]:null,o=33524==s.j?["not_loaded","loaded","setup_error","setup_retry"]:null,r=(e,t,s)=>{const n={type:"config_entries/subscribe"};return s&&s.type&&(n.type_filter=s.type),e.connection.subscribeMessage((e=>t(e)),n)},i=(e,t)=>{const s={};return t&&(t.type&&(s.type_filter=t.type),t.domain&&(s.domain=t.domain)),e.callWS({type:"config_entries/get",...s})},a=(e,t)=>e.callWS({type:"config_entries/get_single",entry_id:t}),c=(e,t,s)=>e.callWS({type:"config_entries/update",entry_id:t,...s}),l=(e,t)=>e.callApi("DELETE",`config/config_entries/entry/${t}`),u=(e,t)=>e.callApi("POST",`config/config_entries/entry/${t}/reload`),d=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"}),_=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null}),f=(e,t)=>{const s=[...e],n=e=>{const s=t[e.domain];return"helper"===s?.integration_type?-1:1};return s.sort(((e,t)=>n(t)-n(e)))}},47076:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.d(t,{AN:()=>A,B2:()=>z,BV:()=>P,E$:()=>N,GW:()=>M,KJ:()=>R,Q4:()=>D,RB:()=>C,WN:()=>q,X4:()=>V,_d:()=>O,al:()=>L,bs:()=>E,c:()=>W,m7:()=>w,oU:()=>T,tb:()=>F,uh:()=>S,yM:()=>B});s(89655),s(253),s(54846),s(16891);var o=s(31195),r=s(77301),i=s(91103),a=s(39902),c=s(72730),l=s(61310),u=s(31293),d=s(63165),_=s(60132),f=s(83324),h=s(88444),y=s(78691),g=s(41924),m=s(10469),p=s(31265),k=s(4826),v=e([y,g]);[y,g]=v.then?(await v)():v;const b=[],w=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),C=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),S=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),D=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),T=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),W=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),M=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),P=e=>e.callWS({type:"energy/info"}),z=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),E=e=>e.callWS({type:"energy/get_prefs"}),q=async(e,t)=>{const s=e.callWS({type:"energy/save_prefs",...t});return x(e),s},$=async(e,t,s,n,o,r="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:o?.toISOString(),energy_statistic_ids:s,co2_statistic_id:n,period:r}),N=e=>(0,m.$)(e.energy_sources,(e=>e.type)),A=(e,t,s)=>{const n=[];for(const o of e.energy_sources)if(!s||s.includes(o.type))if("solar"!==o.type)if("gas"!==o.type&&"water"!==o.type)if("battery"!==o.type){for(const e of o.flow_from){n.push(e.stat_energy_from),e.stat_cost&&n.push(e.stat_cost);const s=t.cost_sensors[e.stat_energy_from];s&&n.push(s)}for(const e of o.flow_to){n.push(e.stat_energy_to),e.stat_compensation&&n.push(e.stat_compensation);const s=t.cost_sensors[e.stat_energy_to];s&&n.push(s)}}else n.push(o.stat_energy_from),n.push(o.stat_energy_to);else{n.push(o.stat_energy_from),o.stat_cost&&n.push(o.stat_cost);const e=t.cost_sensors[o.stat_energy_from];e&&n.push(e)}else n.push(o.stat_energy_from);return s&&!s.includes("device")||n.push(...e.device_consumption.map((e=>e.stat_consumption))),n},H=async(e,t,s,n,d)=>{const[_,f]=await Promise.all([(0,p.VN)(e,{domain:"co2signal"}),P(e)]),h=_.length?_[0]:void 0;let g;if(h)for(const t of Object.values(e.entities)){if("co2signal"!==t.platform)continue;const s=e.states[t.entity_id];if(s&&"%"===s.attributes.unit_of_measurement){g=s.entity_id;break}}const m=[];for(const e of t.energy_sources)if("grid"===e.type)for(const t of e.flow_from)m.push(t.stat_energy_from);const v=A(t,f,["grid","solar","battery","gas","device"]),b=A(t,f,["water"]),w=[...v,...b],C=(0,o.c)(n||new Date,s),S=C>35?"month":C>2?"day":"hour",D=e.config.unit_system.length||"",T={energy:"kWh",volume:"km"===D?"m続":"ft続"},W={volume:"km"===D?"L":"gal"},M=v.length?(0,k.sz)(e,s,n,v,S,T,["change"]):{},z=b.length?(0,k.sz)(e,s,n,b,S,W,["change"]):{};let E,q,N,H,x,Y={},F={};d&&(q=(0,y.xo)(s,r.e,e.locale,e.config)&&(0,y.xo)(n||new Date,i.c,e.locale,e.config)?(0,y.ol)(s,a.P,e.locale,e.config,-(0,y.EO)(n||new Date,s,c.W,e.locale,e.config)-1):(0,y.ol)(s,l.f,e.locale,e.config,-1*(C+1)),N=(0,u.A)(s,-1),v.length&&(Y=(0,k.sz)(e,q,N,v,S,T,["change"])),b.length&&(F=(0,k.sz)(e,q,N,b,S,W,["change"]))),void 0!==g&&(H=$(e,s,m,g,n,C>35?"month":C>2?"day":"hour"),d&&(x=$(e,q,m,g,N,C>35?"month":C>2?"day":"hour")));const L={},j=w.length?(0,k.Wr)(e,w):[],[O,R,B,V,X,Z,I]=await Promise.all([M,z,Y,F,j,H,x]),J={...O,...R};d&&(E={...B,...V}),w.length&&X.forEach((e=>{L[e.statistic_id]=e}));return{start:s,end:n,startCompare:q,endCompare:N,info:f,prefs:t,stats:J,statsMetadata:L,statsCompare:E,co2SignalConfigEntry:h,co2SignalEntity:g,fossilEnergyConsumption:Z,fossilEnergyConsumptionCompare:I}},x=e=>{b.forEach((t=>{const s=F(e,{key:t});s.clearPrefs(),s._active&&s.refresh()}))},Y=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},F=(e,t={})=>{let s="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");s=`_${t.key}`}if(e.connection[s])return e.connection[s];b.push(t.key);const n=(0,h.X)(e.connection,s,(async()=>(n.prefs||(n.prefs=await E(e)),Y(n),H(e,n.prefs,n.start,n.end,n.compare)))),o=n.subscribe;n.subscribe=e=>{const t=o(e);return n._active++,void 0===n._refreshTimeout&&Y(n),()=>{n._active--,n._active<1&&(clearTimeout(n._refreshTimeout),n._refreshTimeout=void 0),t()}},n._active=0,n.prefs=t.prefs;const r=new Date,i=(0,g.LW)(r,e.locale,e.config).split(":")[0];n.start=(0,y.ol)("0"===i?(0,l.f)(r,-1):r,d.o,e.locale,e.config),n.end=(0,y.ol)("0"===i?(0,l.f)(r,-1):r,_.D,e.locale,e.config);const a=()=>{n._updatePeriodTimeout=window.setTimeout((()=>{n.start=(0,y.ol)(new Date,d.o,e.locale,e.config),n.end=(0,y.ol)(new Date,_.D,e.locale,e.config),a()}),(0,f.L)((0,y.ol)(r,_.D,e.locale,e.config),1).getTime()-Date.now())};return a(),n.clearPrefs=()=>{n.prefs=void 0},n.setPeriod=(t,s)=>{n.start=t,n.end=s,n.start.getTime()!==(0,y.ol)(new Date,d.o,e.locale,e.config).getTime()||n.end?.getTime()!==(0,y.ol)(new Date,_.D,e.locale,e.config).getTime()||n._updatePeriodTimeout?n._updatePeriodTimeout&&(clearTimeout(n._updatePeriodTimeout),n._updatePeriodTimeout=void 0):a()},n.setCompare=e=>{n.compare=e},n},L=e=>e.callWS({type:"energy/solar_forecast"}),j=["volume","energy"],O=(e,t={},s)=>{for(const n of e.energy_sources){if("gas"!==n.type)continue;if(s&&s===n.stat_energy_from)continue;const e=t[n.stat_energy_from];if(j.includes(e?.unit_class))return e.unit_class}},R=(e,t,s={})=>{const n=O(t,s);if(void 0!==n)return"energy"===n?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},B=e=>"km"===e.config.unit_system.length?"L":"gal",V="/docs/energy/faq/#troubleshooting-missing-entities";n()}catch(e){n(e)}}))},20712:(e,t,s)=>{s.d(t,{E:()=>i});var n=s(36312),o=s(68689),r=s(77706);const i=e=>(0,n.A)(null,(function(e,t){class s extends t{constructor(...t){super(...t),e(this)}}return{F:s,d:[{kind:"field",decorators:[(0,r.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",key:"hassSubscribeRequiredHostProps",value:void 0},{kind:"field",key:"__unsubs",value:void 0},{kind:"method",key:"connectedCallback",value:function(){(0,o.A)(s,"connectedCallback",this,3)([]),this.__checkSubscribed()}},{kind:"method",key:"disconnectedCallback",value:function(){if((0,o.A)(s,"disconnectedCallback",this,3)([]),this.__unsubs){for(;this.__unsubs.length;){const e=this.__unsubs.pop();e instanceof Promise?e.then((e=>e())):e()}this.__unsubs=void 0}}},{kind:"method",key:"updated",value:function(e){if((0,o.A)(s,"updated",this,3)([e]),e.has("hass"))this.__checkSubscribed();else if(this.hassSubscribeRequiredHostProps)for(const t of e.keys())if(this.hassSubscribeRequiredHostProps.includes(t))return void this.__checkSubscribed()}},{kind:"method",key:"hassSubscribe",value:function(){return[]}},{kind:"method",key:"__checkSubscribed",value:function(){void 0===this.__unsubs&&this.isConnected&&void 0!==this.hass&&!this.hassSubscribeRequiredHostProps?.some((e=>void 0===this[e]))&&(this.__unsubs=this.hassSubscribe())}}]}}),e)},18862:(e,t,s)=>{s.a(e,(async(e,n)=>{try{s.r(t),s.d(t,{HuiEnergyCompareCard:()=>h});var o=s(36312),r=s(31195),i=s(60132),a=s(15112),c=s(77706),l=s(57289),u=s(47076),d=s(20712),_=s(7934),f=e([l,u]);[l,u]=f.then?(await f)():f;let h=(0,o.A)([(0,c.EM)("hui-energy-compare-card")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"field",decorators:[(0,c.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_start",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_end",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_startCompare",value:void 0},{kind:"field",decorators:[(0,c.wk)()],key:"_endCompare",value:void 0},{kind:"field",decorators:[(0,c.MZ)({type:Boolean,reflect:!0})],key:"hidden",value:()=>!0},{kind:"method",key:"getCardSize",value:function(){return 1}},{kind:"method",key:"setConfig",value:function(e){this._config=e}},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"hassSubscribe",value:function(){return[(0,u.tb)(this.hass,{key:this._config.collection_key}).subscribe((e=>this._update(e)))]}},{kind:"method",key:"shouldUpdate",value:function(e){return(0,_.xP)(this,e)||e.size>1||!e.has("hass")}},{kind:"method",key:"render",value:function(){if(!this._startCompare||!this._endCompare)return a.s6;const e=(0,r.c)(this._endCompare,this._startCompare);return a.qy` <ha-alert dismissable @alert-dismissed-clicked="${this._stopCompare}"> ${this.hass.localize("ui.panel.energy.compare.info",{start:a.qy`<b>${(0,l.Yq)(this._start,this.hass.locale,this.hass.config)}${e>0?` -\n          ${(0,l.Yq)(this._end||(0,i.D)(new Date),this.hass.locale,this.hass.config)}`:""}</b>`,end:a.qy`<b>${(0,l.Yq)(this._startCompare,this.hass.locale,this.hass.config)}${e>0?` -\n          ${(0,l.Yq)(this._endCompare,this.hass.locale,this.hass.config)}`:""}</b>`})} </ha-alert> `}},{kind:"method",key:"_update",value:function(e){this._start=e.start,this._end=e.end,this._startCompare=e.startCompare,this._endCompare=e.endCompare,this.hidden=!this._startCompare}},{kind:"method",key:"_stopCompare",value:function(){const e=(0,u.tb)(this.hass,{key:this._config.collection_key});e.setCompare(!1),e.refresh()}},{kind:"get",static:!0,key:"styles",value:function(){return a.AH`mwc-button{width:max-content}`}}]}}),(0,d.E)(a.WF));n()}catch(e){n(e)}}))},61310:(e,t,s)=>{s.d(t,{f:()=>r});var n=s(30429),o=s(59613);function r(e,t){const s=(0,n.a)(e);return isNaN(t)?(0,o.w)(e,NaN):t?(s.setDate(s.getDate()+t),s):s}},83324:(e,t,s)=>{s.d(t,{L:()=>r});var n=s(31293),o=s(3941);function r(e,t){return(0,n.A)(e,t*o.s0)}},31293:(e,t,s)=>{s.d(t,{A:()=>r});var n=s(30429),o=s(59613);function r(e,t){const s=+(0,n.a)(e);return(0,o.w)(e,s+t)}},39902:(e,t,s)=>{s.d(t,{P:()=>r});var n=s(30429),o=s(59613);function r(e,t){const s=(0,n.a)(e);if(isNaN(t))return(0,o.w)(e,NaN);if(!t)return s;const r=s.getDate(),i=(0,o.w)(e,s.getTime());i.setMonth(s.getMonth()+t+1,0);return r>=i.getDate()?i:(s.setFullYear(i.getFullYear(),i.getMonth(),r),s)}},24226:(e,t,s)=>{s.d(t,{z:()=>o});var n=s(30429);function o(e,t){const s=(0,n.a)(e),o=(0,n.a)(t),r=s.getTime()-o.getTime();return r<0?-1:r>0?1:r}},72730:(e,t,s)=>{s.d(t,{W:()=>a});var n=s(24226),o=s(30429);function r(e,t){const s=(0,o.a)(e),n=(0,o.a)(t);return 12*(s.getFullYear()-n.getFullYear())+(s.getMonth()-n.getMonth())}var i=s(91103);function a(e,t){const s=(0,o.a)(e),a=(0,o.a)(t),c=(0,n.z)(s,a),l=Math.abs(r(s,a));let u;if(l<1)u=0;else{1===s.getMonth()&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-c*l);let t=(0,n.z)(s,a)===-c;(0,i.c)((0,o.a)(e))&&1===l&&1===(0,n.z)(e,a)&&(t=!1),u=c*(l-Number(t))}return 0===u?0:u}},60132:(e,t,s)=>{s.d(t,{D:()=>o});var n=s(30429);function o(e){const t=(0,n.a)(e);return t.setHours(23,59,59,999),t}},12152:(e,t,s)=>{s.d(t,{p:()=>o});var n=s(30429);function o(e){const t=(0,n.a)(e),s=t.getMonth();return t.setFullYear(t.getFullYear(),s+1,0),t.setHours(23,59,59,999),t}},77301:(e,t,s)=>{s.d(t,{e:()=>o});var n=s(30429);function o(e){return 1===(0,n.a)(e).getDate()}},91103:(e,t,s)=>{s.d(t,{c:()=>i});var n=s(60132),o=s(12152),r=s(30429);function i(e){const t=(0,r.a)(e);return+(0,n.D)(t)==+(0,o.p)(t)}}};
//# sourceMappingURL=18862.GivLF86PbpM.js.map