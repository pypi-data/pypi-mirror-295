"use strict";(self.webpackChunkknx_frontend=self.webpackChunkknx_frontend||[]).push([[2788],{93259:function(e,t,n){var a,i,r,o,s,l,d,u,c,h=n(23141),f=n(22481),p=n(6238),v=n(94881),m=n(66123),k=n(1781),y=n(36683),g=n(89231),b=n(29864),_=n(83647),M=n(8364),A=n(27526),L=(n(77052),n(21950),n(36724),n(848),n(43859),n(21968),n(68113),n(55888),n(56262),n(66274),n(84531),n(98168),n(34290),n(8339),n(98597)),x=n(196),w=n(90662),Z=n(33167),E=(n(91074),n(52631),{boolean:function(){return n.e(7150).then(n.bind(n,47150))},constant:function(){return n.e(3908).then(n.bind(n,73908))},float:function(){return n.e(2292).then(n.bind(n,82292))},grid:function(){return n.e(6880).then(n.bind(n,96880))},expandable:function(){return n.e(6048).then(n.bind(n,66048))},integer:function(){return n.e(3172).then(n.bind(n,73172))},multi_select:function(){return n.e(5494).then(n.bind(n,95494))},positive_time_period_dict:function(){return Promise.all([n.e(2560),n.e(8590)]).then(n.bind(n,38590))},select:function(){return n.e(3644).then(n.bind(n,73644))},string:function(){return n.e(9345).then(n.bind(n,39345))}}),z=function(e,t){return e?!t.name||t.flatten?e:e[t.name]:null};(0,M.A)([(0,x.EM)("ha-form")],(function(e,t){var n,M=function(t){function n(){var t;(0,g.A)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return t=(0,b.A)(this,n,[].concat(i)),e(t),t}return(0,_.A)(n,t),(0,y.A)(n)}(t);return{F:M,d:[{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"data",value:void 0},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"schema",value:void 0},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"error",value:void 0},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"warning",value:void 0},{kind:"field",decorators:[(0,x.MZ)({type:Boolean})],key:"disabled",value:function(){return!1}},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"computeError",value:void 0},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"computeWarning",value:void 0},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"computeLabel",value:void 0},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"computeHelper",value:void 0},{kind:"field",decorators:[(0,x.MZ)({attribute:!1})],key:"localizeValue",value:void 0},{kind:"method",key:"getFormProperties",value:function(){return{}}},{kind:"method",key:"focus",value:(n=(0,k.A)((0,v.A)().mark((function e(){var t,n,a,i;return(0,v.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateComplete;case 2:if(t=this.renderRoot.querySelector(".root")){e.next=5;break}return e.abrupt("return");case 5:n=(0,m.A)(t.children),e.prev=6,n.s();case 8:if((a=n.n()).done){e.next=18;break}if("HA-ALERT"===(i=a.value).tagName){e.next=16;break}if(!(i instanceof L.mN)){e.next=14;break}return e.next=14,i.updateComplete;case 14:return i.focus(),e.abrupt("break",18);case 16:e.next=8;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:case"end":return e.stop()}}),e,this,[[6,20,23,26]])}))),function(){return n.apply(this,arguments)})},{kind:"method",key:"willUpdate",value:function(e){e.has("schema")&&this.schema&&this.schema.forEach((function(e){var t;"selector"in e||null===(t=E[e.type])||void 0===t||t.call(E)}))}},{kind:"method",key:"render",value:function(){var e=this;return(0,L.qy)(a||(a=(0,p.A)(['\n      <div class="root" part="root">\n        ',"\n        ","\n      </div>\n    "])),this.error&&this.error.base?(0,L.qy)(i||(i=(0,p.A)(['\n              <ha-alert alert-type="error">\n                ',"\n              </ha-alert>\n            "])),this._computeError(this.error.base,this.schema)):"",this.schema.map((function(t){var n,a=function(e,t){return e&&t.name?e[t.name]:null}(e.error,t),i=function(e,t){return e&&t.name?e[t.name]:null}(e.warning,t);return(0,L.qy)(r||(r=(0,p.A)(["\n            ","\n            ","\n          "])),a?(0,L.qy)(o||(o=(0,p.A)(['\n                  <ha-alert own-margin alert-type="error">\n                    ',"\n                  </ha-alert>\n                "])),e._computeError(a,t)):i?(0,L.qy)(s||(s=(0,p.A)(['\n                    <ha-alert own-margin alert-type="warning">\n                      ',"\n                    </ha-alert>\n                  "])),e._computeWarning(i,t)):"","selector"in t?(0,L.qy)(l||(l=(0,p.A)(["<ha-selector\n                  .schema=","\n                  .hass=","\n                  .name=","\n                  .selector=","\n                  .value=","\n                  .label=","\n                  .disabled=","\n                  .placeholder=","\n                  .helper=","\n                  .localizeValue=","\n                  .required=","\n                  .context=","\n                ></ha-selector>"])),t,e.hass,t.name,t.selector,z(e.data,t),e._computeLabel(t,e.data),t.disabled||e.disabled||!1,t.required?"":t.default,e._computeHelper(t),e.localizeValue,t.required||!1,e._generateContext(t)):(0,w._)(e.fieldElementName(t.type),Object.assign({schema:t,data:z(e.data,t),label:e._computeLabel(t,e.data),helper:e._computeHelper(t),disabled:e.disabled||t.disabled||!1,hass:e.hass,localize:null===(n=e.hass)||void 0===n?void 0:n.localize,computeLabel:e.computeLabel,computeHelper:e.computeHelper,context:e._generateContext(t)},e.getFormProperties())))})))}},{kind:"method",key:"fieldElementName",value:function(e){return"ha-form-".concat(e)}},{kind:"method",key:"_generateContext",value:function(e){if(e.context){for(var t={},n=0,a=Object.entries(e.context);n<a.length;n++){var i=(0,f.A)(a[n],2),r=i[0],o=i[1];t[r]=this.data[o]}return t}}},{kind:"method",key:"createRenderRoot",value:function(){var e=(0,A.A)(M,"createRenderRoot",this,3)([]);return this.addValueChangedListener(e),e}},{kind:"method",key:"addValueChangedListener",value:function(e){var t=this;e.addEventListener("value-changed",(function(e){e.stopPropagation();var n=e.target.schema;if(e.target!==t){var a=!n.name||"flatten"in n&&n.flatten?e.detail.value:(0,h.A)({},n.name,e.detail.value);t.data=Object.assign(Object.assign({},t.data),a),(0,Z.r)(t,"value-changed",{value:t.data})}}))}},{kind:"method",key:"_computeLabel",value:function(e,t){return this.computeLabel?this.computeLabel(e,t):e?e.name:""}},{kind:"method",key:"_computeHelper",value:function(e){return this.computeHelper?this.computeHelper(e):""}},{kind:"method",key:"_computeError",value:function(e,t){var n=this;return Array.isArray(e)?(0,L.qy)(d||(d=(0,p.A)(["<ul>\n        ","\n      </ul>"])),e.map((function(e){return(0,L.qy)(u||(u=(0,p.A)(["<li>\n              ","\n            </li>"])),n.computeError?n.computeError(e,t):e)}))):this.computeError?this.computeError(e,t):e}},{kind:"method",key:"_computeWarning",value:function(e,t){return this.computeWarning?this.computeWarning(e,t):e}},{kind:"get",static:!0,key:"styles",value:function(){return(0,L.AH)(c||(c=(0,p.A)(["\n      .root > * {\n        display: block;\n      }\n      .root > *:not([own-margin]):not(:last-child) {\n        margin-bottom: 24px;\n      }\n      ha-alert[own-margin] {\n        margin-bottom: 4px;\n      }\n    "])))}}]}}),L.WF)},82788:function(e,t,n){n.r(t),n.d(t,{HaLocationSelector:function(){return V}});var a=n(22481),i=n(6238),r=n(95803),o=n(36683),s=n(89231),l=n(29864),d=n(83647),u=n(8364),c=(n(77052),n(848),n(43859),n(98597)),h=n(196),f=n(45081),p=n(33167),v=n(94881),m=n(1781),k=n(27526),y=(n(69466),n(21950),n(36724),n(71936),n(650),n(68113),n(84368),n(55888),n(56262),n(66274),n(85038),n(84531),n(98168),n(34290),n(8339),n(43689),n(66123)),g=(n(53156),n(86174));function b(e){return(0,g.w)(e,Date.now())}var _=n(51561);function M(e){return(0,_.r)(e,b(e))}var A,L,x,w,Z=n(37491),E=n(13634),z=(n(27934),function(){var e=(0,m.A)((0,v.A)().mark((function e(t){var a,i,r,o;return(0,v.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.parentNode){e.next=2;break}throw new Error("Cannot setup Leaflet map on disconnected element");case 2:return e.next=4,n.e(5027).then(n.t.bind(n,75027,23));case 4:return(a=e.sent.default).Icon.Default.imagePath="/static/images/leaflet/images/",i=a.map(t),(r=document.createElement("link")).setAttribute("href","/static/images/leaflet/leaflet.css"),r.setAttribute("rel","stylesheet"),t.parentNode.appendChild(r),i.setView([52.3731339,4.8903147],13),o=P(a).addTo(i),e.abrupt("return",[i,a,o]);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),P=function(e){return e.tileLayer("https://basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}".concat(e.Browser.retina?"@2x.png":".png"),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",minZoom:0,maxZoom:20})},C=n(80085),O=n(91330),B="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,F=(n(96396),n(12506)),I=(0,u.A)(null,(function(e,t){var n=function(t){function n(){var t;(0,s.A)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return t=(0,l.A)(this,n,[].concat(i)),e(t),t}return(0,d.A)(n,t),(0,o.A)(n)}(t);return{F:n,d:[{kind:"field",decorators:[(0,h.MZ)({attribute:"entity-id"})],key:"entityId",value:void 0},{kind:"field",decorators:[(0,h.MZ)({attribute:"entity-name"})],key:"entityName",value:void 0},{kind:"field",decorators:[(0,h.MZ)({attribute:"entity-picture"})],key:"entityPicture",value:void 0},{kind:"field",decorators:[(0,h.MZ)({attribute:"entity-color"})],key:"entityColor",value:void 0},{kind:"method",key:"render",value:function(){return(0,c.qy)(A||(A=(0,i.A)(['\n      <div\n        class="marker ','"\n        style=',"\n        @click=","\n      >\n        ","\n      </div>\n    "])),this.entityPicture?"picture":"",(0,F.W)({"border-color":this.entityColor}),this._badgeTap,this.entityPicture?(0,c.qy)(L||(L=(0,i.A)(['<div\n              class="entity-picture"\n              style=',"\n            ></div>"])),(0,F.W)({"background-image":"url(".concat(this.entityPicture,")")})):this.entityName)}},{kind:"method",key:"_badgeTap",value:function(e){e.stopPropagation(),this.entityId&&(0,p.r)(this,"hass-more-info",{entityId:this.entityId})}},{kind:"get",static:!0,key:"styles",value:function(){return(0,c.AH)(x||(x=(0,i.A)(["\n      .marker {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        box-sizing: border-box;\n        width: 48px;\n        height: 48px;\n        font-size: var(--ha-marker-font-size, 1.5em);\n        border-radius: var(--ha-marker-border-radius, 50%);\n        border: 1px solid var(--ha-marker-color, var(--primary-color));\n        color: var(--primary-text-color);\n        background-color: var(--card-background-color);\n      }\n      .marker.picture {\n        overflow: hidden;\n      }\n      .entity-picture {\n        background-size: cover;\n        height: 100%;\n        width: 100%;\n      }\n    "])))}}]}}),c.WF);customElements.define("ha-entity-marker",I);var N,q,j,H,S,T=function(e){return"string"==typeof e?e:e.entity_id},V=((0,u.A)([(0,h.EM)("ha-map")],(function(e,t){var n,r,u=function(t){function n(){var t;(0,s.A)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return t=(0,l.A)(this,n,[].concat(i)),e(t),t}return(0,d.A)(n,t),(0,o.A)(n)}(t);return{F:u,d:[{kind:"field",decorators:[(0,h.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,h.MZ)({attribute:!1})],key:"entities",value:void 0},{kind:"field",decorators:[(0,h.MZ)({attribute:!1})],key:"paths",value:void 0},{kind:"field",decorators:[(0,h.MZ)({attribute:!1})],key:"layers",value:void 0},{kind:"field",decorators:[(0,h.MZ)({type:Boolean})],key:"autoFit",value:function(){return!1}},{kind:"field",decorators:[(0,h.MZ)({type:Boolean})],key:"renderPassive",value:function(){return!1}},{kind:"field",decorators:[(0,h.MZ)({type:Boolean})],key:"interactiveZones",value:function(){return!1}},{kind:"field",decorators:[(0,h.MZ)({type:Boolean})],key:"fitZones",value:function(){return!1}},{kind:"field",decorators:[(0,h.MZ)({attribute:"theme-mode",type:String})],key:"themeMode",value:function(){return"auto"}},{kind:"field",decorators:[(0,h.MZ)({type:Number})],key:"zoom",value:function(){return 14}},{kind:"field",decorators:[(0,h.wk)()],key:"_loaded",value:function(){return!1}},{kind:"field",key:"leafletMap",value:void 0},{kind:"field",key:"Leaflet",value:void 0},{kind:"field",key:"_resizeObserver",value:void 0},{kind:"field",key:"_mapItems",value:function(){return[]}},{kind:"field",key:"_mapFocusItems",value:function(){return[]}},{kind:"field",key:"_mapZones",value:function(){return[]}},{kind:"field",key:"_mapPaths",value:function(){return[]}},{kind:"method",key:"connectedCallback",value:function(){(0,k.A)(u,"connectedCallback",this,3)([]),this._loadMap(),this._attachObserver()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,k.A)(u,"disconnectedCallback",this,3)([]),this.leafletMap&&(this.leafletMap.remove(),this.leafletMap=void 0,this.Leaflet=void 0),this._loaded=!1,this._resizeObserver&&this._resizeObserver.unobserve(this)}},{kind:"method",key:"update",value:function(e){var t,n;if((0,k.A)(u,"update",this,3)([e]),this._loaded){var a=!1,i=e.get("hass");if(e.has("_loaded")||e.has("entities"))this._drawEntities(),a=!0;else if(this._loaded&&i&&this.entities){var r,o=(0,y.A)(this.entities);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(i.states[T(s)]!==this.hass.states[T(s)]){this._drawEntities(),a=!0;break}}}catch(l){o.e(l)}finally{o.f()}}(e.has("_loaded")||e.has("paths"))&&this._drawPaths(),(e.has("_loaded")||e.has("layers"))&&(this._drawLayers(e.get("layers")),a=!0),(e.has("_loaded")||this.autoFit&&a)&&this.fitMap(),e.has("zoom")&&this.leafletMap.setZoom(this.zoom),(e.has("themeMode")||e.has("hass")&&(!i||(null===(t=i.themes)||void 0===t?void 0:t.darkMode)!==(null===(n=this.hass.themes)||void 0===n?void 0:n.darkMode)))&&this._updateMapStyle()}}},{kind:"get",key:"_darkMode",value:function(){return"dark"===this.themeMode||"auto"===this.themeMode&&Boolean(this.hass.themes.darkMode)}},{kind:"method",key:"_updateMapStyle",value:function(){var e=this.renderRoot.querySelector("#map");e.classList.toggle("dark",this._darkMode),e.classList.toggle("forced-dark","dark"===this.themeMode),e.classList.toggle("forced-light","light"===this.themeMode)}},{kind:"field",key:"_loading",value:function(){return!1}},{kind:"method",key:"_loadMap",value:(r=(0,m.A)((0,v.A)().mark((function e(){var t,n,i;return(0,v.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._loading){e.next=2;break}return e.abrupt("return");case 2:return(t=this.shadowRoot.getElementById("map"))||((t=document.createElement("div")).id="map",this.shadowRoot.append(t)),this._loading=!0,e.prev=5,e.next=8,z(t);case 8:n=e.sent,i=(0,a.A)(n,2),this.leafletMap=i[0],this.Leaflet=i[1],this._updateMapStyle(),this._loaded=!0;case 14:return e.prev=14,this._loading=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[5,,14,17]])}))),function(){return r.apply(this,arguments)})},{kind:"method",key:"fitMap",value:function(e){var t,n,a;if(this.leafletMap&&this.Leaflet&&this.hass)if(this._mapFocusItems.length||null!==(t=this.layers)&&void 0!==t&&t.length){var i,r=this.Leaflet.latLngBounds(this._mapFocusItems?this._mapFocusItems.map((function(e){return e.getLatLng()})):[]);if(this.fitZones)null===(i=this._mapZones)||void 0===i||i.forEach((function(e){r.extend("getBounds"in e?e.getBounds():e.getLatLng())}));null===(n=this.layers)||void 0===n||n.forEach((function(e){r.extend("getBounds"in e?e.getBounds():e.getLatLng())})),r=r.pad(null!==(a=null==e?void 0:e.pad)&&void 0!==a?a:.5),this.leafletMap.fitBounds(r,{maxZoom:(null==e?void 0:e.zoom)||this.zoom})}else this.leafletMap.setView(new this.Leaflet.LatLng(this.hass.config.latitude,this.hass.config.longitude),(null==e?void 0:e.zoom)||this.zoom)}},{kind:"method",key:"fitBounds",value:function(e,t){var n;if(this.leafletMap&&this.Leaflet&&this.hass){var a=this.Leaflet.latLngBounds(e).pad(null!==(n=null==t?void 0:t.pad)&&void 0!==n?n:.5);this.leafletMap.fitBounds(a,{maxZoom:(null==t?void 0:t.zoom)||this.zoom})}}},{kind:"method",key:"_drawLayers",value:function(e){if(e&&e.forEach((function(e){return e.remove()})),this.layers){var t=this.leafletMap;this.layers.forEach((function(e){t.addLayer(e)}))}}},{kind:"method",key:"_computePathTooltip",value:function(e,t){var n;return n=e.fullDatetime?(0,Z.r6)(t.timestamp,this.hass.locale,this.hass.config):M(t.timestamp)?(0,E.ie)(t.timestamp,this.hass.locale,this.hass.config):(0,E.Xs)(t.timestamp,this.hass.locale,this.hass.config),"".concat(e.name,"<br>").concat(n)}},{kind:"method",key:"_drawPaths",value:function(){var e=this,t=this.hass,n=this.leafletMap,a=this.Leaflet;if(t&&n&&a&&(this._mapPaths.length&&(this._mapPaths.forEach((function(e){return e.remove()})),this._mapPaths=[]),this.paths)){var i=getComputedStyle(this).getPropertyValue("--dark-primary-color");this.paths.forEach((function(t){var r,o;t.gradualOpacity&&(r=t.gradualOpacity/(t.points.length-2),o=1-t.gradualOpacity);for(var s=0;s<t.points.length-1;s++){var l=t.gradualOpacity?o+s*r:void 0;e._mapPaths.push(a.circleMarker(t.points[s].point,{radius:B?8:3,color:t.color||i,opacity:l,fillOpacity:l,interactive:!0}).bindTooltip(e._computePathTooltip(t,t.points[s]),{direction:"top"})),e._mapPaths.push(a.polyline([t.points[s].point,t.points[s+1].point],{color:t.color||i,opacity:l,interactive:!1}))}var d=t.points.length-1;if(d>=0){var u=t.gradualOpacity?o+d*r:void 0;e._mapPaths.push(a.circleMarker(t.points[d].point,{radius:B?8:3,color:t.color||i,opacity:u,fillOpacity:u,interactive:!0}).bindTooltip(e._computePathTooltip(t,t.points[d]),{direction:"top"}))}e._mapPaths.forEach((function(e){return n.addLayer(e)}))}))}}},{kind:"method",key:"_drawEntities",value:function(){var e=this.hass,t=this.leafletMap,n=this.Leaflet;if(e&&t&&n&&(this._mapItems.length&&(this._mapItems.forEach((function(e){return e.remove()})),this._mapItems=[],this._mapFocusItems=[]),this._mapZones.length&&(this._mapZones.forEach((function(e){return e.remove()})),this._mapZones=[]),this.entities)){var a,i=getComputedStyle(this),r=i.getPropertyValue("--accent-color"),o=i.getPropertyValue("--secondary-text-color"),s=i.getPropertyValue("--dark-primary-color"),l=this._darkMode?"dark":"light",d=(0,y.A)(this.entities);try{for(d.s();!(a=d.n()).done;){var u=a.value,c=e.states[T(u)];if(c){var h="string"!=typeof u?u.name:void 0,f=null!=h?h:(0,O.u)(c),p=c.attributes,v=p.latitude,m=p.longitude,k=p.passive,g=p.icon,b=p.radius,_=p.entity_picture,M=p.gps_accuracy;if(v&&m)if("zone"!==(0,C.t)(c)){var A="string"!=typeof u&&"state"===u.label_mode?this.hass.formatEntityState(c):null!=h?h:f.split(" ").map((function(e){return e[0]})).join("").substr(0,3),L=n.marker([v,m],{icon:n.divIcon({html:'\n              <ha-entity-marker\n                entity-id="'.concat(T(u),'"\n                entity-name="').concat(A,'"\n                entity-picture="').concat(_?this.hass.hassUrl(_):"",'"\n                ').concat("string"!=typeof u?'entity-color="'.concat(u.color,'"'):"","\n              ></ha-entity-marker>\n            "),iconSize:[48,48],className:""}),title:f});this._mapItems.push(L),"string"!=typeof u&&!1===u.focus||this._mapFocusItems.push(L),M&&this._mapItems.push(n.circle([v,m],{interactive:!1,color:s,radius:M}))}else{if(k&&!this.renderPassive)continue;var x="";if(g){var w=document.createElement("ha-icon");w.setAttribute("icon",g),x=w.outerHTML}else{var Z=document.createElement("span");Z.innerHTML=f,x=Z.outerHTML}this._mapZones.push(n.marker([v,m],{icon:n.divIcon({html:x,iconSize:[24,24],className:l}),interactive:this.interactiveZones,title:f})),this._mapZones.push(n.circle([v,m],{interactive:!1,color:k?o:r,radius:b}))}}}}catch(E){d.e(E)}finally{d.f()}this._mapItems.forEach((function(e){return t.addLayer(e)})),this._mapZones.forEach((function(e){return t.addLayer(e)}))}}},{kind:"method",key:"_attachObserver",value:(n=(0,m.A)((0,v.A)().mark((function e(){var t=this;return(0,v.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._resizeObserver||(this._resizeObserver=new ResizeObserver((function(){var e;null===(e=t.leafletMap)||void 0===e||e.invalidateSize({debounceMoveend:!0})}))),this._resizeObserver.observe(this);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,c.AH)(w||(w=(0,i.A)(["\n      :host {\n        display: block;\n        height: 300px;\n      }\n      #map {\n        height: 100%;\n      }\n      #map.dark {\n        background: #090909;\n      }\n      #map.forced-dark {\n        color: #ffffff;\n        --map-filter: invert(0.9) hue-rotate(170deg) brightness(1.5)\n          contrast(1.2) saturate(0.3);\n      }\n      #map.forced-light {\n        background: #ffffff;\n        color: #000000;\n        --map-filter: invert(0);\n      }\n      #map:active {\n        cursor: grabbing;\n        cursor: -moz-grabbing;\n        cursor: -webkit-grabbing;\n      }\n      .leaflet-tile-pane {\n        filter: var(--map-filter);\n      }\n      .dark .leaflet-bar a {\n        background-color: #1c1c1c;\n        color: #ffffff;\n      }\n      .dark .leaflet-bar a:hover {\n        background-color: #313131;\n      }\n      .leaflet-marker-draggable {\n        cursor: move !important;\n      }\n      .leaflet-edit-resize {\n        border-radius: 50%;\n        cursor: nesw-resize !important;\n      }\n      .named-icon {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-direction: column;\n        text-align: center;\n        color: var(--primary-text-color);\n      }\n      .leaflet-pane {\n        z-index: 0 !important;\n      }\n      .leaflet-control,\n      .leaflet-top,\n      .leaflet-bottom {\n        z-index: 1 !important;\n      }\n      .leaflet-tooltip {\n        padding: 8px;\n        font-size: 90%;\n        background: rgba(80, 80, 80, 0.9) !important;\n        color: white !important;\n        border-radius: 4px;\n        box-shadow: none !important;\n        text-align: center;\n      }\n    "])))}}]}}),c.mN),(0,u.A)([(0,h.EM)("ha-locations-editor")],(function(e,t){var a,r=function(t){function a(){var t;return(0,s.A)(this,a),t=(0,l.A)(this,a),e(t),t._loadPromise=n.e(5027).then(n.t.bind(n,75027,23)).then((function(e){return n.e(9943).then(n.t.bind(n,19943,23)).then((function(){return t.Leaflet=e.default,t._updateMarkers(),t.updateComplete.then((function(){return t.fitMap()}))}))})),t}return(0,d.A)(a,t),(0,o.A)(a)}(t);return{F:r,d:[{kind:"field",decorators:[(0,h.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,h.MZ)({attribute:!1})],key:"locations",value:void 0},{kind:"field",decorators:[(0,h.MZ)()],key:"helper",value:void 0},{kind:"field",decorators:[(0,h.MZ)({type:Boolean})],key:"autoFit",value:function(){return!1}},{kind:"field",decorators:[(0,h.MZ)({type:Number})],key:"zoom",value:function(){return 16}},{kind:"field",decorators:[(0,h.MZ)({attribute:"theme-mode",type:String})],key:"themeMode",value:function(){return"auto"}},{kind:"field",decorators:[(0,h.wk)()],key:"_locationMarkers",value:void 0},{kind:"field",decorators:[(0,h.wk)()],key:"_circles",value:function(){return{}}},{kind:"field",decorators:[(0,h.P)("ha-map",!0)],key:"map",value:void 0},{kind:"field",key:"Leaflet",value:void 0},{kind:"field",key:"_loadPromise",value:void 0},{kind:"method",key:"fitMap",value:function(e){this.map.fitMap(e)}},{kind:"method",key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{kind:"method",key:"fitMarker",value:(a=(0,m.A)((0,v.A)().mark((function e(t,n){var a,i;return(0,v.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.Leaflet){e.next=3;break}return e.next=3,this._loadPromise;case 3:if(this.map.leafletMap&&this._locationMarkers){e.next=5;break}return e.abrupt("return");case 5:if(a=this._locationMarkers[t]){e.next=8;break}return e.abrupt("return");case 8:"getBounds"in a?(this.map.leafletMap.fitBounds(a.getBounds()),a.bringToFront()):(i=this._circles[t])?this.map.leafletMap.fitBounds(i.getBounds()):this.map.leafletMap.setView(a.getLatLng(),(null==n?void 0:n.zoom)||this.zoom);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{kind:"method",key:"render",value:function(){return(0,c.qy)(N||(N=(0,i.A)(["\n      <ha-map\n        .hass=","\n        .layers=","\n        .zoom=","\n        .autoFit=","\n        .themeMode=","\n      ></ha-map>\n      ","\n    "])),this.hass,this._getLayers(this._circles,this._locationMarkers),this.zoom,this.autoFit,this.themeMode,this.helper?(0,c.qy)(q||(q=(0,i.A)(["<ha-input-helper-text>","</ha-input-helper-text>"])),this.helper):"")}},{kind:"field",key:"_getLayers",value:function(){return(0,f.A)((function(e,t){var n=[];return Array.prototype.push.apply(n,Object.values(e)),t&&Array.prototype.push.apply(n,Object.values(t)),n}))}},{kind:"method",key:"willUpdate",value:function(e){(0,k.A)(r,"willUpdate",this,3)([e]),this.Leaflet&&e.has("locations")&&this._updateMarkers()}},{kind:"method",key:"updated",value:function(e){var t=this;if(this.Leaflet&&e.has("locations")){var n,a,i=e.get("locations"),r=null===(n=this.locations)||void 0===n?void 0:n.filter((function(e,n){var a,r;return!i[n]||(e.latitude!==i[n].latitude||e.longitude!==i[n].longitude)&&(null===(a=t.map.leafletMap)||void 0===a?void 0:a.getBounds().contains({lat:i[n].latitude,lng:i[n].longitude}))&&!(null!==(r=t.map.leafletMap)&&void 0!==r&&r.getBounds().contains({lat:e.latitude,lng:e.longitude}))}));if(1===(null==r?void 0:r.length))null===(a=this.map.leafletMap)||void 0===a||a.panTo({lat:r[0].latitude,lng:r[0].longitude})}}},{kind:"method",key:"_updateLocation",value:function(e){var t=e.target,n=t.getLatLng(),a=n.lng;Math.abs(a)>180&&(a=(a%360+540)%360-180);var i=[n.lat,a];(0,p.r)(this,"location-updated",{id:t.id,location:i},{bubbles:!1})}},{kind:"method",key:"_updateRadius",value:function(e){var t=e.target,n=this._locationMarkers[t.id];(0,p.r)(this,"radius-updated",{id:t.id,radius:n.getRadius()},{bubbles:!1})}},{kind:"method",key:"_markerClicked",value:function(e){var t=e.target;(0,p.r)(this,"marker-clicked",{id:t.id},{bubbles:!1})}},{kind:"method",key:"_updateMarkers",value:function(){var e=this;if(!this.locations||!this.locations.length)return this._circles={},void(this._locationMarkers=void 0);var t={},n={},a=getComputedStyle(this).getPropertyValue("--accent-color");this.locations.forEach((function(i){var r;if(i.icon||i.iconPath){var o,s=document.createElement("div");s.className="named-icon",void 0!==i.name&&(s.innerText=i.name),i.icon?(o=document.createElement("ha-icon")).setAttribute("icon",i.icon):(o=document.createElement("ha-svg-icon")).setAttribute("path",i.iconPath),s.prepend(o),r=e.Leaflet.divIcon({html:s.outerHTML,iconSize:[24,24],className:"light"})}if(i.radius){var l=e.Leaflet.circle([i.latitude,i.longitude],{color:i.radius_color||a,radius:i.radius});i.radius_editable||i.location_editable?(l.editing.enable(),l.addEventListener("add",(function(){var t=l.editing._moveMarker,n=l.editing._resizeMarkers[0];r&&t.setIcon(r),n.id=t.id=i.id,t.addEventListener("dragend",(function(t){return e._updateLocation(t)})).addEventListener("click",(function(t){return e._markerClicked(t)})),i.radius_editable?n.addEventListener("dragend",(function(t){return e._updateRadius(t)})):n.remove()})),t[i.id]=l):n[i.id]=l}if(!i.radius||!i.radius_editable&&!i.location_editable){var d={title:i.name,draggable:i.location_editable};r&&(d.icon=r);var u=e.Leaflet.marker([i.latitude,i.longitude],d).addEventListener("dragend",(function(t){return e._updateLocation(t)})).addEventListener("click",(function(t){return e._markerClicked(t)}));u.id=i.id,t[i.id]=u}})),this._circles=n,this._locationMarkers=t,(0,p.r)(this,"markers-updated")}},{kind:"get",static:!0,key:"styles",value:function(){return(0,c.AH)(j||(j=(0,i.A)(["\n      ha-map {\n        display: block;\n        height: 100%;\n      }\n    "])))}}]}}),c.WF),n(93259),(0,u.A)([(0,h.EM)("ha-selector-location")],(function(e,t){var n=function(t){function n(){var t;(0,s.A)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return t=(0,l.A)(this,n,[].concat(i)),e(t),t}return(0,d.A)(n,t),(0,o.A)(n)}(t);return{F:n,d:[{kind:"field",decorators:[(0,h.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,h.MZ)({attribute:!1})],key:"selector",value:void 0},{kind:"field",decorators:[(0,h.MZ)({type:Object})],key:"value",value:void 0},{kind:"field",decorators:[(0,h.MZ)()],key:"label",value:void 0},{kind:"field",decorators:[(0,h.MZ)()],key:"helper",value:void 0},{kind:"field",decorators:[(0,h.MZ)({type:Boolean,reflect:!0})],key:"disabled",value:function(){return!1}},{kind:"field",key:"_schema",value:function(){return(0,f.A)((function(e,t){return[{name:"",type:"grid",schema:[{name:"latitude",required:!0,selector:{number:{step:"any"}}},{name:"longitude",required:!0,selector:{number:{step:"any"}}}]}].concat((0,r.A)(e?[{name:"radius",required:!0,default:1e3,disabled:!!t,selector:{number:{min:0,step:1,mode:"box"}}}]:[]))}))}},{kind:"method",key:"willUpdate",value:function(){var e;this.value||(this.value={latitude:this.hass.config.latitude,longitude:this.hass.config.longitude,radius:null!==(e=this.selector.location)&&void 0!==e&&e.radius?1e3:void 0})}},{kind:"method",key:"render",value:function(){var e,t;return(0,c.qy)(H||(H=(0,i.A)(["\n      <p>",'</p>\n      <ha-locations-editor\n        class="flex"\n        .hass=',"\n        .helper=","\n        .locations=","\n        @location-updated=","\n        @radius-updated=","\n      ></ha-locations-editor>\n      <ha-form\n        .hass=","\n        .schema=","\n        .data=","\n        .computeLabel=","\n        .disabled=","\n        @value-changed=","\n      ></ha-form>\n    "])),this.label?this.label:"",this.hass,this.helper,this._location(this.selector,this.value),this._locationChanged,this._radiusChanged,this.hass,this._schema(null===(e=this.selector.location)||void 0===e?void 0:e.radius,null===(t=this.selector.location)||void 0===t?void 0:t.radius_readonly),this.value,this._computeLabel,this.disabled,this._valueChanged)}},{kind:"field",key:"_location",value:function(){var e=this;return(0,f.A)((function(t,n){var a,i,r,o,s,l,d=getComputedStyle(e),u=null!==(a=t.location)&&void 0!==a&&a.radius?d.getPropertyValue("--zone-radius-color")||d.getPropertyValue("--accent-color"):void 0;return[{id:"location",latitude:!n||isNaN(n.latitude)?e.hass.config.latitude:n.latitude,longitude:!n||isNaN(n.longitude)?e.hass.config.longitude:n.longitude,radius:null!==(i=t.location)&&void 0!==i&&i.radius?(null==n?void 0:n.radius)||1e3:void 0,radius_color:u,icon:null!==(r=t.location)&&void 0!==r&&r.icon||null!==(o=t.location)&&void 0!==o&&o.radius?"mdi:map-marker-radius":"mdi:map-marker",location_editable:!0,radius_editable:!(null===(s=t.location)||void 0===s||!s.radius||null!==(l=t.location)&&void 0!==l&&l.radius_readonly)}]}))}},{kind:"method",key:"_locationChanged",value:function(e){var t=(0,a.A)(e.detail.location,2),n=t[0],i=t[1];(0,p.r)(this,"value-changed",{value:Object.assign(Object.assign({},this.value),{},{latitude:n,longitude:i})})}},{kind:"method",key:"_radiusChanged",value:function(e){var t=Math.round(e.detail.radius);(0,p.r)(this,"value-changed",{value:Object.assign(Object.assign({},this.value),{},{radius:t})})}},{kind:"method",key:"_valueChanged",value:function(e){var t,n;e.stopPropagation();var a=e.detail.value,i=Math.round(e.detail.value.radius);(0,p.r)(this,"value-changed",{value:Object.assign({latitude:a.latitude,longitude:a.longitude},null===(t=this.selector.location)||void 0===t||!t.radius||null!==(n=this.selector.location)&&void 0!==n&&n.radius_readonly?{}:{radius:i})})}},{kind:"field",key:"_computeLabel",value:function(){var e=this;return function(t){return t.name?e.hass.localize("ui.components.selectors.location.".concat(t.name)):""}}},{kind:"field",static:!0,key:"styles",value:function(){return(0,c.AH)(S||(S=(0,i.A)(["\n    ha-locations-editor {\n      display: block;\n      height: 400px;\n      margin-bottom: 16px;\n    }\n    p {\n      margin-top: 0;\n    }\n  "])))}}]}}),c.WF))},86174:function(e,t,n){function a(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}n.d(t,{w:function(){return a}})},51561:function(e,t,n){n.d(t,{r:function(){return i}});var a=n(93352);function i(e,t){return+(0,a.o)(e)==+(0,a.o)(t)}},93352:function(e,t,n){n.d(t,{o:function(){return i}});var a=n(74396);function i(e){var t=(0,a.a)(e);return t.setHours(0,0,0,0),t}},74396:function(e,t,n){n.d(t,{a:function(){return i}});var a=n(67234);n(68113),n(58971);function i(e){var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===(0,a.A)(e)&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}}}]);