(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();const ye=(e,t)=>e===t,_e=Symbol("solid-track"),R={equals:ye};let ae=de;const O=1,H=2,ce={owned:null,cleanups:null,context:null,owner:null};var m=null;let Z=null,ve=null,_=null,A=null,E=null,Q=0;function J(e,t){const s=_,n=m,r=e.length===0,l=t===void 0?n:t,i=r?ce:{owned:null,cleanups:null,context:l?l.context:null,owner:l},o=r?e:()=>e(()=>T(()=>W(i)));m=i,_=null;try{return V(o,!0)}finally{_=s,m=n}}function U(e,t){t=t?Object.assign({},R,t):R;const s={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=r=>(typeof r=="function"&&(r=r(s.value)),fe(s,r));return[ue.bind(s),n]}function j(e,t,s){const n=se(e,t,!1,O);L(n)}function $e(e,t,s){ae=ke;const n=se(e,t,!1,O);n.user=!0,E?E.push(n):L(n)}function k(e,t,s){s=s?Object.assign({},R,s):R;const n=se(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=s.equals||void 0,L(n),ue.bind(n)}function T(e){if(_===null)return e();const t=_;_=null;try{return e()}finally{_=t}}function me(e){return m===null||(m.cleanups===null?m.cleanups=[e]:m.cleanups.push(e)),e}function Se(e){const t=k(e),s=k(()=>z(t()));return s.toArray=()=>{const n=s();return Array.isArray(n)?n:n!=null?[n]:[]},s}function ue(){if(this.sources&&this.state)if(this.state===O)L(this);else{const e=A;A=null,V(()=>K(this),!1),A=e}if(_){const e=this.observers?this.observers.length:0;_.sources?(_.sources.push(this),_.sourceSlots.push(e)):(_.sources=[this],_.sourceSlots=[e]),this.observers?(this.observers.push(_),this.observerSlots.push(_.sources.length-1)):(this.observers=[_],this.observerSlots=[_.sources.length-1])}return this.value}function fe(e,t,s){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&V(()=>{for(let r=0;r<e.observers.length;r+=1){const l=e.observers[r],i=Z&&Z.running;i&&Z.disposed.has(l),(i?!l.tState:!l.state)&&(l.pure?A.push(l):E.push(l),l.observers&&he(l)),i||(l.state=O)}if(A.length>1e6)throw A=[],new Error},!1)),t}function L(e){if(!e.fn)return;W(e);const t=Q;Ce(e,e.value,t)}function Ce(e,t,s){let n;const r=m,l=_;_=m=e;try{n=e.fn(t)}catch(i){return e.pure&&(e.state=O,e.owned&&e.owned.forEach(W),e.owned=null),e.updatedAt=s+1,ge(i)}finally{_=l,m=r}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?fe(e,n):e.value=n,e.updatedAt=s)}function se(e,t,s,n=O,r){const l={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:m,context:m?m.context:null,pure:s};return m===null||m!==ce&&(m.owned?m.owned.push(l):m.owned=[l]),l}function F(e){if(e.state===0)return;if(e.state===H)return K(e);if(e.suspense&&T(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Q);)e.state&&t.push(e);for(let s=t.length-1;s>=0;s--)if(e=t[s],e.state===O)L(e);else if(e.state===H){const n=A;A=null,V(()=>K(e,t[0]),!1),A=n}}function V(e,t){if(A)return e();let s=!1;t||(A=[]),E?s=!0:E=[],Q++;try{const n=e();return Ae(s),n}catch(n){s||(E=null),A=null,ge(n)}}function Ae(e){if(A&&(de(A),A=null),e)return;const t=E;E=null,t.length&&V(()=>ae(t),!1)}function de(e){for(let t=0;t<e.length;t++)F(e[t])}function ke(e){let t,s=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[s++]=n:F(n)}for(t=0;t<s;t++)F(e[t])}function K(e,t){e.state=0;for(let s=0;s<e.sources.length;s+=1){const n=e.sources[s];if(n.sources){const r=n.state;r===O?n!==t&&(!n.updatedAt||n.updatedAt<Q)&&F(n):r===H&&K(n,t)}}}function he(e){for(let t=0;t<e.observers.length;t+=1){const s=e.observers[t];s.state||(s.state=H,s.pure?A.push(s):E.push(s),s.observers&&he(s))}}function W(e){let t;if(e.sources)for(;e.sources.length;){const s=e.sources.pop(),n=e.sourceSlots.pop(),r=s.observers;if(r&&r.length){const l=r.pop(),i=s.observerSlots.pop();n<r.length&&(l.sourceSlots[i]=n,r[n]=l,s.observerSlots[n]=i)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)W(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function Me(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function ge(e,t=m){throw Me(e)}function z(e){if(typeof e=="function"&&!e.length)return z(e());if(Array.isArray(e)){const t=[];for(let s=0;s<e.length;s++){const n=z(e[s]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}const Ie=Symbol("fallback");function le(e){for(let t=0;t<e.length;t++)e[t]()}function Ee(e,t,s={}){let n=[],r=[],l=[],i=0,o=t.length>1?[]:null;return me(()=>le(l)),()=>{let f=e()||[],c=f.length,u,a;return f[_e],T(()=>{let x,v,b,C,$,g,w,y,M;if(c===0)i!==0&&(le(l),l=[],n=[],r=[],i=0,o&&(o=[])),s.fallback&&(n=[Ie],r[0]=J(D=>(l[0]=D,s.fallback())),i=1);else if(i===0){for(r=new Array(c),a=0;a<c;a++)n[a]=f[a],r[a]=J(h);i=c}else{for(b=new Array(c),C=new Array(c),o&&($=new Array(c)),g=0,w=Math.min(i,c);g<w&&n[g]===f[g];g++);for(w=i-1,y=c-1;w>=g&&y>=g&&n[w]===f[y];w--,y--)b[y]=r[w],C[y]=l[w],o&&($[y]=o[w]);for(x=new Map,v=new Array(y+1),a=y;a>=g;a--)M=f[a],u=x.get(M),v[a]=u===void 0?-1:u,x.set(M,a);for(u=g;u<=w;u++)M=n[u],a=x.get(M),a!==void 0&&a!==-1?(b[a]=r[u],C[a]=l[u],o&&($[a]=o[u]),a=v[a],x.set(M,a)):l[u]();for(a=g;a<c;a++)a in b?(r[a]=b[a],l[a]=C[a],o&&(o[a]=$[a],o[a](a))):r[a]=J(h);r=r.slice(0,i=c),n=f.slice(0)}return r});function h(x){if(l[a]=x,o){const[v,b]=U(a);return o[a]=b,t(f[a],v)}return t(f[a])}}}let Te=!1;function S(e,t){return T(()=>e(t||{}))}const pe=e=>`Stale read from <${e}>.`;function xe(e){const t="fallback"in e&&{fallback:()=>e.fallback};return k(Ee(()=>e.each,e.children,t||void 0))}function N(e){const t=e.keyed,s=k(()=>e.when,void 0,{equals:(n,r)=>t?n===r:!n==!r});return k(()=>{const n=s();if(n){const r=e.children;return typeof r=="function"&&r.length>0?T(()=>r(t?n:()=>{if(!T(s))throw pe("Show");return e.when})):r}return e.fallback},void 0,void 0)}function Oe(e){let t=!1;const s=(l,i)=>(t?l[1]===i[1]:!l[1]==!i[1])&&l[2]===i[2],n=Se(()=>e.children),r=k(()=>{let l=n();Array.isArray(l)||(l=[l]);for(let i=0;i<l.length;i++){const o=l[i].when;if(o)return t=!!l[i].keyed,[i,o,l[i]]}return[-1]},void 0,{equals:s});return k(()=>{const[l,i,o]=r();if(l<0)return e.fallback;const f=o.children;return typeof f=="function"&&f.length>0?T(()=>f(t?i:()=>{if(T(r)[0]!==l)throw pe("Match");return o.when})):f},void 0,void 0)}function re(e){return e}function De(e,t,s){let n=s.length,r=t.length,l=n,i=0,o=0,f=t[r-1].nextSibling,c=null;for(;i<r||o<l;){if(t[i]===s[o]){i++,o++;continue}for(;t[r-1]===s[l-1];)r--,l--;if(r===i){const u=l<n?o?s[o-1].nextSibling:s[l-o]:f;for(;o<l;)e.insertBefore(s[o++],u)}else if(l===o)for(;i<r;)(!c||!c.has(t[i]))&&t[i].remove(),i++;else if(t[i]===s[l-1]&&s[o]===t[r-1]){const u=t[--r].nextSibling;e.insertBefore(s[o++],t[i++].nextSibling),e.insertBefore(s[--l],u),t[r]=s[l]}else{if(!c){c=new Map;let a=o;for(;a<l;)c.set(s[a],a++)}const u=c.get(t[i]);if(u!=null)if(o<u&&u<l){let a=i,h=1,x;for(;++a<r&&a<l&&!((x=c.get(t[a]))==null||x!==u+h);)h++;if(h>u-o){const v=t[i];for(;o<u;)e.insertBefore(s[o++],v)}else e.replaceChild(s[o++],t[i++])}else i++;else t[i++].remove()}}}const ie="_$DX_DELEGATE";function Ne(e,t,s,n={}){let r;return J(l=>{r=l,t===document?e():d(t,e(),t.firstChild?null:void 0,s)},n.owner),()=>{r(),t.textContent=""}}function p(e,t,s){let n;const r=()=>{const i=document.createElement("template");return i.innerHTML=e,i.content.firstChild},l=()=>(n||(n=r())).cloneNode(!0);return l.cloneNode=l,l}function X(e,t=window.document){const s=t[ie]||(t[ie]=new Set);for(let n=0,r=e.length;n<r;n++){const l=e[n];s.has(l)||(s.add(l),t.addEventListener(l,Pe))}}function B(e,t){t==null?e.removeAttribute("class"):e.className=t}function je(e,t,s,n){Array.isArray(s)?(e[`$$${t}`]=s[0],e[`$$${t}Data`]=s[1]):e[`$$${t}`]=s}function be(e,t,s){return T(()=>e(t,s))}function d(e,t,s,n){if(s!==void 0&&!n&&(n=[]),typeof t!="function")return q(e,t,n,s);j(r=>q(e,t(),r,s),n)}function Pe(e){const t=`$$${e.type}`;let s=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==s&&Object.defineProperty(e,"target",{configurable:!0,value:s}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return s||document}});s;){const n=s[t];if(n&&!s.disabled){const r=s[`${t}Data`];if(r!==void 0?n.call(s,r,e):n.call(s,e),e.cancelBubble)return}s=s._$host||s.parentNode||s.host}}function q(e,t,s,n,r){for(;typeof s=="function";)s=s();if(t===s)return s;const l=typeof t,i=n!==void 0;if(e=i&&s[0]&&s[0].parentNode||e,l==="string"||l==="number"){if(l==="number"&&(t=t.toString(),t===s))return s;if(i){let o=s[0];o&&o.nodeType===3?o.data!==t&&(o.data=t):o=document.createTextNode(t),s=P(e,s,n,o)}else s!==""&&typeof s=="string"?s=e.firstChild.data=t:s=e.textContent=t}else if(t==null||l==="boolean")s=P(e,s,n);else{if(l==="function")return j(()=>{let o=t();for(;typeof o=="function";)o=o();s=q(e,o,s,n)}),()=>s;if(Array.isArray(t)){const o=[],f=s&&Array.isArray(s);if(ee(o,t,s,r))return j(()=>s=q(e,o,s,n,!0)),()=>s;if(o.length===0){if(s=P(e,s,n),i)return s}else f?s.length===0?oe(e,o,n):De(e,s,o):(s&&P(e),oe(e,o));s=o}else if(t.nodeType){if(Array.isArray(s)){if(i)return s=P(e,s,n,t);P(e,s,null,t)}else s==null||s===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);s=t}}return s}function ee(e,t,s,n){let r=!1;for(let l=0,i=t.length;l<i;l++){let o=t[l],f=s&&s[e.length],c;if(!(o==null||o===!0||o===!1))if((c=typeof o)=="object"&&o.nodeType)e.push(o);else if(Array.isArray(o))r=ee(e,o,f)||r;else if(c==="function")if(n){for(;typeof o=="function";)o=o();r=ee(e,Array.isArray(o)?o:[o],Array.isArray(f)?f:[f])||r}else e.push(o),r=!0;else{const u=String(o);f&&f.nodeType===3&&f.data===u?e.push(f):e.push(document.createTextNode(u))}}return r}function oe(e,t,s=null){for(let n=0,r=t.length;n<r;n++)e.insertBefore(t[n],s)}function P(e,t,s,n){if(s===void 0)return e.textContent="";const r=n||document.createTextNode("");if(t.length){let l=!1;for(let i=t.length-1;i>=0;i--){const o=t[i];if(r!==o){const f=o.parentNode===e;!l&&!i?f?e.replaceChild(r,o):e.insertBefore(r,s):f&&o.remove()}else l=!0}}else e.insertBefore(r,s);return[r]}var Ue=p('<span class="border-x-[2px] border-b-[2px] p-1 break-all">'),Le=p('<div class=contents><span class="border-l-[2px] border-b-[2px] p-1">'),Ve=p('<div class="grid grid-cols-[max-content_1fr] border-t-[2px] min-w-fit">'),Be=p('<div class="grid grid-cols-[max-content_1fr]">');const te=(e,t=!0)=>{if(typeof e!="object"||e===null)return(()=>{var n=Ue();return d(n,()=>typeof e=="string"?`'${e}'`:JSON.stringify(e)),n})();const s=Object.entries(e).map(([n,r])=>(()=>{var l=Le(),i=l.firstChild;return d(i,n),d(l,(()=>{var o=k(()=>!!(Array.isArray(r)||typeof r=="object"));return()=>(o(),te(r,!1))})(),null),l})());return t?(()=>{var n=Ve();return d(n,s),n})():(()=>{var n=Be();return d(n,s),n})()};function we(e){try{if(JSON.parse(e).screen)return!0}catch{return!1}return!1}const Ge=e=>{let t="";if(e.hasOwnProperty("tool_calls")){const s=e.tool_calls[0];let n={};try{n=JSON.parse(s.function.arguments)}catch{}const r=s.function.name;if(t+=`${r}`,n.hasOwnProperty("actions"))for(const l of n.actions)t+=`
 · ${l.action_type} ${l.target_id}`,l.hasOwnProperty("value")&&(t+=` ${l.value}`)}else if(e.role==="tool")return"done";return t};var Je=p('<div class="border-4 rounded-full w-6 h-6 border-gray-500">'),Re=p('<div class="border-4 w-6 h-6 border-gray-500">'),He=p('<div><div class="flex w-full overflow-hidden"><div class="flex-none flex"></div><div class="flex flex-col overflow-hidden w-full">'),Fe=p('<div class="w-[1px] bg-gray-300">'),Ke=p('<div class="absolute left-1/2 top-5 flex justify-center -bottom-3 -translate-x-1/2">'),qe=p('<div class="flex-none h-6 flex items-center"><div class="h-2 w-2 rounded-full bg-gray-300">'),Qe=p('<div class="text-xs my-1 font-semibold">'),We=p("<div><button>View"),Xe=p('<div><div class="flex-1 text-xs text-gray-500 overflow-x-auto scrollbar-rounded overflow-hidden whitespace-pre-wrap"></div><div class="flex-none ml-4 px-10 w-16 flex justify-center">'),Ye=p('<div class="text-base whitespace-pre-wrap">'),Ze=p('<div><div class="flex h-full"><div class="relative flex-none h-full mx-2 w-2 flex"></div><div class="w-full overflow-hidden">');function ze(e){const t=s=>{if(s.role!=="tool")return!1;const n=JSON.parse(s.content);return n.hasOwnProperty("session_id")?n.hasOwnProperty("error_info"):!0};return(()=>{var s=He(),n=s.firstChild,r=n.firstChild,l=r.nextSibling;return d(r,S(Oe,{get children(){return[S(re,{get when(){return e.indexedMessageGroup[0].message.role==="user"},get children(){return Je()}}),S(re,{get when(){return e.indexedMessageGroup[0].message.role==="assistant"},get children(){return Re()}})]}})),d(l,S(xe,{get each(){return e.indexedMessageGroup},children:(i,o)=>(()=>{var f=Ze(),c=f.firstChild,u=c.firstChild,a=u.nextSibling;return d(u,S(N,{get when(){return e.indexedMessageGroup.length>1},get children(){return[(()=>{var h=Ke();return d(h,S(N,{get when(){return o()!==e.indexedMessageGroup.length-1},get children(){return Fe()}})),h})(),qe()]}})),d(a,S(N,{get when(){return i.message.tool_calls||i.message.role==="tool"},get children(){return[(()=>{var h=Qe();return d(h,()=>i.message.tool_calls?"call":"tool",null),d(h,()=>t(i.message)?" error!!!":"",null),h})(),(()=>{var h=Xe(),x=h.firstChild,v=x.nextSibling;return d(x,(()=>{var b=k(()=>e.detail===!0);return()=>b()?te(i.message):Ge(i.message)})()),d(v,S(N,{get when(){return we(i.message.content)},get children(){var b=We(),C=b.firstChild;return C.$$click=()=>e.setViewIndex(i.index),j($=>{var g=e.viewIndex===i.index,w=`${e.viewIndex===i.index?"bg-gray-300":"hover:bg-gray-200"}  border-gray-400 w-16 border-2 rounded-2xl py-1 text-xs font-semibold text-gray-400`;return g!==$.e&&(C.disabled=$.e=g),w!==$.t&&B(C,$.t=w),$},{e:void 0,t:void 0}),b}})),j(()=>B(h,`flex
                                                    ${e.detail===!0?"items-center":"items-start"} overflow-hidden`)),h})()]}}),null),d(a,S(N,{get when(){return i.message.role!=="tool"&&i.message.content},get children(){var h=Ye();return d(h,()=>i.message.content),h}}),null),j(()=>B(f,o()===0?"":"mt-2")),f})()})),j(()=>B(s,`flex px-6 py-4 ${e.indexedMessageGroup[0].message.role==="assistant"?"bg-gray-100":""}`)),s})()}X(["click"]);var et=p('<div class="h-full p-4 min-h-56"><div class="flex h-full flex-col rounded-3xl border-2 border-black overflow-hidden"><div class="relative border-b-2 border-black py-4 text-center rounded-t-3xl"><span class="text-2xl font-semibold">Dialog</span><label class="absolute right-2 bottom-1 flex justify-end items-center"><div class="h-4 w-4 rounded-full ring-2 ring-gray-700 flex justify-center items-center"></div><span class="ml-1 text-gray-700 text-base">detail</span></label></div><div class="overflow-y-auto scrollbar-rounded">'),tt=p('<div class="h-2 w-2 rounded-full bg-gray-700">');function st(e){let t;$e(()=>{if(e.scrollDownTrigger<=99){t.scrollTo({top:t.scrollHeight,behavior:"smooth"});return}t.scrollHeight-t.scrollTop<=t.clientHeight+150&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})});const s=k(()=>{const l=[];let i=null;const o=e.messages.map((f,c)=>({message:f,index:c}));for(let f of o)switch(f.message.role){case"user":i==="user"?l[l.length-1].push(f):(l.push([f]),i="user");break;case"assistant":i==="assistant"?l[l.length-1].push(f):(l.push([f]),i="assistant");break;case"tool":l[l.length-1].push(f);break}return l}),[n,r]=U(!1);return(()=>{var l=et(),i=l.firstChild,o=i.firstChild,f=o.firstChild,c=f.nextSibling,u=c.firstChild,a=o.nextSibling;c.$$click=()=>{r(!n())},d(u,(()=>{var x=k(()=>!!n());return()=>x()?tt():""})());var h=t;return typeof h=="function"?be(h,a):t=a,d(a,S(xe,{get each(){return s()},children:x=>S(ze,{indexedMessageGroup:x,get viewIndex(){return e.viewIndex},get setViewIndex(){return e.setViewIndex},get detail(){return n()}})})),l})()}X(["click"]);var nt=p("<div class=text-left>"),lt=p('<div class="my-6 rounded-xl border-2 border-dotted border-gray-500 px-4 py-2">'),rt=p('<span class="inline-block min-h-10 max-w-full p-2 m-1 text-base rounded-xl text-gray-800 whitespace-pre-wrap bg-gray-100 break-words">'),it=p('<div class="text-xs text-gray-500">'),ot=p('<div class="relative my-2 inline-block w-full"><button type=button class="bg-[radial-gradient(circle,_#D1D5DB_1px,_transparent_1px)] bg-[size:3px_3px] whitespace-normal break-words rounded-xl border-2 border-gray-500 px-3 py-2 text-base hover:bg-gray-300 w-full min-h-12"><span class="text-gray-800 font-semibold"></span></button><span class="absolute -top-2 -right-2 flex h-6 w-6 items-center justify-center rounded-full border-2 border-gray-500 bg-white text-xs font-semibold text-gray-800">'),at=p('<div class="text-xs text-gray-400">'),ct=p('<div class="relative my-2 inline-block w-full text-left"><div class="px-3 py-2 border-2 border-gray-500 rounded-xl max-h-48 overflow-auto scrollbar-rounded"><div class="flex justify-between"><span class="pb-1 text-base font-semibold text-gray-800"></span><span class="text-xs text-gray-500"></span></div><div class="whitespace-pre-wrap border-b-2 resize-none outline-none text-base text-gray-800 focus:border-gray-500"contenteditable=plaintext-only></div></div><span class="absolute -top-2 -right-2 flex h-6 w-6 items-center justify-center rounded-full border-2 border-gray-500 bg-white text-xs font-semibold text-gray-800">'),ut=p('<div class="h-full p-4 min-h-96"><div class="flex h-full flex-col justify-between rounded-3xl border-2 border-black"><div class=" border-b-2 border-black py-4 text-center rounded-t-3xl"><span class="text-2xl font-semibold">Screen</span></div><div class="relative border-t-2 border-black"><div class="flex justify-center py-8 text-center"><button class="w-44 border-r-2 border-white rounded-l-2xl pl-2 py-1 text-lg font-semibold text-white bg-gray-950 hover:bg-gray-600">New Session</button><button class="w-28 border-l-1 border-white rounded-r-2xl py-1 text-lg font-semibold text-white bg-gray-950 hover:bg-gray-600">Display</button></div><div class="absolute right-0 bottom-0 left-0 text-center text-xs text-gray-400 pb-0.5">'),ft=p('<div class="flex-1 overflow-y-auto scrollbar-rounded py-2 px-4 text-center">'),dt=p('<div class="bg-stripes-45 w-full h-full">');function ht(e){const t=new DOMParser,s=k(()=>{if(!e.content)return{};const c=JSON.parse(e.content),u=t.parseFromString(c.screen,"text/html");return{session_id:c.session_id,screen:n(u.body)}}),n=c=>{const u=nt();return r(u,c.childNodes),u},r=(c,u)=>{for(let a of u)switch(a.nodeName){case"DIV":c.appendChild(l(a)),l(a);break;case"INPUT":c.appendChild(f(a));break;case"BUTTON":c.appendChild(o(a));break;case"SPAN":c.appendChild(i(a));break}},l=c=>{const u=lt();return r(u,c.childNodes),u},i=c=>(()=>{var u=rt();return d(u,()=>c.textContent),u})(),o=c=>{const u=c.getAttribute("hint");return(()=>{var a=ot(),h=a.firstChild,x=h.firstChild,v=h.nextSibling;return h.$$click=()=>e.execute(s().session_id,[{action_type:"press",target_id:c.id}]),d(x,()=>c.innerText),d(h,S(N,{when:u!=null,get children(){var b=it();return d(b,u),b}}),null),d(v,()=>c.id),a})()},f=c=>{let u=c.getAttribute("value");const a=c.getAttribute("hint"),h=c.getAttribute("kind");return(()=>{var x=ct(),v=x.firstChild,b=v.firstChild,C=b.firstChild,$=C.nextSibling,g=b.nextSibling,w=v.nextSibling;return d(C,()=>c.name),d($,h),d(v,S(N,{when:a!=null,get children(){var y=at();return d(y,a),y}}),g),g.addEventListener("blur",y=>{const M=y.target.textContent;if(u===M)return;const D=[];D.push({action_type:"fill",target_id:c.id,value:M}),e.execute(s().session_id,D),u=M}),g.$$keydown=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),y.target.blur())},d(g,()=>c.getAttribute("value")),d(w,()=>c.id),x})()};return(()=>{var c=ut(),u=c.firstChild,a=u.firstChild,h=a.nextSibling,x=h.firstChild,v=x.firstChild,b=v.nextSibling,C=x.nextSibling;return d(u,(()=>{var $=k(()=>!!s().hasOwnProperty("screen"));return()=>$()?(()=>{var g=ft();return d(g,()=>s().screen),g})():dt()})(),h),je(v,"click",e.newSession),b.$$click=()=>e.display(s().session_id),d(C,(()=>{var $=k(()=>!!s().session_id);return()=>$()?`session_id: ${s().session_id}`:""})()),c})()}X(["click","keydown"]);const G="";class gt{constructor(){const[t,s]=U([]);this._messages=t,this._setMessages=s;const[n,r]=U(-1);this._viewIndex=n,this._setViewIndex=r;const[l,i]=U(0);this._scrollDownTrigger=l,this._setIsScrollDownTrigger=i,this._user_call_count=0}get messages(){return this._messages}get viewIndex(){return this._viewIndex}get setViewIndex(){return this._setViewIndex}get scrollDownTrigger(){return this._scrollDownTrigger}_setMessagesAndScrollDown(t,s=!0){this._setMessages(t),this._setIsScrollDownTrigger(n=>s?n>=99?0:n+1:n+100)}async addUserMessage(t){this._setMessagesAndScrollDown(n=>[...n,{role:"user",content:t}]),await this._predict();let s=0;for(;s<5&&this._messages()[this._messages().length-1].hasOwnProperty("tool_calls");)await this._call(),await this._predict(),s+=1}async _predict(){const t={role:"assistant",content:""};this._setMessagesAndScrollDown(o=>[...o,t]);const s=await fetch(`${G}/completions`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream, application/json"},body:JSON.stringify({messages:this._messages().slice(0,-1)})});if(!s.ok){const o=await s.text();throw new Error(`HTTP error! status: ${s.status}, ${o}`)}const n=s.headers.get("Content-Type");if(n==="application/json")throw new Error(`Server error: ${await s.json()}`);if(typeof n=="string"&&!n.includes("text/event-stream"))throw new Error(`Unexpected content type: ${n}`);const r=s.body.getReader(),l=new TextDecoder;let i="";for(;;){const{done:o,value:f}=await r.read();if(o)break;const c=l.decode(f);for(i+=c;;){const u=i.indexOf(`

`);if(u===-1)break;const a=i.slice(0,u);i=i.slice(u+2);const h=a.slice(6),x=JSON.parse(h);if(x.choices[0].finish_reason!=null)return;const b=x.choices[0].delta,C=b.content,$=b.tool_calls;if(C!=null)t.hasOwnProperty("content")||(t.content=""),t.content+=C,this._setMessagesAndScrollDown(g=>{const w=g[g.length-1];return w.hasOwnProperty("content")||(w.content=""),w.content=t.content,[...g]},!1);else if($!=null){const g=$[0],w=g.index,y=g.id,M=g.function.name,D=g.function.arguments,ne=g.type;this._setMessagesAndScrollDown(Y=>{const I=Y[Y.length-1];return I.hasOwnProperty("tool_calls")||(I.tool_calls=[{}]),w!=null&&(I.tool_calls[0].index=w),y!=null&&(I.tool_calls[0].id=y),M!=null&&(I.tool_calls[0].function={name:M}),D!=null&&(I.tool_calls[0].function.hasOwnProperty("arguments")||(I.tool_calls[0].function.arguments=""),I.tool_calls[0].function.arguments+=D),ne!=null&&(I.tool_calls[0].type=ne),[...Y]},!1)}else console.error("Unknown delta: ",b)}}}async addUserNewSessionMessage(){const t=this._getUserCallId();this._setMessagesAndScrollDown(s=>[...s,{role:"user",tool_calls:[{index:"0",id:t,function:{name:"new_session",arguments:"{}"},type:"function"}]}]),await this._call()}async addUserDisplayMessage(t){const s=this._getUserCallId();this._setMessagesAndScrollDown(n=>[...n,{role:"user",tool_calls:[{index:"0",id:s,function:{name:"display",arguments:JSON.stringify({session_id:t})},type:"function"}]}]),await this._call()}async addUserExecuteMessage(t,s){const n=this._getUserCallId();this._setMessagesAndScrollDown(r=>[...r,{role:"user",tool_calls:[{id:n,function:{name:"execute",arguments:JSON.stringify({session_id:t,actions:s})},type:"function"}]}]),await this._call()}_getUserCallId(){return`user_call_${this._user_call_count++}`}async _call(){const t=this._messages()[this._messages().length-1];if(!t.hasOwnProperty("tool_calls"))return;const s=t.tool_calls[0].id,n=t.tool_calls[0].function.name,r=t.tool_calls[0].function.arguments;let l="";switch(n){case"new_session":l=`${G}/session`;break;case"display":l=`${G}/display`;break;case"execute":l=`${G}/execute`;break;default:console.error("Unknown function name: ",n);return}let o=await(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:r})).text();this._setMessagesAndScrollDown(f=>[...f,{role:"tool",content:o,tool_call_id:s}]),we(o)===!0&&this.setViewIndex(this.messages().length-1)}}var pt=p('<div class="px-4 pb-4 w-full text-left"><div class="flex pl-6 pr-2 border-2 border-black rounded-3xl overflow-y-hidden"><div class="flex-1 min-h-10 max-h-32 overflow-y-auto scrollbar-rounded"><div class=" my-2 resize-none outline-none text-base text-gray-800"contenteditable=plaintext-only></div></div><div class="flex-none flex justify-center items-end"><button class="group ml-4 mb-1 flex items-center justify-center w-8 h-8 border-4 border-gray-950 rounded-full py-1 text-xs font-semibold text-gray-400 hover:border-gray-600"><div class="w-4 h-4 bg-gray-950 rounded-full group-hover:bg-gray-600">');function xt(e){let t;const s=()=>{const n=t.textContent;n.trim()!==""&&(t.textContent="",e.send(n))};return(()=>{var n=pt(),r=n.firstChild,l=r.firstChild,i=l.firstChild,o=l.nextSibling,f=o.firstChild;i.$$keydown=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),s())};var c=t;return typeof c=="function"?be(c,i):t=i,f.$$click=s,n})()}X(["keydown","click"]);var bt=p('<div class="flex h-screen"><div class="flex flex-1 flex-col justify-between min-h-96 min-w-96"><div class="flex-1 overflow-hidden"></div><div class=flex-none></div></div><div class="h-screen w-96 flex-none">');function wt(){const e=new gt;return(()=>{var t=bt(),s=t.firstChild,n=s.firstChild,r=n.nextSibling,l=s.nextSibling;return d(n,S(st,{get messages(){return e.messages()},get viewIndex(){return e.viewIndex()},get setViewIndex(){return e.setViewIndex},get scrollDownTrigger(){return e.scrollDownTrigger()}})),d(r,S(xt,{send:i=>e.addUserMessage(i)})),d(l,S(ht,{get content(){return k(()=>e.viewIndex()!==-1)()?e.messages()[e.viewIndex()].content:""},newSession:()=>e.addUserNewSessionMessage(),display:i=>e.addUserDisplayMessage(i),execute:(i,o)=>e.addUserExecuteMessage(i,o)})),t})()}const yt=document.getElementById("root");Ne(()=>S(wt,{}),yt);
