import{r as E,u as z,a as H,j as J,a5 as O,a9 as P,s as y,A as R,aa as C,F as Q,q as x,ab as Z,ac as k,i as V,d as ee}from"./index-80a466be.js";import{u as h,M as g}from"./project-d7b36bbd.js";import{M as b}from"./file-ced61d36.js";import{u as te}from"./editor-00a7f1d7.js";const le={Added:1,Modified:2,Deleted:3},G=E.createContext({artifactRename:void 0,setArtifactRename:()=>{},selectArtifactsInRange:()=>new Set,createDirectory:()=>{},createFile:()=>{},renameArtifact:()=>{},removeArtifacts:()=>{},removeArtifactWithConfirmation:()=>{},moveArtifacts:()=>{},isTopGroupInActiveRange:()=>!1,isBottomGroupInActiveRange:()=>!1,isMiddleGroupInActiveRange:()=>!1});function re({children:$}){const{addError:F}=z(),A=h(e=>e.activeRange),l=h(e=>e.project),_=h(e=>e.files),D=h(e=>e.setActiveRange),M=h(e=>e.setSelectedFile),I=h(e=>e.setFiles),c=h(e=>e.inActiveRange),S=H(e=>e.addConfirmation),f=te(e=>e.tab),[v,r]=E.useState(!1),[N,L]=E.useState();E.useEffect(()=>{M(f==null?void 0:f.file)},[f==null?void 0:f.id]);function X(e){const n=A.length-1,s=l.allVisibleArtifacts,u=A[0],a=A[n],i=s.indexOf(e),o=u==null?0:s.indexOf(u),d=a==null?n:s.indexOf(a),m=i>o?o:i,p=i>d||i>o&&i<d?i:d;D(s.slice(m,p+1))}function q(e){if(v)return;r(!0);const t=O("new_directory");P([e.path,t].join("/"),{}).then(n=>{y(n)||e.open()}).catch(n=>F(R.FileExplorer,n)).finally(()=>{r(!1)})}function w(e,t){if(v)return;y(t)&&(e.isModels?t=".sql":e.isTests?t=".yaml":t=".py"),r(!0);const n=O("new_file",t);C(`${e.path}/${n}`,{content:""}).then(s=>{y(s)||e.open()}).catch(s=>F(R.FileExplorer,s)).finally(()=>{r(!1)})}function Y(e,t){var i;t=t==null?void 0:t.trim();const s=(((i=e.parent)==null?void 0:i.artifacts)??[]).some(o=>o.name===t);if(v||Q(t)||s)return;r(!0);const u=e.name,a=e.path;e.rename(t),e instanceof g&&P(a,{new_path:e.path}).catch(o=>{F(R.FileExplorer,o),e.rename(u)}).finally(()=>{r(!1),x(f)&&e.hasFile(f.file)&&M(f.file),I(l.allFiles)}),e instanceof b&&C(a,{new_path:e.path}).then(o=>{e.update(o),_.set(e.path,e),_.delete(a)}).catch(o=>{F(R.FileExplorer,o),e.rename(u)}).finally(()=>{r(!1),I(l.allFiles)})}function T(e){if(v)return;r(!0);const t=e.map(n=>n instanceof b?Z(n.path):k(n.path));Promise.all(t).then(()=>{D([])}).catch(n=>F(R.FileExplorer,n)).finally(()=>{r(!1)})}function B(e){c(e)?S({headline:"Removing Selected Files/Directories",description:`Are you sure you want to remove ${A.length} items?`,yesText:"Yes, Remove",noText:"No, Cancel",details:A.map(t=>t.path),action:()=>{T(A)}}):S({headline:`Removing ${e instanceof g?"Directory":"File"}`,description:`Are you sure you want to remove the ${e instanceof g?"directory":"file"} "${e.name}"?`,yesText:"Yes, Remove",noText:"No, Cancel",action:()=>{x(e.parent)&&T([e])}})}function j(e,t,n=!1){if(v)return;r(!0);const s=[],u=[],a=[];if(e.forEach(i=>{const o=t.containsName(i.name),d=i.path;if(o&&V(n))return a.push(i);n&&i.rename(i.copyName());const m=[t.path,i.name].join("/");i instanceof g&&(s.push(()=>{var p;(p=i.parent)==null||p.removeDirectory(i),t.addDirectory(i)}),u.push(P(d,{new_path:m})),i.allVisibleArtifacts.forEach(p=>e.splice(e.indexOf(p),1))),i instanceof b&&(s.push(()=>{var p;(p=i.parent)==null||p.removeFile(i),t.addFile(i)}),u.push(C(d,{new_path:m})))}),ee(a)){S({headline:"Moving Duplicates",description:"All duplicated names will be renamed!",yesText:"Yes, Rename",noText:"No, Cancel",details:a.map(i=>i.path),action:()=>{j(e,t,!0)}});return}Promise.all(u).then(i=>{i.forEach((o,d)=>{var m;return(m=s[d])==null?void 0:m.call(s)})}).catch(i=>{console.log(i)}).finally(()=>{r(!1),D([]),I(l.allFiles)})}function W(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return c(e)&&(y(n)||V(c(n)))&&x(s)&&c(s)}function K(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return c(e)&&(y(s)||V(c(s)))&&x(n)&&c(n)}function U(e){const t=l.allVisibleArtifacts.indexOf(e),n=l.allVisibleArtifacts[t-1],s=l.allVisibleArtifacts[t+1];return c(e)&&x(s)&&c(s)&&x(n)&&c(n)}return J.jsx(G.Provider,{value:{artifactRename:N,setArtifactRename:L,createDirectory:q,createFile:w,renameArtifact:Y,removeArtifacts:T,removeArtifactWithConfirmation:B,moveArtifacts:j,selectArtifactsInRange:X,isTopGroupInActiveRange:W,isBottomGroupInActiveRange:K,isMiddleGroupInActiveRange:U},children:$})}function ce(){return E.useContext(G)}export{le as EnumFileExplorerChange,G as FileExplorerContext,re as default,ce as useFileExplorer};
