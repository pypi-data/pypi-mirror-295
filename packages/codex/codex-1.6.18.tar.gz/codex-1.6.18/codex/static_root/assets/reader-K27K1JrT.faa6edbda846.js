const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-doc-C_RhfgHE.js","assets/admin-drawer-panel-D4CYCd_H.js","assets/admin-drawer-panel-Bs2wgKj3.css","assets/main-BnyyRHtu.js","assets/main-BZ73p_WW.css","assets/pdf-doc-CkC2e3rI.css"])))=>i.map(i=>d[i]);
import{aB as w,T as f,U as b,_ as m,W as h,X as i,V as g,Y as d,S as n,aN as y,ah as k,aE as v,ai as C,aG as S,aC as P,aM as r,aT as Q,an as B,by as ke,bz as be,ao as U,bA as Z,bB as ee,aF as te,bC as oe,bD as fe,b2 as _e,aP as D,bv as ve,aD as $,bo as ae,bE as Pe,b0 as we,aJ as Se,bF as ye,bG as Ce,D as M,bH as Re,bI as Be,bJ as De,bK as Te,bL as Ie,aK as Le,m as T,bM as Ve,am as re,aQ as W,bN as Oe,aR as F,bO as $e,bP as Ne,bQ as Ee,be as Ae,bf as xe,bg as Ue,bh as Fe,bR as ze,aU as Me,bS as We,bT as se,bi as He,bl as qe,bU as Ge,bV as Ke}from"./admin-drawer-panel-D4CYCd_H.js";import{b as c,e as je,_ as Ye,S as E,R as Xe,r as ne,V as Je,h as Qe,i as Ze,d as z}from"./main-BnyyRHtu.js";import{d as et,b as tt,S as ot,V as at,a as rt}from"./settings-drawer-CF0z39tG.js";import{P as st,E as ie,U as nt,V as it}from"./unauthorized-CFFrmehB.js";import{b as le,V as ce}from"./VWindowItem-COG2FuUz.js";import{a as lt}from"./VSelect-DhYHkIlU.js";import{V as ct,a as dt,b as ut,c as ht}from"./VExpansionPanels-BIAAQEIk.js";import{V as I,a as A}from"./VRadioGroup-CQd2B2cC.js";import{V as L}from"./VCheckbox-D_kRyvnz.js";import{T as gt,M as pt,V as x,a as mt,P as de,b as kt,c as bt}from"./pagination-toolbar-B-H-BgUh.js";import"./copy-to-clipboard-DoUvDJVx.js";import"./VDialog-DOm1w6bL.js";import"./change-password-dialog-CrIdNi1F.js";import"./VTextField-CWKnATIB.js";import"./VSelectionControl-DZ7Z3QaY.js";import"./VCheckboxBtn-CasNFNDK.js";import"./VSlideGroup-BfZo3lM5.js";const ft={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){if(this.isDrawerOpen)return this.prefetchLinks(this.params,this.computedDirection,!0)},computed:{...w(c,["isBTT"]),...f(c,{computedDirection(){return this.normalizeDirection(this.direction)},params(e){return e.routes.books[this.computedDirection]},isDrawerOpen(e){return e.bookChange===this.computedDirection},icon(){return this.bookChangeIcon(this.computedDirection)}}),drawerLocation(){return this.bookChangeLocation(this.direction)},cursorClass(){return this.bookChangeCursorClass(this.computedDirection)},show(){return this.bookChangeShow(this.computedDirection)},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Book")}},methods:{...b(c,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute","bookChangeLocation","bookChangeCursorClass","bookChangeShow","bookChangeIcon"])}};function _t(e,t,a,p,l,o){const s=h("router-link");return o.show?(i(),g(et,{key:0,class:C(["bookChangeDrawer",{drawerActivated:e.isDrawerOpen}]),"disable-resize-watcher":"","disable-route-watcher":"",location:o.drawerLocation,"model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:d(()=>[n(s,{class:C({navLink:!0,[o.cursorClass]:!0}),to:o.route,"aria-label":o.label,title:o.label,onClick:t[0]||(t[0]=u=>u.stopImmediatePropagation())},{default:d(()=>[n(y,{class:"bookChangeIcon"},{default:d(()=>[k(v(e.icon),1)]),_:1})]),_:1},8,["class","to","aria-label","title"])]),_:1},8,["location","model-value","class"])):S("",!0)}const vt=m(ft,[["render",_t],["__scopeId","data-v-03e41a14"]]),Pt={name:"BookChangeActivator",components:{BookChangeDrawer:vt},props:{direction:{type:String,required:!0}},computed:{computedDirection(){return this.normalizeDirection(this.direction)},positionClass(){return this.bookChangeLocation(this.direction)+"Pos"},cursorClass(){return this.bookChangeCursorClass(this.direction)}},methods:{...b(c,["setBookChangeFlag","normalizeDirection","bookChangeLocation","bookChangeCursorClass"])}};function wt(e,t,a,p,l,o){const s=h("BookChangeDrawer");return i(),P(B,null,[r("div",{class:C(["changeColumn",{[o.positionClass]:!0,[o.cursorClass]:!0}]),onClick:t[0]||(t[0]=Q(u=>e.setBookChangeFlag(a.direction),["stop"]))},null,2),n(s,{direction:a.direction},null,8,["direction"])],64)}const St=m(Pt,[["render",wt],["__scopeId","data-v-79e1dd62"]]),yt={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return this.prefetchLinks(this.params,this.computedDirection)},computed:{...w(c,["isFirstPage","isLastPage","isVertical"]),...f(c,{params(e){return e.routes[this.computedDirection]}}),computedDirection(){return this.normalizeDirection(this.direction)},show(){return this.isVertical?!1:this.computedDirection==="prev"?!this.isFirstPage:!this.isLastPage},pageChangeClass(){return"pageChangeColumn"},directionClass(){return this.direction},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Page")}},methods:{...b(c,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute"])}};function Ct(e,t,a,p,l,o){const s=h("router-link");return o.show?(i(),g(s,{key:0,to:o.route,"aria-label":o.label,class:C(["changeColumn",{[o.directionClass]:!0}]),onClick:t[0]||(t[0]=u=>u.stopImmediatePropagation())},null,8,["to","aria-label","class"])):S("",!0)}const Rt=m(yt,[["render",Ct],["__scopeId","data-v-ffe6f5d6"]]),Bt={name:"LoadingPage",components:{Placeholder:st},props:{twoPages:{type:Boolean,required:!0}}};function Dt(e,t,a,p,l,o){const s=h("Placeholder");return i(),P("div",{class:C(["pageLoading",{twoPages:a.twoPages}])},[n(s,{class:"pagePlaceholder"})],2)}const Tt=m(Bt,[["render",Dt],["__scopeId","data-v-04027168"]]),H="unauthorized",It={name:"ErrorPage",components:{EmptyState:ie},props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},emits:["retry"],computed:{text(){return this.type===H?"Protected page":"Failed to load page"},icon(){return this.type===H?ke:be}},methods:{onAction(e){this.$emit("retry",e)}}};function Lt(e,t,a,p,l,o){const s=h("EmptyState");return i(),g(s,{class:C(["pageError",{twoPages:a.twoPages}]),headline:o.text,icon:o.icon,"action-text":"Retry","onClick:action":o.onAction},null,8,["class","headline","icon","onClick:action"])}const Vt=m(It,[["render",Lt],["__scopeId","data-v-97fa48e8"]]),Ot={name:"ImgPage",props:{book:{type:Object,required:!0},src:{type:String,required:!0}},emits:["load","error"],computed:{...f(c,{scale:e=>e.clientSettings.scale}),style(){const e={};if(this.scale==1)return e;const t=this.$el;if(!(t!=null&&t.naturalWidth))return e;const a=t.naturalWidth/2;return e.transformOrigin=`${a}px top`,e.transform=`scale(${this.scale})`,e},classes(){return this.fitToClass(this.book)}},methods:{...b(c,["fitToClass"])}},$t=["src"];function Nt(e,t,a,p,l,o){return i(),P("img",U({class:[o.classes,"img"],draggable:"false",src:a.src,style:o.style},e.$attrs,{onError:t[0]||(t[0]=s=>e.$emit("error",s)),onLoad:t[1]||(t[1]=s=>e.$emit("load",s))}),null,16,$t)}const q=m(Ot,[["render",Nt],["__scopeId","data-v-559e2ecc"]]),G=Z(ee(()=>Ye(()=>import("./pdf-doc-C_RhfgHE.js"),__vite__mapDeps([0,1,2,3,4,5])))),Et=333,At={name:"BookPage",components:{ErrorPage:Vt,LoadingPage:Tt,PDFDoc:G,ImgPage:q},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:"",ts:0}},computed:{...f(c,{scale:e=>e.clientSettings.scale}),style(){var a;const e={};if(this.book.fileType==="PDF"||this.scale==1)return e;const t=(a=this.$refs.pageComponent)==null?void 0:a.$el;return t!=null&&t.naturalHeight&&(e.height=t.naturalHeight*this.scale+"px",e.width=t.naturalWidth*this.scale+"px"),e},src(){const e=Math.max(this.book.mtime,this.ts),t={pk:this.book.pk,page:this.page,mtime:e};return je(t)},component(){return this.book.fileType==="PDF"?G:q},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},Et)},methods:{...b(c,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1},onRetry(){this.ts=Date.now()}}},xt=["id","data-page"];function Ut(e,t,a,p,l,o){const s=h("ErrorPage"),u=h("LoadingPage");return i(),P("div",{id:`page${a.page}`,key:l.ts,"data-page":a.page,class:"page",style:oe(o.style)},[l.error?(i(),g(s,{key:0,"two-pages":o.settings.twoPages,type:l.error,onRetry:o.onRetry},null,8,["two-pages","type","onRetry"])):l.showProgress&&!l.loaded?(i(),g(u,{key:1,"two-pages":o.settings.twoPages},null,8,["two-pages"])):(i(),g(te(o.component),{key:2,ref:"pageComponent",book:a.book,page:1,src:o.src,onError:o.onError,onLoad:o.onLoad,onUnauthorized:o.onUnauthorized},null,40,["book","src","onError","onLoad","onUnauthorized"]))],12,xt)}const ue=m(At,[["render",Ut],["__scopeId","data-v-c46b2adf"]]),Ft=.5,zt={name:"ScaleForScroll",emits:["click"],data(){return{mdiMagnifyMinusOutline:fe}},computed:{...f(c,{scale:e=>e.clientSettings.scale}),showReset(){return this.scale!=E},style(){return{cursor:this.scale==E?"zoom-in":"all-scroll"}}},methods:{...b(c,["setSettingsClient"]),clearSelection(){window.getSelection&&window.getSelection().removeAllRanges()},onDoubleClick(){this.clearSelection();const e=this.scale+Ft;this.setSettingsClient({scale:e})},scaleReset(){this.setSettingsClient({scale:E})}}};function Mt(e,t,a,p,l,o){const s=_e("drag-scroller");return D((i(),P("div",{class:"scaleForScroll",style:oe(o.style),onDblclick:t[0]||(t[0]=(...u)=>o.onDoubleClick&&o.onDoubleClick(...u))},[ve(e.$slots,"default",{},void 0,!0),o.showReset?(i(),g(y,{key:0,class:"resetIcon",onClick:Q(o.scaleReset,["stop"])},{default:d(()=>[k(v(l.mdiMagnifyMinusOutline),1)]),_:1},8,["onClick"])):S("",!0)],36)),[[s,,void 0,{onlyX:!0}]])}const he=m(zt,[["render",Mt],["__scopeId","data-v-a222c504"]]),Wt={name:"HorizontalPages",components:{BookPage:ue,ScaleForScroll:he},props:{book:{type:Object,required:!0},page:{type:Number,required:!0},isReadInReverse:{type:Boolean,required:!0}},emits:["click"],computed:{showSecondPage(){return this.getSettings(this.book).twoPages&&this.page<this.book.maxPage&&!this.isCoverPage(this.book,this.page)},showPageOne(){return!this.isReadInReverse||this.showSecondPage},showPageTwo(){return this.isReadInReverse||this.showSecondPage},pageOne(){return this.isReadInReverse?this.page+1:this.page},pageTwo(){return this.isReadInReverse?this.page:this.page+1}},methods:{...b(c,["getSettings","isCoverPage"])}};function Ht(e,t,a,p,l,o){const s=h("BookPage"),u=h("ScaleForScroll");return i(),g(u,{class:"noWrap"},{default:d(()=>[o.showPageOne?(i(),g(s,{key:0,ref:"pageOne",book:a.book,page:o.pageOne,class:"horizontalPage"},null,8,["book","page"])):S("",!0),o.showPageTwo?(i(),g(s,{key:1,book:a.book,page:o.pageTwo,class:"horizontalPage"},null,8,["book","page"])):S("",!0)]),_:1})}const qt=m(Wt,[["render",Ht],["__scopeId","data-v-51a9fa88"]]),Gt=48,Kt=48,jt={name:"PagerHorizontal",components:{HorizontalPages:qt},props:{book:{type:Object,required:!0},bookSettings:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...f(c,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.books.current.pk}),twoPages(){return this.bookSettings.twoPages},isReadInReverse(){return Xe.has(this.bookSettings.readingDirection)},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),a=this.pages.at(-1);(e<t||e>a)&&this.setPages()}},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{...b(c,["setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-Gt,0),t=Math.min(this.activePage+Kt,this.book.maxPage);this.pages=ne(e,t+1)}}};function Yt(e,t,a,p,l,o){const s=h("HorizontalPages");return i(),g(ce,{continuous:"","model-value":o.windowIndex,reverse:o.isReadInReverse},{default:d(()=>[(i(!0),P(B,null,$(l.pages,u=>(i(),g(le,{key:`c/${a.book.pk}/${u}`,class:"windowItem",disabled:"",eager:u>=e.storePage-1&&u<=e.storePage+2,"model-value":u,transition:!0},{default:d(()=>[n(s,{book:a.book,page:u,"is-read-in-reverse":o.isReadInReverse},null,8,["book","page","is-read-in-reverse"])]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const K=m(jt,[["render",Yt],["__scopeId","data-v-c8876f9e"]]),Xt=12,j=250,Jt={name:"PagerVertical",components:{BookPage:ue,ScaleForScroll:he},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1,intersectOptions:{handler:this.onIntersect,options:{threshold:[.75]}}}},computed:{...f(c,{storePage:e=>e.page,showToolbars:e=>e.showToolbars}),...ae(c,["reactWithScroll"]),settings(){return this.getSettings(this.book)},readInReverse(){return this.settings.readInReverse},items(){var a;const e=(a=this.book)!=null&&a.maxPage?this.book.maxPage+1:0,t=ne(0,e);return this.readInReverse&&t.reverse(),t},visibleItems(){var e;return Math.min(((e=this.book)==null?void 0:e.maxPage)??0,Xt)}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},j)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...b(c,["setActivePage","setBookChangeFlag","getSettings"]),onIntersect(e,t){if(e&&this.intersectorOn){const p=+t[0].target.dataset.page;this.setActivePage(p,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const a=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=a&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find verticalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},j)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},Qt=["data-page"];function Zt(e,t,a,p,l,o){const s=h("BookPage"),u=h("ScaleForScroll");return i(),g(u,null,{default:d(()=>[D((i(),g(lt,{id:"verticalScroll",key:o.readInReverse,ref:"verticalScroll",items:o.items,height:l.innerHeight,width:l.innerWidth},{default:d(({item:_})=>[n(s,{book:a.book,page:_,class:"verticalPage"},null,8,["book","page"]),D(r("div",{class:C(["pageTracker",{pageTrackerToolbars:e.showToolbars}]),"data-page":_},null,10,Qt),[[we,l.intersectOptions,void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[Pe,o.onScroll,"#verticalScroll"]])]),_:1})}const Y=m(Jt,[["render",Zt],["__scopeId","data-v-215a8b67"]]),X=Z(ee(()=>"@/components/reader/pager/pager-full-pdf.vue")),eo={name:"PagerSelector",components:{PagerHorizontal:K,PagerPDF:X,PagerVertical:Y},props:{book:{type:Object,required:!0}},emits:["click"],head(){return this.prefetchBook(this.book)},computed:{...w(c,["cacheBook"]),...f(c,{storePk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0}}),isActiveBook(){var e;return this.book&&this.storePk===((e=this.book)==null?void 0:e.pk)},bookSettings(){return this.getSettings(this.book)},isVertical(){return Je.has(this.bookSettings.readingDirection)},readerFullPdf(){var e;return((e=this.book)==null?void 0:e.fileType)=="PDF"&&this.cacheBook&&!this.isVertical},component(){return this.readerFullPdf?X:this.isVertical?Y:K}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.isActiveBook&&this.setActivePage(+this.$route.params.page,!0)},methods:{...b(c,["getSettings","setActivePage","prefetchBook"])}};function to(e,t,a,p,l,o){return i(),g(te(o.component),{book:a.book,"book-settings":o.bookSettings,"is-vertical":o.isVertical},null,8,["book","book-settings","is-vertical"])}const oo=m(eo,[["render",to]]),ao={name:"BooksWindow",components:{BookChangeActivator:St,PageChangeLink:Rt,Pager:oo},computed:{...w(c,["isBTT"]),...f(c,{books:e=>[e.books.prev,e.books.current,e.books.next].filter(Boolean),bookChange:e=>e.bookChange,currentBookPk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0},bookRoutes:e=>e.routes.books}),bookChangePrev(){return this.bookChangeShow("prev")},bookChangeNext(){return this.bookChangeShow("next")}},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks({params:e.params})}},beforeMount(){this.setBookChangeFlag(),this.loadBooks({})},methods:{...b(c,["bookChangeShow","loadBooks","setBookChangeFlag","toggleToolbars"]),click(){this.toggleToolbars(),this.setBookChangeFlag()},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function ro(e,t,a,p,l,o){const s=h("BookChangeActivator"),u=h("PageChangeLink"),_=h("Pager");return i(),g(ce,{id:"booksWindow",direction:"vertical","model-value":e.currentBookPk,reverse:e.isBTT,"show-arrows":"",onClick:e.toggleToolbars},{prev:d(()=>[o.bookChangePrev?(i(),g(s,{key:0,direction:"prev"})):(i(),g(u,{key:1,direction:"prev"}))]),next:d(()=>[o.bookChangeNext?(i(),g(s,{key:0,direction:"next"})):(i(),g(u,{key:1,direction:"next"}))]),default:d(()=>[(i(!0),P(B,null,$(e.books,R=>(i(),g(le,{key:`c/${R.pk}`,class:"windowItem",disabled:"",eager:o.eager(R.pk),value:R.pk,transition:!0},{default:d(()=>[n(_,{book:R,onClick:o.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","reverse","onClick"])}const so=m(ao,[["render",ro],["__scopeId","data-v-ba92d91b"]]),no={name:"DownloadPanel",components:{DrawerItem:Se},data(){return{mdiDownload:ye,mdiFileImage:Ce}},computed:{...w(c,["activeTitle","routeParams"]),...f(c,{currentBook:e=>{var t;return(t=e.books)==null?void 0:t.current},storePage:e=>e.page}),downloadURL(){return Qe(this.currentBook)},filename(){var e;return(e=this.currentBook)==null?void 0:e.filename},pageSrc(){const{pk:e,mtime:t}=this.currentBook;return Ze({pk:e,page:this.storePage,mtime:t})},pageName(){return`${this.activeTitle} - page ${this.storePage}.jpg`},downloadPageTitle(){return`Download Page ${this.storePage}`}},methods:{...b(M,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.filename)}}},io={key:0,id:"downloadPanel"};function lo(e,t,a,p,l,o){const s=h("DrawerItem");return e.currentBook?(i(),P("div",io,[n(s,{"prepend-icon":l.mdiFileImage,title:o.downloadPageTitle,onClick:o.downloadPage},null,8,["prepend-icon","title","onClick"]),n(s,{"prepend-icon":l.mdiDownload,title:"Download Book",onClick:o.downloadBook},null,8,["prepend-icon","onClick"])])):S("",!0)}const co=m(no,[["render",lo],["__scopeId","data-v-e4f5bb93"]]),uo={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:Re,mdiMenuRight:Be,mdiKeyboardOutline:De,mdiKeyboardSpace:Te,mdiAppleKeyboardShift:Ie}},computed:{...w(M,["isMobile"])}},ho={class:"highlight-table"};function go(e,t,a,p,l,o){return e.isMobile?S("",!0):(i(),g(ht,{key:0},{default:d(()=>[n(ct,{id:"readerKeyboardShortcuts"},{default:d(()=>[n(dt,{id:"shortcutsTitle"},{default:d(()=>[n(y,{id:"keyboardIcon"},{default:d(()=>[k(v(l.mdiKeyboardOutline),1)]),_:1}),t[0]||(t[0]=k("Keyboard Shortcuts "))]),_:1}),n(ut,null,{default:d(()=>[t[10]||(t[10]=r("h4",null,"Navigation",-1)),r("table",ho,[r("tbody",null,[r("tr",null,[r("td",null,[n(y,{class:"keyIcon",density:"compact"},{default:d(()=>[k(v(l.mdiMenuLeft),1)]),_:1}),t[1]||(t[1]=k(", j, ")),r("div",null,[n(y,{class:"keyIcon",density:"compact"},{default:d(()=>[k(v(l.mdiAppleKeyboardShift),1)]),_:1}),n(y,{class:"keyIcon",density:"compact"},{default:d(()=>[k(v(l.mdiKeyboardSpace),1)]),_:1})])]),t[2]||(t[2]=r("td",null,"Previous page",-1))]),r("tr",null,[r("td",null,[n(y,{class:"keyIcon",density:"compact"},{default:d(()=>[k(v(l.mdiMenuRight),1)]),_:1}),t[3]||(t[3]=k(", k, ")),n(y,{class:"keyIcon",density:"compact"},{default:d(()=>[k(v(l.mdiKeyboardSpace),1)]),_:1})]),t[4]||(t[4]=r("td",null,"Next page",-1))]),t[5]||(t[5]=r("tr",null,[r("td",null,","),r("td",null,[k("Next "),r("em",null,"only"),k(" one page in two page mode.")])],-1)),t[6]||(t[6]=r("tr",null,[r("td",null,"."),r("td",null,[k("Previous "),r("em",null,"only"),k(" one page in two page mode.")])],-1)),t[7]||(t[7]=r("tr",null,[r("td",null,"p"),r("td",null,"Previous Book")],-1)),t[8]||(t[8]=r("tr",null,[r("td",null,"n"),r("td",null,"Next Book")],-1)),t[9]||(t[9]=r("tr",null,[r("td",null,"esc"),r("td",null,"Close book")],-1))])]),t[11]||(t[11]=r("h4",null,"Fit Page To",-1)),t[12]||(t[12]=r("table",{class:"highlight-table"},[r("tbody",null,[r("tr",null,[r("td",null,"s"),r("td",null,"screen")]),r("tr",null,[r("td",null,"h"),r("td",null,"screen height")]),r("tr",null,[r("td",null,"w"),r("td",null,"screen width")]),r("tr",null,[r("td",null,"o"),r("td",null,"Show page at original size")]),r("tr",null,[r("td",null,"2"),r("td",null,"Toggle two page view")]),r("tr",null,[r("td",null,"r"),r("td",null,"Read Right to Left")]),r("tr",null,[r("td",null,"l"),r("td",null,"Read Left to Right")]),r("tr",null,[r("td",null,"t"),r("td",null,"Read Top to Bottom")]),r("tr",null,[r("td",null,"b"),r("td",null,"Read in Bottom to Top")])])],-1)),t[13]||(t[13]=r("h4",null,"Other",-1)),t[14]||(t[14]=r("table",{class:"highlight-table"},[r("tbody",null,[r("tr",null,[r("td",null,"m"),r("td",null,"Show comic's metadata")]),r("tr",null,[r("td",null,"double click"),r("td",null,"Zoom page")])])],-1))]),_:1})]),_:1})]),_:1}))}const po=m(uo,[["render",go],["__scopeId","data-v-a8b4ac47"]]),ge=["fitTo","readingDirection","twoPages"];Object.freeze(ge);const mo={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1,mdiOpenInNew:Le,openDelay:2e3}},computed:{...w(T,["isAuthDialogOpen"]),...w(c,["isVertical","isPDF","cacheBook"]),...f(c,{choices:e=>e.choices,validBook:e=>{var t;return!!((t=e.books)!=null&&t.current)},selectedSettings(e){var t,a;return this.isGlobalScope||!((t=e.books)!=null&&t.current)?e.readerSettings:(a=e.books)==null?void 0:a.current.settings},isClearSettingsButtonDisabled(e){var t,a;if(this.isGlobalScope||!((t=e.books)!=null&&t.current))return!0;for(const p of ge){const l=(a=e.books)==null?void 0:a.current.settings[p];if(!e.choices.nullValues.has(l))return!1}return!0},bookInBrowserURL(e){var t,a;return(t=e.books)!=null&&t.current?Ve((a=e.books)==null?void 0:a.current):""},finishOnLastPage:e=>e.readerSettings.finishOnLastPage}),...ae(c,["readRtlInReverse"]),fitToChoices(){return this.choicesWithoutNull("fitTo")},readingDirectionChoices(){return this.choicesWithoutNull("readingDirection")},disableTwoPages(){return this.isVertical||this.isPDF&&this.cacheBook},disableCacheBook(){return this.isVertical&&this.isPDF}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...b(c,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal","setSettingsClient"]),settingsDialogChanged(e){this.isGlobalScope?this.setSettingsGlobal(e):this.setSettingsLocal(e)},choicesWithoutNull(e){const t=[];for(const a of this.choices[e])a.value&&t.push(a);return Object.freeze(t),t},_keyUpListener(e){if(e.stopPropagation(),this.isAuthDialogOpen)return;let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"l":t={readingDirection:"ltr"};break;case"r":t={readingDirection:"rtl"};break;case"t":t={readingDirection:"ttb"};break;case"b":t={readingDirection:"bbt"};break}t&&this.setSettingsLocal(t)}}},ko={id:"readerScopedSettings",class:"readerDrawerItem"},bo=["href"];function fo(e,t,a,p,l,o){return i(),P(B,null,[n(A,{modelValue:l.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=s=>l.isGlobalScope=s),class:"scopeRadioButton readerDrawerItem",density:"compact",label:"Scope","hide-details":"auto"},{default:d(()=>[n(I,{label:"Only this comic",value:!1}),n(I,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),n(Oe,null,{default:d(()=>[r("div",ko,[n(A,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=s=>o.settingsDialogChanged({fitTo:s}))},{default:d(()=>[(i(!0),P(B,null,$(o.fitToChoices,s=>(i(),g(I,{key:s.value,label:s.title,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(L,{disabled:o.disableTwoPages,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=s=>o.settingsDialogChanged({twoPages:s}))},null,8,["disabled","model-value","indeterminate"]),n(A,{class:"displayRadioGroup",density:"compact",label:"Reading Direction","hide-details":"auto","model-value":e.selectedSettings.readingDirection,"onUpdate:modelValue":t[3]||(t[3]=s=>o.settingsDialogChanged({readingDirection:s}))},{default:d(()=>[(i(!0),P(B,null,$(o.readingDirectionChoices,s=>(i(),g(I,{key:s.value,label:s.title,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),l.isGlobalScope?S("",!0):D((i(),g(re,{key:0,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,onClick:e.clearSettingsLocal},{default:d(()=>t[7]||(t[7]=[k(" Clear Settings ")])),_:1},8,["disabled","onClick"])),[[W,{openDelay:l.openDelay,text:"Use the default settings for all comics for this comic"}]])])]),_:1}),n(F),n(L,{class:"readerDrawerItem","model-value":e.finishOnLastPage,density:"compact",label:"Finish Book On Last Page","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[4]||(t[4]=s=>o.settingsDialogChanged({finishOnLastPage:s}))},null,8,["model-value"]),n(L,{"model-value":e.selectedSettings.readRtlInReverse,class:"readerDrawerItem",density:"compact",label:"Read RTL Comics as LTR","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=s=>o.settingsDialogChanged({readRtlInReverse:s}))},null,8,["model-value"]),D(n(L,{"model-value":e.cacheBook,class:"readerDrawerItem cacheBook",density:"compact",disabled:o.disableCacheBook,label:"Cache Entire Book","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[6]||(t[6]=s=>e.setSettingsClient({cacheBook:s}))},null,8,["model-value","disabled"]),[[W,{openDelay:l.openDelay,text:"Cache all pages from this book in the browser"}]]),e.isPDF?(i(),P("a",{key:0,id:"readPDFInBrowser",class:"readerDrawerItem",href:e.bookInBrowserURL,target:"_blank"},[n(y,null,{default:d(()=>[k(v(l.mdiOpenInNew),1)]),_:1}),t[8]||(t[8]=k("Read PDF in Browser "))],8,bo)):S("",!0)],64)}const _o=m(mo,[["render",fo],["__scopeId","data-v-6df780f4"]]),vo={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:co,ReaderKeyboardShortcutsPanel:po,ReaderSettingsPanel:_o}};function Po(e,t,a,p,l,o){const s=h("ReaderSettingsPanel"),u=h("ReaderKeyboardShortcutsPanel"),_=h("DownloadPanel");return i(),P(B,null,[n(s),n(F),n(u),n(F),n(_)],64)}const wo=m(vo,[["render",Po]]),So={name:"ReaderSettingsDrawer",components:{SettingsDrawer:tt,ReaderSettingsSuperPanel:wo}};function yo(e,t,a,p,l,o){const s=h("ReaderSettingsSuperPanel"),u=h("SettingsDrawer");return i(),g(u,{title:"Reader",temporary:"","disable-resize-watcher":""},{panel:d(()=>[n(s)]),_:1})}const Co=m(So,[["render",yo]]),J={a:Ee,f:Ae,p:xe,i:Ue,s:Fe,v:ze},Ro={a:"Story Arc",f:"Folder",p:"Publisher",i:"Imprint",s:"Series",v:"Volume"},Bo={name:"ReaderArcSelect",components:{ToolbarSelect:gt},data(){return{mdiFilterOutline:$e}},computed:{...f(c,{arcGroup:e=>{var t;return((t=e.arc)==null?void 0:t.group)||"s"},arc:e=>e.arc,arcName:e=>{for(const t of e.arcs)if(e.arc.group===t.group&&e.arc.pks===t.pks)return t.name;return"Unknown"},arcItems:e=>{const t=[];for(const a of e.arcs){const p={value:a,title:a.name,group:a.group,filters:a.filters,subtitle:Ro[a.group],prependIcon:J[a.group]};t.push(p)}return t}})},methods:{...b(c,["loadBooks"]),arcIcon(e){return J[e]},checkIcon(e){return e.group===this.arc.group&&e.pks==this.arc.pks?Ne:""},subtitle(e){let t=e.subtitle;return e.filters&&(t+=" (filtered)"),t},onUpdate(e){const t={group:e.group,pks:e.pks};this.loadBooks({arc:t})}}},Do={id:"arcPos"};function To(e,t,a,p,l,o){const s=h("ToolbarSelect");return i(),g(s,{"model-value":e.arc,class:"arcSelect","select-label":"reading order",items:e.arcItems,disabled:!e.arcItems||e.arcItems.length<=1,"onUpdate:modelValue":o.onUpdate},{item:d(({item:u,props:_})=>[n(Me,U(_,{density:"compact",variant:"plain","prepend-icon":u.raw.prependIcon,subtitle:o.subtitle(u.raw),"append-icon":o.checkIcon(_.value)}),null,16,["prepend-icon","subtitle","append-icon"])]),selection:d(({item:u,props:_})=>[n(y,U({size:"large"},_,{class:"arcSelectIcon"}),{default:d(()=>[k(v(o.arcIcon(u.raw.group)),1)]),_:2},1040),r("span",Do,v(e.arc.index)+" / "+v(e.arc.count),1)]),_:1},8,["model-value","items","disabled","onUpdate:modelValue"])}const Io=m(Bo,[["render",To],["__scopeId","data-v-62bf79bd"]]),Lo={name:"ReaderTitleToolbar",components:{MetadataDialog:pt,ReaderArcSelect:Io,SettingsDrawerButton:ot},data(){return{mdiClose:We,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...w(T,["isAuthDialogOpen"]),...w(c,["activeTitle","closeBookRoute"]),...f(c,{showToolbars:e=>e.showToolbars,currentBook:e=>{var t;return((t=e.books)==null?void 0:t.current)||{}},empty:e=>e.empty,subtitle:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.name)||""}}),title(){return this.activeTitle},extensionHeight(){let e=32;return this.subtitle&&(e*=2),e+=4,e},closeRoute(){const e=z(this.closeBookRoute),t=z(e.params);return delete t.name,e.params=t,e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...b(M,["setTimestamp"]),...b(c,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyUpListener(e){if(e.stopPropagation(),!this.isAuthDialogOpen)switch(e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.empty||this.openMetadata();break}}}},Vo={id:"title"},Oo={key:0,id:"subtitle"};function $o(e,t,a,p,l,o){const s=h("ReaderArcSelect"),u=h("MetadataDialog"),_=h("SettingsDrawerButton");return i(),g(qe,null,{default:d(()=>[D(n(rt,{id:"readerToolbarTop",density:"compact","extension-height":o.extensionHeight},He({default:d(()=>[n(x,null,{default:d(()=>[n(re,{ref:"closeBook",class:"closeBook",to:o.closeRoute,size:"large",density:"compact",variant:"plain",onClick:o.onCloseBook},{default:d(()=>t[0]||(t[0]=[k(" close book ")])),_:1},8,["to","onClick"])]),_:1}),n(mt),e.empty?S("",!0):(i(),g(x,{key:0},{default:d(()=>[n(s),n(u,{ref:"metadataDialog",group:"c",toolbar:!0,book:e.currentBook},null,8,["book"])]),_:1})),n(x,null,{default:d(()=>[n(_)]),_:1})]),_:2},[o.title?{name:"extension",fn:d(()=>[n(at,{class:"readerTitle"},{default:d(()=>[r("div",Vo,v(o.title),1),e.subtitle?(i(),P("div",Oo,v(e.subtitle),1)):S("",!0)]),_:1})]),key:"0"}:void 0]),1032,["extension-height"]),[[se,e.showToolbars]])]),_:1})}const pe=m(Lo,[["render",$o],["__scopeId","data-v-dc4c0fde"]]),No={name:"ReaderEmptyBooks",components:{ReaderTopToolbar:pe,EmptyState:ie},data(){return{mdiBookRemoveOutline:Ge}},methods:{...b(c,["loadBooks"]),onAction(){this.loadBooks({mtime:Date.now()})}}};function Eo(e,t,a,p,l,o){const s=h("ReaderTopToolbar"),u=h("EmptyState");return i(),P(B,null,[n(s),n(u,{headline:"Book Not Found",title:"Close the reader and find another book",icon:l.mdiBookRemoveOutline,"action-text":"Try to load book again","onClick:action":o.onAction},null,8,["icon","onClick:action"])],64)}const Ao=m(No,[["render",Eo]]),xo={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:de},props:{direction:{type:String,required:!0}},computed:{...w(c,["isBTT"]),...f(c,{toRoute(e){var a;const t=(a=e==null?void 0:e.routes)==null?void 0:a.books[this.direction];return t?{params:z(t)}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.bookChangeIcon(this.direction)},classes(){return{bookChangeNavButtonLeft:this.direction==="prev",bookChangeNavButtonRight:this.direction==="next"}}},methods:{...b(c,["bookChangeIcon"])}};function Uo(e,t,a,p,l,o){const s=h("PaginationNavButton");return e.toRoute?(i(),g(s,{key:0,class:C(o.classes),icon:"",variant:"plain",title:o.title,to:e.toRoute},{default:d(()=>[n(y,null,{default:d(()=>[k(v(o.icon),1)]),_:1})]),_:1},8,["class","title","to"])):S("",!0)}const Fo=m(xo,[["render",Uo],["__scopeId","data-v-f8015577"]]),zo={name:"ReaderNavButton",components:{PaginationNavButton:de},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...w(c,["isVertical"]),...f(c,{storePage:e=>e.page,toRoute(e){if(!this.isVertical)return{params:{pk:e.books.current.pk,page:this.value}}},isBookPrev:e=>!!e.routes.books.prev,isBookNext:e=>!!e.routes.books.next}),classes(){return{readerNavButtonLeft:!this.isBookPrev&&this.value===0,readerNavButtonRight:!this.isBookNext&&this.value!=0}},title(){return"Page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...b(c,["setActivePage"]),onClick(){this.isVertical&&this.setActivePage(this.value,!0)}}};function Mo(e,t,a,p,l,o){const s=h("PaginationNavButton");return i(),g(s,{key:e.isVertical,disabled:o.disabled,class:C(["readerNavButton",o.classes]),title:o.title,to:e.toRoute,onClick:o.onClick},{default:d(()=>[k(v(a.value),1)]),_:1},8,["disabled","class","title","to","onClick"])}const Wo=m(zo,[["render",Mo],["__scopeId","data-v-530fba8c"]]),V="prev",O="next",Ho={name:"ReaderNavToolbar",components:{PaginationSlider:kt,ReaderNavButton:Wo,PaginationToolbar:bt,ReaderBookChangeNavButton:Fo},computed:{...w(T,["isAuthDialogOpen"]),...w(c,["activeSettings","isReadInReverse","isVertical"]),...f(c,{showToolbars:e=>e.showToolbars,storePage:e=>e.page,key(e){var a,p;return`${(p=(a=e.books)==null?void 0:a.current)==null?void 0:p.pk}:${this.step}:${this.isReadInReverse}`},maxPage:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.maxPage)||0}}),twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},min(){return this.isReadInReverse?this.maxPage:0},max(){return this.isReadInReverse?0:this.maxPage},bookPrev(){return this.isReadInReverse?"next":"prev"},bookNext(){return this.isReadInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{...b(c,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.isVertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyUpListener(e){if(e.stopPropagation(),!this.isAuthDialogOpen)switch(e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(O):e.shiftKey&&window.scrollY===0&&this.routeToDirection(V);break;case"j":case"ArrowRight":this.routeToDirection(O);break;case"k":case"ArrowLeft":this.routeToDirection(V);break;case",":this.routeToDirectionOne(V);break;case".":this.routeToDirectionOne(O);break;case"n":this.routeToBook(O);break;case"p":this.routeToBook(V);break}}}};function qo(e,t,a,p,l,o){const s=h("ReaderBookChangeNavButton"),u=h("ReaderNavButton"),_=h("PaginationSlider"),R=h("PaginationToolbar");return i(),g(Ke,null,{default:d(()=>[e.maxPage?D((i(),g(R,{key:0,id:"readerToolbarNav"},{default:d(()=>[n(s,{direction:o.bookPrev,narrow:!1},null,8,["direction"]),n(u,{value:o.min,"two-pages":o.twoPages},null,8,["value","two-pages"]),(i(),g(_,{key:e.key,"model-value":e.storePage,min:0,max:e.maxPage,step:o.step,"track-color":o.trackColor,reverse:e.isReadInReverse,"onUpdate:modelValue":t[0]||(t[0]=N=>o.onSliderUpdate(N))},null,8,["model-value","max","step","track-color","reverse"])),n(u,{value:o.max,"two-pages":o.twoPages},null,8,["value","two-pages"]),n(s,{direction:o.bookNext,narrow:!1},null,8,["direction"])]),_:1},512)),[[se,e.showToolbars]]):S("",!0)]),_:1})}const Go=m(Ho,[["render",qo],["__scopeId","data-v-955ab3ce"]]),Ko={name:"MainReader",components:{BooksWindow:so,ReaderEmpty:Ao,ReaderNavToolbar:Go,ReaderTopToolbar:pe,ReaderSettingsDrawer:Co,Unauthorized:nt},data(){return{showToolbars:!1}},computed:{...w(T,["isAuthorized"]),...f(T,{user:e=>e.user}),...f(c,{empty:e=>e.empty,arc:e=>e.arc})},watch:{user(){this.loadReaderSettings()},isAuthorized(){this.loadReaderSettings()}},beforeMount(){this.reset(),this.loadReaderSettings()},methods:{...b(c,["loadReaderSettings","reset"])}},jo={key:0},Yo={id:"readerContainer"};function Xo(e,t,a,p,l,o){const s=h("ReaderTopToolbar"),u=h("BooksWindow"),_=h("ReaderNavToolbar"),R=h("ReaderEmpty"),N=h("ReaderSettingsDrawer"),me=h("Unauthorized");return e.isAuthorized?(i(),g(it,{key:0,id:"readerWrapper"},{default:d(()=>[e.empty?(i(),g(R,{key:1})):(i(),P("div",jo,[r("div",Yo,[n(s),n(u),n(_)])])),n(N)]),_:1})):(i(),g(me,{key:1}))}const pa=m(Ko,[["render",Xo],["__scopeId","data-v-4f31abfa"]]);export{pa as default};
