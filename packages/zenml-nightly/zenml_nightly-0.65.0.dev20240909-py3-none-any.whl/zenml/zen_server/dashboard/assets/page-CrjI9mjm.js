import{r as x,j as e}from"./@radix-DnFH_oo1.js";import{k as w,l as S,j as N,n as k,F as v,a0 as Q,a1 as $,h,a2 as C,a3 as E,a4 as T,f as z,I as j,a7 as F,a8 as P,a9 as H,af as G,ag as U,ah as J,ai as W,z as f,aj as X,D as Y,S as b,o as Z,B as ee}from"./index-Davdjm1d.js";import{S as se,P as te}from"./SearchField-BPNazO4G.js";import{a as A,b as O,c as V}from"./@tanstack-QbMbTrh5.js";import{o as ae}from"./url-DNHuFfYx.js";import{w as re}from"./index-CnqMjIZT.js";import{S as ne,s as ce,E as ie}from"./EditSecretDialog-CmY9fiM0.js";import{S as oe}from"./plus-Bc8eLSDM.js";import{S as I}from"./trash-DUWZWzse.js";import{t as le}from"./zod-uFd1wBcd.js";import{u as de,a as me,C as g}from"./index.esm-BE1uqCX5.js";import{S as ue}from"./Lock-CmIn0szs.js";import{C as xe}from"./CopyButton-BAYaQlWF.js";import{D as he}from"./DisplayDate-DkCy54Bp.js";import{I as pe}from"./InlineAvatar-C2ZECnGP.js";import{S as fe}from"./dots-horizontal-C6K59vUm.js";import{D,S as je}from"./DialogItem-B576Svvy.js";import{c as ge,b as ye}from"./@react-router-APVeuk-U.js";import"./@reactflow-IuMOnBUC.js";import"./chevron-right-double-c9H46Kl8.js";import"./index-5GJ5ysEZ.js";import"./copy-CaGlDsUy.js";function we({params:a}){return["secrets",a]}async function Se({params:a}){const t=w(S.secrets.all+"?"+ae(a)),s=await N(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&k(),!s.ok)throw new v({message:"Error while fetching secrets",status:s.status,statusText:s.statusText});return s.json()}function Ne(a,t){return A({queryKey:we(a),queryFn:()=>Se(a),...t})}async function ve(a){const t=w(S.secrets.add(a.workspace)),s=await N(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const r=await s.json().then(n=>n.detail).catch(()=>"Failed to create Secret");throw new v({status:s.status,statusText:s.statusText,message:r})}return s.json()}function be(a){return O({mutationFn:async t=>ve(t),...a})}function De({id:a,workspace:t}){const[s,r]=x.useState(!1);return e.jsxs(Q,{open:s,onOpenChange:r,children:[e.jsx($,{asChild:!0,children:e.jsx(h,{className:"shrink-0",intent:"primary",children:"Add secret"})}),e.jsxs(C,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(E,{children:e.jsx(T,{children:"Register New Secret"})}),e.jsx(ke,{userId:a,setOpen:r,workspaceId:t.id})]})]})}function ke({userId:a,setOpen:t,workspaceId:s}){const{handleSubmit:r,control:n,watch:i,setValue:c,formState:{isValid:u},reset:p}=de({resolver:le(ce),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:m,append:q,remove:L}=me({control:n,name:"keysValues"}),{toast:R}=z(),_=V(),{mutate:B}=be({onError(o){H(o)&&R({status:"error",emphasis:"subtle",description:o.message,rounded:!0})},onSuccess(){_.invalidateQueries({queryKey:["secrets"]}),t(!1),p()}}),K=o=>{B({user:a,workspace:s,name:o.secretName,scope:"workspace",values:o.keysValues.reduce((l,d)=>(d.key&&d.value&&(l[d.key]=d.value),l),{})})},M=o=>{K(o)};return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-secret-form",className:"gap-5 p-5",onSubmit:r(M),children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(g,{name:"secretName",control:n,render:({field:o})=>e.jsx(j,{...o,className:"mb-3 w-full",required:!0})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold ",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row ",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),m.map((o,l)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1 ",children:[e.jsx("div",{className:"relative flex-grow ",children:e.jsx(g,{name:`keysValues.${l}.key`,control:n,render:({field:d})=>e.jsx(j,{...d,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(g,{name:`keysValues.${l}.value`,control:n,render:({field:d})=>e.jsx(j,{...d,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:i(`keysValues.${l}.showPassword`)?"text":"password"})}),e.jsx("div",{onClick:()=>{const d=i(`keysValues.${l}.showPassword`);c(`keysValues.${l}.showPassword`,!d)},className:"absolute inset-y-1 right-0 flex cursor-pointer items-center pb-1 pr-3",children:e.jsx(ne,{className:"h-4 w-4 flex-shrink-0 cursor-pointer"})})]})}),e.jsxs("div",{className:"flex items-center",children:[l===m.length-1&&e.jsx(h,{intent:"primary",emphasis:"subtle",onClick:()=>q({key:"",value:""}),className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(oe,{className:"flex-shrink-0 fill-primary-600"})}),l!==m.length-1&&e.jsx(h,{intent:"secondary",emphasis:"minimal",onClick:()=>L(l),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(I,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},o.id))]})}),e.jsxs(F,{className:"gap-[10px]",children:[e.jsx(P,{asChild:!0,children:e.jsx(h,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(h,{intent:"primary",disabled:!u,type:"submit",form:"create-secret-form",children:"Register Secret"})]})]})}async function Ce(a){const t=w(S.secrets.detail(a)),s=await N(t,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(s.status===404&&k(),!s.ok)throw new v({message:"Error deleting secret",status:s.status,statusText:s.statusText});return s.json()}function Ee(a){return O({mutationFn:async t=>Ce(t),...a})}function Te({secretId:a}){const t=V(),{mutate:s}=Ee({onSuccess(){t.invalidateQueries({queryKey:["secrets"]})}}),[r,n]=x.useState("");function i(){s(a)}function c(u){n(u.target.value)}return e.jsxs(C,{children:[e.jsx(E,{children:e.jsx(T,{children:"Delete secret"})}),e.jsxs("div",{className:"gap-5 p-5",children:[e.jsx("p",{className:"text-text-md  text-theme-text-secondary",children:"Are you sure you want to delete this secret?"}),e.jsx("p",{className:"text-text-md  text-theme-text-secondary",children:"This action cannot be undone."}),e.jsx("h3",{className:"font-inter text-sm mb-1 mt-4 text-left font-medium leading-5",children:"Please type DELETE to confirm"}),e.jsx(j,{name:"key",onChange:c,className:"w-full",required:!0,value:r})]}),e.jsxs(F,{className:"gap-[10px]",children:[e.jsx(P,{asChild:!0,children:e.jsx(h,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(h,{intent:"danger",type:"submit",form:"edit-secret-form",onClick:i,disabled:r!=="DELETE",children:"Delete"})]})]})}function Fe({secretId:a}){const[t,s]=x.useState(!1),[r,n]=x.useState(!1),i=x.useRef(null),c=x.useRef(null);function u(){c.current=i.current}function p(m){if(m===!1){s(!1),setTimeout(()=>{n(m)},200);return}n(m)}return e.jsxs(G,{onOpenChange:s,open:t,children:[e.jsx(U,{ref:i,children:e.jsx(fe,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsxs(J,{hidden:r,onCloseAutoFocus:m=>{c.current&&(c.current.focus(),c.current=null,m.preventDefault())},align:"end",sideOffset:7,children:[e.jsx(D,{onSelect:u,onOpenChange:p,triggerChildren:"Edit ",icon:e.jsx(je,{}),children:e.jsx(ie,{secretId:a,isSecretNameEditable:!0,dialogTitle:"Edit secret"})}),e.jsx(D,{onSelect:u,onOpenChange:p,triggerChildren:"Delete ",icon:e.jsx(I,{}),children:e.jsx(Te,{secretId:a})})]})]})}function Pe(a){return[{id:"secret",header:"Secret",accessorFn:t=>t.name,cell:({getValue:t,row:s})=>e.jsxs("div",{className:"flex cursor-pointer items-center space-x-2",children:[e.jsx(ue,{className:"h-4 w-4 flex-shrink-0 cursor-pointer fill-primary-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"group/copybutton flex flex-row items-center gap-0.5 space-x-1",children:[e.jsx("span",{className:" text-text-md font-semibold text-theme-text-primary",onClick:()=>a(`/settings/secrets/${s.original.id}`),children:t()}),e.jsx(xe,{copyText:t()})]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[" ",s.original.id.slice(0,8)]})]})]})},{id:"author",header:"Author",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.user},cell:({getValue:t})=>{const s=t();return e.jsx(e.Fragment,{children:e.jsx(pe,{username:W(s)})})}},{id:"created_at",header:"Created At",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.created},cell:({getValue:t})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(he,{dateString:t()})})},{id:"admin_actions",header:"",accessorFn:t=>String(t.id),cell:({row:t,getValue:s})=>{var n,i,c;const r=s();return(c=(i=(n=t.original.body)==null?void 0:n.user)==null?void 0:i.body)!=null&&c.is_admin?e.jsx(Fe,{secretId:r}):e.jsx("p",{className:"text-sm text-theme-text-secondary",children:"No Actions"})}}]}const y=1,Ae=f.object({page:f.coerce.number().min(y).optional().default(y).catch(y),name:f.string().optional(),operator:f.enum(["and","or"]).optional()});function Oe(){const[a]=ge(),{page:t,name:s,operator:r}=Ae.parse({page:a.get("page")||void 0,name:a.get("name")||void 0,operator:a.get("operator")||void 0});return{page:t,name:s,logical_operator:r}}function Ve(){const a=ye(),t=Oe(),{data:s}=Ne({params:{...t,sort_by:"desc:created"}},{throwOnError:!0}),{data:r}=X(),n=(r==null?void 0:r.id)||"",{data:i,isLoading:c,isError:u,isSuccess:p}=A({...re.workspaceDetail("default")});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(se,{searchParams:t}),c?e.jsx("div",{children:"Loading..."}):u?e.jsx("div",{children:"Error loading workspace details."}):p&&e.jsx(De,{id:n,workspace:i})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:s?e.jsx(Y,{columns:Pe(a),data:s.items}):e.jsx(b,{className:"h-[250px] w-full"})}),s?s.total_pages>1&&e.jsx(te,{searchParams:t,paginate:s}):e.jsx(b,{className:"h-[36px] w-[300px]"})]})]})}function as(){const{setCurrentBreadcrumbData:a}=Z();return x.useEffect(()=>{a({segment:"secrets",data:null})},[]),e.jsxs(ee,{className:"space-y-4 p-5",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Secrets"}),e.jsxs("div",{className:"flex flex-row space-x-2",children:[e.jsx("p",{className:"text-text-md text-theme-text-secondary",children:"Configure and manage your pipeline secrets and configurations."}),e.jsx("a",{href:"https://docs.zenml.io/how-to/interact-with-secrets",className:"text-text-md  text-primary-400",children:"Learn More"})]}),e.jsx(Ve,{})]})}export{as as default};
