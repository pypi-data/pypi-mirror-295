"use strict";(self.webpackChunk_ouyangde1_jupyterlab_spreadsheet=self.webpackChunk_ouyangde1_jupyterlab_spreadsheet||[]).push([[14],{14:(e,t,s)=>{s.r(t),s.d(t,{ISpreadsheetTracker:()=>M,default:()=>E});var o=s(132),r=s(72),n=s(930),i=s(966),a=s(667),d=s(675);class l{constructor({value:e}){this._workbookChanged=new d.Subject,this._sheetChanged=new d.Subject,this._activeSheet=null,this._isDisposed=!1,this._value=e,this._subscription=e.subscribe(this.handleContentChanged.bind(this))}get isDisposed(){return this._isDisposed}get workbookChanged(){return this._workbookChanged}get sheetChanged(){return this._sheetChanged}get activeSheet(){return this._activeSheet}dispose(){this._isDisposed||(this._sheetChanged.complete(),this._workbookChanged.complete(),this._subscription.unsubscribe(),delete this._workbook)}setSheet(e){this._activeSheet=e,this._sheetChanged.next(e)}getSheetNames(){return null==this._workbook?[]:this._workbook.SheetNames}getExtent(){if(null==this._activeSheet||null==this._workbook)return{s:{c:0,r:0},e:{c:0,r:0}};const e=this._workbook.Sheets[this._activeSheet]["!ref"]||"A1:A1",t=a.utils.decode_range(e);return t.s={c:0,r:0},t}getLength(){const e=this.getExtent();return e.e.r-e.s.r+1}getItem(e){const t={id:e};if(null==this._workbook||null==this._activeSheet)return Object.freeze(t);const s=this._workbook.Sheets[this._activeSheet],o=this.getExtent(),r=o.e.c-o.s.c;for(let o=0;o<=r;o++){const r=a.utils.encode_cell({r:e,c:o});let n=null;r in s&&(n=s[r]),t["c"+o]=n}return Object.freeze(t)}getItemMetadata(e){const t={columns:{}};if(null==this._workbook||null==this._activeSheet)return Object.freeze(t);const s=this._workbook.Sheets[this._activeSheet];if(null==s["!merges"])return Object.freeze(t);const o=s["!merges"];for(let s=0;s<o.length;s++){const r=o[s];if(e<r.s.r||r.e.r<e)continue;const n=r.e.r-r.s.r>0&&e<r.e.r;t.columns["c"+r.s.c]={colspan:r.e.c-r.s.c+1,mergeDown:n}}return Object.freeze(t)}getColumnConfig(){if(null==this._workbook||null==this._activeSheet)return[];const e=this._workbook.Sheets[this._activeSheet],t=this.getExtent(),s=[{id:"row",name:"#",field:"id",cssClass:"sp-Row-Index",headerCssClass:"sp-GridHeader",formatter:(e,t,s)=>""+(1+s)}];for(let o=t.s.c;o<=t.e.c;o++){const t=a.utils.encode_col(o),r=e["!cols"]?e["!cols"][o].width:void 0;s.push({id:"c"+o,name:t,field:"c"+o,width:r,headerCssClass:"sp-GridHeader"})}return s}toCsv(e){const t=e||this._activeSheet;if(null==this._workbook||null==t)return null;const s=this._workbook.Sheets[t];return a.utils.sheet_to_csv(s,{FS:","})}handleContentChanged(e){this._workbook=(0,a.read)(e),this._activeSheet=this._workbook.SheetNames[0],this._workbookChanged.next(void 0)}}class h extends i.DocumentModel{constructor(e){super(e),this._observable=new d.Subject,this._model=new l({value:this._observable}),this._observable.next(this.toString()),this.contentChanged.connect(this.valueChanged,this)}get model(){return this._model}dispose(){this.isDisposed||(this._observable.complete(),this.contentChanged.disconnect(this.valueChanged,this),this._model.dispose())}valueChanged(){this._observable.next(this.toString())}}class c extends i.Base64ModelFactory{createNew(e){return new h(e)}get name(){return"workbook"}}var u=s(882);function p(e,t,s,o,r,n){const i=s,a={text:"",addClasses:"sp-Cell ",removeClasses:"sp-Cell-Number sp-Cell-Error sp-Cell-MergeDown"},d=n.getData().getItemMetadata(e),l=o.id;if(l&&d.columns&&l in d.columns&&d.columns[l].mergeDown&&(a.addClasses+="sp-Cell-MergeDown "),null==i)return a;switch(a.text=i.h||i.w||""+i.v,i.t){case"n":a.addClasses+="sp-Cell-Number";break;case"e":a.addClasses+="sp-Cell-Error"}return Object.freeze(a)}s(865),s(337),s(812),s(947),s(491),s(59),s(452);var b=s(379),g=s.n(b),m=s(795),_=s.n(m),C=s(569),k=s.n(C),w=s(565),v=s.n(w),f=s(216),S=s.n(f),x=s(589),y=s.n(x),j=s(85),T={};T.styleTagTransform=y(),T.setAttributes=v(),T.insert=k().bind(null,"head"),T.domAPI=_(),T.insertStyleElement=S(),g()(j.Z,T),j.Z&&j.Z.locals&&j.Z.locals;class B extends u.Widget{constructor({model:e}){super(),this.addClass("sp-Grid"),this._model=e,this._subscription=(0,d.merge)(e.sheetChanged,e.workbookChanged).subscribe((()=>this.update())),this._columnConfig=e.getColumnConfig(),this._grid=this.buildGrid()}dispose(){this.isDisposed||(this._subscription.unsubscribe(),this._grid.destroy())}onUpdateRequest(){this._columnConfig=this._model.getColumnConfig(),this._grid.destroy(),this._grid=this.buildGrid()}onAfterShow(){null!=this._grid&&this._grid.render()}onResize(){null!=this._grid&&this._grid.resizeCanvas()}buildGrid(){return new Slick.Grid(this.node,this._model,this._columnConfig,{defaultFormatter:p,enableColumnReorder:!1})}}var D=s(517),W={};W.styleTagTransform=y(),W.setAttributes=v(),W.insert=k().bind(null,"head"),W.domAPI=_(),W.insertStyleElement=S(),g()(D.Z,W),D.Z&&D.Z.locals&&D.Z.locals;class N extends u.Widget{constructor({model:e}){super(),this.addClass(N.CSS_CLASS),this.model=e,this.layout=new u.BoxLayout({}),this.grid=new B({model:e}),this.tabBar=new u.TabBar({allowDeselect:!1,tabsMovable:!1}),this.layout.addWidget(this.grid),this.layout.addWidget(this.tabBar),u.BoxLayout.setSizeBasis(this.tabBar,26),u.BoxLayout.setStretch(this.grid,1),this.tabBar.currentChanged.connect(this.handleSheetChanged,this),this._subscription=this.model.workbookChanged.subscribe((()=>this.handleModelContentChanged()))}dispose(){this.isDisposed||(this.grid.dispose(),this.tabBar.dispose(),this._subscription.unsubscribe(),super.dispose())}handleSheetChanged(e,{currentTitle:t}){null!=t&&this.model.setSheet(t.label)}handleModelContentChanged(){this.tabBar.clearTabs();const e=this.model.getSheetNames();for(const t of e)this.tabBar.addTab({label:t,owner:void 0});this.tabBar.currentIndex=e.indexOf(this.model.activeSheet||"")}}!function(e){e.CSS_CLASS="sp-SpreadsheetWidget"}(N||(N={}));class F extends i.ABCWidgetFactory{createNewWidget(e){const t=e.model.model,s=new N({model:t});return new i.DocumentWidget({content:s,context:e})}}const M=new n.Token("jupyterlab-spreadsheet:tracker"),A={id:"jupyter-spreadsheet",autoStart:!0,requires:[o.ILayoutRestorer],provides:M,activate:function(e,t){const{docRegistry:s}=e,o=new r.WidgetTracker({namespace:"jupyterlab-spreadsheet"}),n=new F({name:"Spreadsheet",modelName:"workbook",fileTypes:["excel","csv","dsv","ods"],defaultFor:["excel","ods"]}),i=new c;return s.addModelFactory(i),s.addWidgetFactory(n),s.addFileType({name:"excel",displayName:"Excel Workbook",fileFormat:"base64",extensions:[".xls",".xlsx"],mimeTypes:["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/octet-stream","text/plain"]}),s.addFileType({name:"ods",displayName:"OpenOffice/LibreOffice Workbook",fileFormat:"base64",extensions:[".ods"],mimeTypes:["application/vnd.oasis.opendocument.spreadsheet","application/octet-stream","text/plain"]}),n.widgetCreated.connect(((e,t)=>{o.add(t),t.context.pathChanged.connect((()=>{o.save(t)}))})),t.restore(o,{command:"docmanager:open",args:e=>({path:e.context.path,factory:"Spreadsheet"}),name:e=>e.context.path}),o}},E=A},85:(e,t,s)=>{s.d(t,{Z:()=>a});var o=s(81),r=s.n(o),n=s(645),i=s.n(n)()(r());i.push([e.id,".sp-Grid {\n    color: var(--jp-ui-font-color0);\n    background-color: var(--jp-rendermime-table-row-background);\n}\n\n.sp-GridHeader {\n    font-weight: bold;\n    background-color: var(--jp-border-color2);\n    color: var(--jp-ui-font-color0);\n}\n\n.sp-Row-Index {\n    border-right-style: solid;\n    background-color: var(--jp-border-color2);\n}\n\n.sp-Cell {\n    white-space: pre;\n}\n\n.sp-Cell-Number {\n    text-align: end;\n}\n\n.sp-Cell-Error {\n    font-weight: bold;\n    color: red;\n}\n\n.sp-Cell-MergeDown {\n    border-bottom-color: transparent;\n}",""]);const a=i},517:(e,t,s)=>{s.d(t,{Z:()=>a});var o=s(81),r=s.n(o),n=s(645),i=s.n(n)()(r());i.push([e.id,".sp-SpreadsheetWidget > .p-TabBar {\n    height: 26px;\n    background-color: var(--jp-border-color1);\n    padding-left: 10px;\n}\n\n.sp-SpreadsheetWidget > .p-TabBar .p-TabBar-tab {\n    padding: 0 0.5em;\n    background-color: var(--jp-layout-color2);\n    border: 1px solid var(--jp-border-color1);\n    border-left: 0px;\n    border-bottom: 0px;\n    color: var(--jp-ui-font-color0);\n}\n\n.sp-SpreadsheetWidget > .p-TabBar .p-TabBar-tab.p-mod-current {\n    background-color: var(--jp-layout-color0);\n    border-top: 0px;\n    border-bottom: 2px solid var(--jp-brand-color0);\n}",""]);const a=i}}]);